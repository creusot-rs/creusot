module M_implementation__impl_Clone_for_PersistentArray_T__clone (* <implementation::PersistentArray<T> as std::clone::Clone> *)
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use seq.Seq
  use creusot.prelude.Any
  
  type t_Rc_PermCell_Inner_T_Global
  
  type t_Fragment_Id_Seq_T
  
  type t_Rc_LocalInvariant_PA_T_Global
  
  type t_PersistentArray_T = {
    permcell: t_Rc_PermCell_Inner_T_Global;
    frag: t_Fragment_Id_Seq_T;
    inv: t_Rc_LocalInvariant_PA_T_Global }
  
  predicate inv_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate invariant_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (self: t_Rc_PermCell_Inner_T_Global) =
    inv_Rc_PermCell_Inner_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_PermCell_Inner_T_Global
  
  predicate inv_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (_1: t_Rc_PermCell_Inner_T_Global) =
    invariant_ref_Rc_PermCell_Inner_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_PermCell_Inner_T_Global
  
  let rec clone_Rc_PermCell_Inner_T_Global (self_: t_Rc_PermCell_Inner_T_Global)
    (return (x: t_Rc_PermCell_Inner_T_Global)) =
    {[@expl:clone 'self_' type invariant] inv_ref_Rc_PermCell_Inner_T_Global self_}
    any
    [ return (result: t_Rc_PermCell_Inner_T_Global) -> {inv_Rc_PermCell_Inner_T_Global result}
      {result = self_}
      (! return {result}) ]
  
  predicate invariant_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T)
  
  predicate inv_Fragment_Id_Seq_T (_1: t_Fragment_Id_Seq_T)
  
  axiom inv_axiom: forall x: t_Fragment_Id_Seq_T [inv_Fragment_Id_Seq_T x]. inv_Fragment_Id_Seq_T x
      -> invariant_Fragment_Id_Seq_T x
  
  predicate invariant_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_Ghost_Fragment_Id_Seq_T
  
  predicate inv_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_Ghost_Fragment_Id_Seq_T
  
  predicate invariant_ref_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) =
    inv_Ghost_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Fragment_Id_Seq_T
  
  predicate inv_ref_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_ref_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Fragment_Id_Seq_T
  
  predicate invariant_ref_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Fragment_Id_Seq_T
  
  predicate inv_ref_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) = invariant_ref_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Fragment_Id_Seq_T
  
  let rec deref_Ghost_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) (return (x: t_Fragment_Id_Seq_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_Fragment_Id_Seq_T self}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_ref_Fragment_Id_Seq_T result} {result = self} (! return {result}) ]
  
  type t_Id
  
  type t_T
  
  type tup2_Id_Seq_T = { f0: t_Id; f1: Seq.seq t_T }
  
  function view_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) : tup2_Id_Seq_T
  
  function id_Id (self: t_Fragment_Id_Seq_T) : t_Id
  
  let rec clone_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) (return (x: t_Fragment_Id_Seq_T)) =
    {[@expl:clone 'self' type invariant] inv_ref_Fragment_Id_Seq_T self}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Fragment_Id_Seq_T result}
      {view_Fragment_Id_Seq_T result = view_Fragment_Id_Seq_T self}
      {id_Id result = id_Id self}
      (! return {result}) ]
  
  let rec new_Fragment_Id_Seq_T (x: t_Fragment_Id_Seq_T) (return (x'0: t_Fragment_Id_Seq_T)) =
    {[@expl:new 'x' type invariant] inv_Fragment_Id_Seq_T x}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Ghost_Fragment_Id_Seq_T result} {result = x} (! return {result}) ]
  
  predicate inv_Rc_LocalInvariant_PA_T_Global (_1: t_Rc_LocalInvariant_PA_T_Global)
  
  predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Ghost_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate invariant_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_ref_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_LocalInvariant_PA_T_Global
  
  let rec deref_Ghost_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global)
    (return (x: t_Rc_LocalInvariant_PA_T_Global)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global self}
    any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_ref_Rc_LocalInvariant_PA_T_Global result}
      {result = self}
      (! return {result}) ]
  
  let rec clone_Rc_LocalInvariant_PA_T_Global (self_: t_Rc_LocalInvariant_PA_T_Global)
    (return (x: t_Rc_LocalInvariant_PA_T_Global)) =
    {[@expl:clone 'self_' type invariant] inv_ref_Rc_LocalInvariant_PA_T_Global self_}
    any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_Rc_LocalInvariant_PA_T_Global result}
      {result = self_}
      (! return {result}) ]
  
  let rec new_Rc_LocalInvariant_PA_T_Global (x: t_Rc_LocalInvariant_PA_T_Global)
    (return (x'0: t_Rc_LocalInvariant_PA_T_Global)) =
    {[@expl:new 'x' type invariant] inv_Rc_LocalInvariant_PA_T_Global x}
    any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_Ghost_Rc_LocalInvariant_PA_T_Global result}
      {result = x}
      (! return {result}) ]
  
  type t_PermCell_Inner_T
  
  function id_Inner_T (self: t_PermCell_Inner_T) : t_Id
  
  function view_Rc_PermCell_Inner_T_Global (self: t_Rc_PermCell_Inner_T_Global) : t_PermCell_Inner_T
  
  type t_LocalInvariant_PA_T
  
  function public_PA_T (self: t_LocalInvariant_PA_T) : t_Id
  
  function view_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) : t_LocalInvariant_PA_T
  
  function namespace_PA_T (self: t_LocalInvariant_PA_T) : t_Namespace
  
  predicate invariant_PersistentArray_T (self: t_PersistentArray_T) =
    (view_Fragment_Id_Seq_T self.frag).f0 = id_Inner_T (view_Rc_PermCell_Inner_T_Global self.permcell)
    /\ id_Id self.frag = public_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv)
    /\ namespace_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv) = Namespace_PARRAY 0
  
  predicate inv_PersistentArray_T (_1: t_PersistentArray_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_PersistentArray_T [inv_PersistentArray_T x]. inv_PersistentArray_T x
      = (invariant_PersistentArray_T x
      /\ inv_Rc_PermCell_Inner_T_Global x.permcell
      /\ inv_Ghost_Fragment_Id_Seq_T x.frag /\ inv_Ghost_Rc_LocalInvariant_PA_T_Global x.inv)
  
  predicate invariant_ref_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) = inv_PersistentArray_T self
  
  meta "rewrite_def" predicate invariant_ref_PersistentArray_T
  
  predicate inv_ref_PersistentArray_T [@inline:trivial] (_1: t_PersistentArray_T) = invariant_ref_PersistentArray_T _1
  
  meta "rewrite_def" predicate inv_ref_PersistentArray_T
  
  function view_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) : Seq.seq t_T =
    (view_Fragment_Id_Seq_T self.frag).f1
  
  meta "rewrite_def" function view_PersistentArray_T
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec clone_PersistentArray_T (self: t_PersistentArray_T) (return (x: t_PersistentArray_T)) =
    {[@expl:clone 'self' type invariant] inv_ref_PersistentArray_T self}
    (! bb0
    [ bb0 = s0
      [ s0 = clone_Rc_PermCell_Inner_T_Global {self.permcell}
          (fun (_x: t_Rc_PermCell_Inner_T_Global) -> [ &_4 <- _x ] s1)
      | s1 = deref_Ghost_Fragment_Id_Seq_T {self.frag} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_9 <- _x ] s2)
      | s2 = clone_Fragment_Id_Seq_T {_9} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_7 <- _x ] s3)
      | s3 = new_Fragment_Id_Seq_T {_7} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_6 <- _x ] s4)
      | s4 = deref_Ghost_Rc_LocalInvariant_PA_T_Global {self.inv}
          (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &_14 <- _x ] s5)
      | s5 = clone_Rc_LocalInvariant_PA_T_Global {_14} (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &_12 <- _x ] s6)
      | s6 = new_Rc_LocalInvariant_PA_T_Global {_12} (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &_11 <- _x ] s7)
      | s7 = [ &_ret <- { permcell = _4; frag = _6; inv = _11 } ] s8
      | s8 = return {_ret} ] ]
    [ & _ret: t_PersistentArray_T = Any.any_l ()
    | & self: t_PersistentArray_T = self
    | & _4: t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & _6: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _7: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _9: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _11: t_Rc_LocalInvariant_PA_T_Global = Any.any_l ()
    | & _12: t_Rc_LocalInvariant_PA_T_Global = Any.any_l ()
    | & _14: t_Rc_LocalInvariant_PA_T_Global = Any.any_l () ])
    [ return (result: t_PersistentArray_T) -> {[@expl:clone result type invariant] inv_PersistentArray_T result}
      {[@expl:clone ensures] view_PersistentArray_T result = view_PersistentArray_T self}
      (! return {result}) ]
end
module M_implementation__impl_PersistentArray_T__new (* implementation::PersistentArray<T> *)
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use seq.Seq
  use creusot.int.UInt64
  use mach.int.Int
  use map.Map
  use map.Const
  use creusot.prelude.MutBorrow
  use creusot.prelude.Any
  
  type t_Vec_T_Global
  
  type t_T
  
  constant const_MAX: UInt64.t = (18446744073709551615: UInt64.t)
  
  function view_Vec_T_Global (self: t_Vec_T_Global) : Seq.seq t_T
  
  axiom view_Vec_T_Global_spec: forall self: t_Vec_T_Global. Seq.length (view_Vec_T_Global self)
      <= UInt64.t'int const_MAX
  
  type t_Rc_PermCell_Inner_T_Global
  
  type t_Inner_T = Direct t_Vec_T_Global | Link UInt64.t t_T t_Rc_PermCell_Inner_T_Global
  
  type t_PermCell_Inner_T
  
  type t_PermCellOwn_Inner_T
  
  type tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T = { f0: t_PermCell_Inner_T; f1: t_PermCellOwn_Inner_T }
  
  predicate inv_T (_1: t_T)
  
  predicate invariant_Box_T_Global (self: t_T) = inv_T self
  
  predicate inv_Box_T_Global [@inline:trivial] (_1: t_T) = invariant_Box_T_Global _1
  
  meta "rewrite_def" predicate inv_Box_T_Global
  
  predicate invariant_Seq_T [@inline:trivial] (self: Seq.seq t_T) =
    forall i: int. 0 <= i /\ i < Seq.length self -> inv_Box_T_Global (Seq.get self i)
  
  meta "rewrite_def" predicate invariant_Seq_T
  
  predicate inv_Seq_T [@inline:trivial] (_1: Seq.seq t_T) = invariant_Seq_T _1
  
  meta "rewrite_def" predicate inv_Seq_T
  
  predicate invariant_Vec_T_Global (self: t_Vec_T_Global) = inv_Seq_T (view_Vec_T_Global self)
  
  predicate inv_Vec_T_Global (_1: t_Vec_T_Global)
  
  axiom inv_axiom: forall x: t_Vec_T_Global [inv_Vec_T_Global x]. inv_Vec_T_Global x -> invariant_Vec_T_Global x
  
  predicate inv_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate inv_Inner_T (_1: t_Inner_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_Inner_T [inv_Inner_T x]. inv_Inner_T x
      = match x with
        | Direct f0'0 -> inv_Vec_T_Global f0'0
        | Link index value next -> inv_T value /\ inv_Rc_PermCell_Inner_T_Global next
        end
  
  predicate invariant_ref_Inner_T [@inline:trivial] (self: t_Inner_T) = inv_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_Inner_T
  
  predicate inv_ref_Inner_T [@inline:trivial] (_1: t_Inner_T) = invariant_ref_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Inner_T
  
  function val_Inner_T (self: t_PermCellOwn_Inner_T) : t_Inner_T
  
  predicate invariant_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_ref_Inner_T (val_Inner_T self)
  
  meta "rewrite_def" predicate invariant_PermCellOwn_Inner_T
  
  predicate inv_PermCellOwn_Inner_T (_1: t_PermCellOwn_Inner_T)
  
  axiom inv_axiom'1 [@rewrite]: forall x: t_PermCellOwn_Inner_T [inv_PermCellOwn_Inner_T x]. inv_PermCellOwn_Inner_T x
      = invariant_PermCellOwn_Inner_T x
  
  predicate invariant_Ghost_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_Ghost_PermCellOwn_Inner_T
  
  predicate inv_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_Ghost_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_Ghost_PermCellOwn_Inner_T
  
  predicate inv_tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T) =
    inv_Ghost_PermCellOwn_Inner_T _1.f1
  
  meta "rewrite_def" predicate inv_tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T
  
  type t_Id
  
  function id_Inner_T (self: t_PermCell_Inner_T) : t_Id
  
  function id_Inner_T'0 (self: t_PermCellOwn_Inner_T) : t_Id
  
  function view_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) : t_Inner_T = val_Inner_T self
  
  meta "rewrite_def" function view_PermCellOwn_Inner_T
  
  let rec new_Inner_T (value: t_Inner_T) (return (x: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T)) =
    {[@expl:new 'value' type invariant] inv_Inner_T value}
    any
    [ return (result: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T) ->
    {inv_tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T result}
      {id_Inner_T result.f0 = id_Inner_T'0 result.f1}
      {view_PermCellOwn_Inner_T result.f1 = value}
      (! return {result}) ]
  
  type t_Authority_Id_Seq_T
  
  predicate invariant_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T)
  
  predicate inv_Authority_Id_Seq_T (_1: t_Authority_Id_Seq_T)
  
  axiom inv_axiom'2: forall x: t_Authority_Id_Seq_T [inv_Authority_Id_Seq_T x]. inv_Authority_Id_Seq_T x
      -> invariant_Authority_Id_Seq_T x
  
  predicate invariant_Ghost_Authority_Id_Seq_T [@inline:trivial] (self: t_Authority_Id_Seq_T) =
    inv_Authority_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_Ghost_Authority_Id_Seq_T
  
  predicate inv_Ghost_Authority_Id_Seq_T [@inline:trivial] (_1: t_Authority_Id_Seq_T) =
    invariant_Ghost_Authority_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_Ghost_Authority_Id_Seq_T
  
  type t_FMap_Id_Seq_T
  
  function view_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T) : t_FMap_Id_Seq_T
  
  function len_Id (self: t_FMap_Id_Seq_T) : int
  
  axiom len_Id_spec: forall self: t_FMap_Id_Seq_T. len_Id self >= 0
  
  type t_Option_Seq_T = None | Some (Seq.seq t_T)
  
  function view_FMap_Id_Seq_T (self: t_FMap_Id_Seq_T) : Map.map t_Id t_Option_Seq_T
  
  constant empty_Id : t_FMap_Id_Seq_T
  
  axiom empty_Id_spec: len_Id empty_Id = 0
  
  axiom empty_Id_spec'0: view_FMap_Id_Seq_T empty_Id = Const.const (None)
  
  let rec new_Id (return (x: t_Authority_Id_Seq_T)) = any
    [ return (result: t_Authority_Id_Seq_T) -> {inv_Ghost_Authority_Id_Seq_T result}
      {view_Authority_Id_Seq_T result = empty_Id}
      (! return {result}) ]
  
  predicate invariant_ref_Ghost_Authority_Id_Seq_T [@inline:trivial] (self: MutBorrow.t t_Authority_Id_Seq_T) =
    inv_Ghost_Authority_Id_Seq_T self.current /\ inv_Ghost_Authority_Id_Seq_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Authority_Id_Seq_T
  
  predicate inv_ref_Ghost_Authority_Id_Seq_T [@inline:trivial] (_1: MutBorrow.t t_Authority_Id_Seq_T) =
    invariant_ref_Ghost_Authority_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Authority_Id_Seq_T
  
  predicate invariant_ref_Authority_Id_Seq_T [@inline:trivial] (self: MutBorrow.t t_Authority_Id_Seq_T) =
    inv_Authority_Id_Seq_T self.current /\ inv_Authority_Id_Seq_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Authority_Id_Seq_T
  
  predicate inv_ref_Authority_Id_Seq_T [@inline:trivial] (_1: MutBorrow.t t_Authority_Id_Seq_T) =
    invariant_ref_Authority_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Authority_Id_Seq_T
  
  let rec deref_mut_Ghost_Authority_Id_Seq_T (self: MutBorrow.t t_Authority_Id_Seq_T)
    (return (x: MutBorrow.t t_Authority_Id_Seq_T)) =
    {[@expl:deref_mut 'self' type invariant] inv_ref_Ghost_Authority_Id_Seq_T self}
    any
    [ return (result: MutBorrow.t t_Authority_Id_Seq_T) -> {inv_ref_Authority_Id_Seq_T result}
      {result = self}
      (! return {result}) ]
  
  type t_Fragment_Id_Seq_T
  
  function get_Id [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : t_Option_Seq_T =
    Map.get (view_FMap_Id_Seq_T self) k
  
  meta "rewrite_def" function get_Id
  
  predicate contains_Id [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) = get_Id self k <> None
  
  meta "rewrite_def" predicate contains_Id
  
  predicate invariant_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T)
  
  predicate inv_Fragment_Id_Seq_T (_1: t_Fragment_Id_Seq_T)
  
  axiom inv_axiom'3: forall x: t_Fragment_Id_Seq_T [inv_Fragment_Id_Seq_T x]. inv_Fragment_Id_Seq_T x
      -> invariant_Fragment_Id_Seq_T x
  
  function insert_Id (self: t_FMap_Id_Seq_T) (k: t_Id) (v: Seq.seq t_T) : t_FMap_Id_Seq_T
  
  axiom insert_Id_spec: forall self: t_FMap_Id_Seq_T, k: t_Id, v: Seq.seq t_T. view_FMap_Id_Seq_T (insert_Id self k v)
      = Map.set (view_FMap_Id_Seq_T self) k (Some v)
  
  axiom insert_Id_spec'0: forall self: t_FMap_Id_Seq_T, k: t_Id, v: Seq.seq t_T. len_Id (insert_Id self k v)
      = (if contains_Id self k then len_Id self else len_Id self + 1)
  
  function id_Id (self: t_Authority_Id_Seq_T) : t_Id
  
  type tup2_Id_Seq_T = { f0'0: t_Id; f1'0: Seq.seq t_T }
  
  function view_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) : tup2_Id_Seq_T
  
  function id_Id'0 (self: t_Fragment_Id_Seq_T) : t_Id
  
  let rec insert_Id'0 (self: MutBorrow.t t_Authority_Id_Seq_T) (k: t_Id) (v: Seq.seq t_T)
    (return (x: t_Fragment_Id_Seq_T)) = {[@expl:insert 'self' type invariant] inv_ref_Authority_Id_Seq_T self}
    {[@expl:insert requires] not contains_Id (view_Authority_Id_Seq_T self.current) k}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Fragment_Id_Seq_T result}
      {view_Authority_Id_Seq_T self.final = insert_Id (view_Authority_Id_Seq_T self.current) k v}
      {id_Id self.final = id_Id self.current}
      {view_Fragment_Id_Seq_T result = { f0'0 = k; f1'0 = v }}
      {id_Id'0 result = id_Id self.current}
      (! return {result}) ]
  
  predicate resolve_ref_Authority_Id_Seq_T [@inline:trivial] (_1: MutBorrow.t t_Authority_Id_Seq_T) =
    _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_Authority_Id_Seq_T
  
  predicate invariant_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_Ghost_Fragment_Id_Seq_T
  
  predicate inv_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_Ghost_Fragment_Id_Seq_T
  
  let rec new_Fragment_Id_Seq_T (x: t_Fragment_Id_Seq_T) (return (x'0: t_Fragment_Id_Seq_T)) =
    {[@expl:new 'x' type invariant] inv_Fragment_Id_Seq_T x}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Ghost_Fragment_Id_Seq_T result} {result = x} (! return {result}) ]
  
  type t_FMap_Id_PermCellOwn_Inner_T
  
  type t_Option_PermCellOwn_Inner_T = None'0 | Some'0 t_PermCellOwn_Inner_T
  
  function view_FMap_Id_PermCellOwn_Inner_T (self: t_FMap_Id_PermCellOwn_Inner_T) : Map.map t_Id t_Option_PermCellOwn_Inner_T
  
  function get_Id'0 [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_Option_PermCellOwn_Inner_T =
    Map.get (view_FMap_Id_PermCellOwn_Inner_T self) k
  
  meta "rewrite_def" function get_Id'0
  
  predicate contains_Id'0 [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) = get_Id'0 self k <> None'0
  
  meta "rewrite_def" predicate contains_Id'0
  
  predicate inv_Id [@inline:trivial] (_1: t_Id) = true
  
  meta "rewrite_def" predicate inv_Id
  
  predicate index_Mapping_PermCellOwn_Inner_T_bool [@inline:trivial] (self: Map.map t_PermCellOwn_Inner_T bool) (a: t_PermCellOwn_Inner_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_PermCellOwn_Inner_T_bool
  
  function such_that_PermCellOwn_Inner_T (p: Map.map t_PermCellOwn_Inner_T bool) : t_PermCellOwn_Inner_T
  
  axiom such_that_PermCellOwn_Inner_T_spec:
    forall p: Map.map t_PermCellOwn_Inner_T bool. (exists x: t_PermCellOwn_Inner_T. index_Mapping_PermCellOwn_Inner_T_bool p x)
      -> index_Mapping_PermCellOwn_Inner_T_bool p (such_that_PermCellOwn_Inner_T p)
  
  function unwrap_Option_PermCellOwn_Inner_T (self: t_Option_PermCellOwn_Inner_T) : t_PermCellOwn_Inner_T =
    match self with
      | Some'0 x -> x
      | None'0 -> such_that_PermCellOwn_Inner_T (fun (__0: t_PermCellOwn_Inner_T) -> true)
      end
  
  function lookup_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_PermCellOwn_Inner_T =
    unwrap_Option_PermCellOwn_Inner_T (get_Id'0 self k)
  
  meta "rewrite_def" function lookup_Id
  
  function index_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) : t_PermCellOwn_Inner_T
   = lookup_Id self key
  
  meta "rewrite_def" function index_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    forall k: t_Id. contains_Id'0 self k
      -> inv_Id k /\ inv_PermCellOwn_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self k)
  
  meta "rewrite_def" predicate invariant_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_FMap_Id_PermCellOwn_Inner_T (_1: t_FMap_Id_PermCellOwn_Inner_T)
  
  axiom inv_axiom'4 [@rewrite]:
    forall x: t_FMap_Id_PermCellOwn_Inner_T [inv_FMap_Id_PermCellOwn_Inner_T x]. inv_FMap_Id_PermCellOwn_Inner_T x
      = invariant_FMap_Id_PermCellOwn_Inner_T x
  
  predicate invariant_Ghost_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    inv_FMap_Id_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_Ghost_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_Ghost_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (_1: t_FMap_Id_PermCellOwn_Inner_T) =
    invariant_Ghost_FMap_Id_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_Ghost_FMap_Id_PermCellOwn_Inner_T
  
  predicate ext_eq_Id (self: t_FMap_Id_PermCellOwn_Inner_T) (other: t_FMap_Id_PermCellOwn_Inner_T) =
    forall k: t_Id. get_Id'0 self k = get_Id'0 other k
  
  axiom ext_eq_Id_spec:
    forall self: t_FMap_Id_PermCellOwn_Inner_T, other: t_FMap_Id_PermCellOwn_Inner_T. ext_eq_Id self other
      = (self = other)
  
  function len_Id'0 (self: t_FMap_Id_PermCellOwn_Inner_T) : int
  
  axiom len_Id_spec'0: forall self: t_FMap_Id_PermCellOwn_Inner_T. len_Id'0 self >= 0
  
  constant empty_Id'0 : t_FMap_Id_PermCellOwn_Inner_T
  
  axiom empty_Id_spec'1: len_Id'0 empty_Id'0 = 0
  
  axiom empty_Id_spec'2: view_FMap_Id_PermCellOwn_Inner_T empty_Id'0 = Const.const (None'0)
  
  predicate is_empty_Id (self: t_FMap_Id_PermCellOwn_Inner_T) = ext_eq_Id self empty_Id'0
  
  let rec new_Id'0 (return (x: t_FMap_Id_PermCellOwn_Inner_T)) = any
    [ return (result: t_FMap_Id_PermCellOwn_Inner_T) -> {inv_Ghost_FMap_Id_PermCellOwn_Inner_T result}
      {is_empty_Id result}
      (! return {result}) ]
  
  predicate invariant_ref_Ghost_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    inv_Ghost_FMap_Id_PermCellOwn_Inner_T self.current /\ inv_Ghost_FMap_Id_PermCellOwn_Inner_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Ghost_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_ref_Ghost_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    invariant_ref_Ghost_FMap_Id_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    inv_FMap_Id_PermCellOwn_Inner_T self.current /\ inv_FMap_Id_PermCellOwn_Inner_T self.final
  
  meta "rewrite_def" predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    invariant_ref_FMap_Id_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_FMap_Id_PermCellOwn_Inner_T
  
  let rec deref_mut_Ghost_FMap_Id_PermCellOwn_Inner_T (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T)
    (return (x: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T)) =
    {[@expl:deref_mut 'self' type invariant] inv_ref_Ghost_FMap_Id_PermCellOwn_Inner_T self}
    any
    [ return (result: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) -> {inv_ref_FMap_Id_PermCellOwn_Inner_T result}
      {result = self}
      (! return {result}) ]
  
  predicate invariant_ref_Ghost_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_Ghost_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_PermCellOwn_Inner_T
  
  predicate inv_ref_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_ref_Ghost_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_PermCellOwn_Inner_T
  
  predicate invariant_ref_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_PermCellOwn_Inner_T
  
  predicate inv_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_ref_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_PermCellOwn_Inner_T
  
  let rec deref_Ghost_PermCellOwn_Inner_T (self: t_PermCellOwn_Inner_T) (return (x: t_PermCellOwn_Inner_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_PermCellOwn_Inner_T self}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_ref_PermCellOwn_Inner_T result}
      {result = self}
      (! return {result}) ]
  
  let rec id_ghost_Inner_T (self: t_PermCellOwn_Inner_T) (return (x: t_Id)) =
    {[@expl:id_ghost 'self' type invariant] inv_ref_PermCellOwn_Inner_T self}
    any [ return (result: t_Id) -> {result = id_Inner_T'0 self} (! return {result}) ]
  
  let rec deref_Ghost_Id (self: t_Id) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = self} (! return {result}) ]
  
  let rec into_inner_PermCellOwn_Inner_T (self: t_PermCellOwn_Inner_T) (return (x: t_PermCellOwn_Inner_T)) =
    {[@expl:into_inner 'self' type invariant] inv_Ghost_PermCellOwn_Inner_T self}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_PermCellOwn_Inner_T result} {result = self} (! return {result}) ]
  
  predicate inv_Option_PermCellOwn_Inner_T (_1: t_Option_PermCellOwn_Inner_T)
  
  axiom inv_axiom'5 [@rewrite]:
    forall x: t_Option_PermCellOwn_Inner_T [inv_Option_PermCellOwn_Inner_T x]. inv_Option_PermCellOwn_Inner_T x
      = match x with
        | None'0 -> true
        | Some'0 f0'1 -> inv_PermCellOwn_Inner_T f0'1
        end
  
  function insert_Id'1 (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) (v: t_PermCellOwn_Inner_T) : t_FMap_Id_PermCellOwn_Inner_T
  
  axiom insert_Id_spec'1:
    forall self: t_FMap_Id_PermCellOwn_Inner_T, k: t_Id, v: t_PermCellOwn_Inner_T. view_FMap_Id_PermCellOwn_Inner_T (insert_Id'1 self k v)
      = Map.set (view_FMap_Id_PermCellOwn_Inner_T self) k (Some'0 v)
  
  axiom insert_Id_spec'2:
    forall self: t_FMap_Id_PermCellOwn_Inner_T, k: t_Id, v: t_PermCellOwn_Inner_T. len_Id'0 (insert_Id'1 self k v)
      = (if contains_Id'0 self k then len_Id'0 self else len_Id'0 self + 1)
  
  let rec insert_ghost_Id (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) (value: t_PermCellOwn_Inner_T)
    (return (x: t_Option_PermCellOwn_Inner_T)) =
    {[@expl:insert_ghost 'self' type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T self}
    {[@expl:insert_ghost 'value' type invariant] inv_PermCellOwn_Inner_T value}
    any
    [ return (result: t_Option_PermCellOwn_Inner_T) -> {inv_Option_PermCellOwn_Inner_T result}
      {self.final = insert_Id'1 self.current key value}
      {result = get_Id'0 self.current key}
      (! return {result}) ]
  
  predicate resolve_ref_Inner_T [@inline:trivial] (_1: t_Inner_T) = true
  
  meta "rewrite_def" predicate resolve_ref_Inner_T
  
  predicate resolve_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    resolve_ref_Inner_T (val_Inner_T self)
  
  meta "rewrite_def" predicate resolve_PermCellOwn_Inner_T
  
  predicate resolve_PermCellOwn_Inner_T'0 (_1: t_PermCellOwn_Inner_T)
  
  axiom resolve_axiom:
    forall x: t_PermCellOwn_Inner_T [resolve_PermCellOwn_Inner_T'0 x]. resolve_PermCellOwn_Inner_T'0 x
      -> resolve_PermCellOwn_Inner_T x
  
  predicate resolve_Option_PermCellOwn_Inner_T (_1: t_Option_PermCellOwn_Inner_T)
  
  axiom resolve_axiom'0 [@rewrite]:
    forall x: t_Option_PermCellOwn_Inner_T [resolve_Option_PermCellOwn_Inner_T x]. resolve_Option_PermCellOwn_Inner_T x
      = match x with
        | None'0 -> true
        | Some'0 x0 -> resolve_PermCellOwn_Inner_T'0 x0
        end
  
  predicate resolve_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_FMap_Id_PermCellOwn_Inner_T
  
  let rec into_inner_FMap_Id_PermCellOwn_Inner_T (self: t_FMap_Id_PermCellOwn_Inner_T)
    (return (x: t_FMap_Id_PermCellOwn_Inner_T)) =
    {[@expl:into_inner 'self' type invariant] inv_Ghost_FMap_Id_PermCellOwn_Inner_T self}
    any
    [ return (result: t_FMap_Id_PermCellOwn_Inner_T) -> {inv_FMap_Id_PermCellOwn_Inner_T result}
      {result = self}
      (! return {result}) ]
  
  let rec into_inner_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T) (return (x: t_Authority_Id_Seq_T)) =
    {[@expl:into_inner 'self' type invariant] inv_Ghost_Authority_Id_Seq_T self}
    any [ return (result: t_Authority_Id_Seq_T) -> {inv_Authority_Id_Seq_T result} {result = self} (! return {result}) ]
  
  type t_PA_T = { perms: t_FMap_Id_PermCellOwn_Inner_T; auth: t_Authority_Id_Seq_T; depth: Map.map t_Id int }
  
  predicate inv_PA_T (_1: t_PA_T)
  
  axiom inv_axiom'6 [@rewrite]: forall x: t_PA_T [inv_PA_T x]. inv_PA_T x
      = (inv_FMap_Id_PermCellOwn_Inner_T x.perms /\ inv_Authority_Id_Seq_T x.auth)
  
  predicate invariant_Ghost_PA_T [@inline:trivial] (self: t_PA_T) = inv_PA_T self
  
  meta "rewrite_def" predicate invariant_Ghost_PA_T
  
  predicate inv_Ghost_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_Ghost_PA_T _1
  
  meta "rewrite_def" predicate inv_Ghost_PA_T
  
  let rec new_PA_T (x: t_PA_T) (return (x'0: t_PA_T)) = {[@expl:new 'x' type invariant] inv_PA_T x}
    any [ return (result: t_PA_T) -> {inv_Ghost_PA_T result} {result = x} (! return {result}) ]
  
  type t_LocalInvariant_PA_T
  
  predicate index_Mapping_Seq_T_bool [@inline:trivial] (self: Map.map (Seq.seq t_T) bool) (a: Seq.seq t_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_Seq_T_bool
  
  function such_that_Seq_T (p: Map.map (Seq.seq t_T) bool) : Seq.seq t_T
  
  axiom such_that_Seq_T_spec:
    forall p: Map.map (Seq.seq t_T) bool. (exists x: Seq.seq t_T. index_Mapping_Seq_T_bool p x)
      -> index_Mapping_Seq_T_bool p (such_that_Seq_T p)
  
  function unwrap_Option_Seq_T (self: t_Option_Seq_T) : Seq.seq t_T = match self with
      | Some x -> x
      | None -> such_that_Seq_T (fun (__0: Seq.seq t_T) -> true)
      end
  
  function lookup_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : Seq.seq t_T =
    unwrap_Option_Seq_T (get_Id self k)
  
  meta "rewrite_def" function lookup_Id'0
  
  function index_FMap_Id_Seq_T [@inline:trivial] (self: t_FMap_Id_Seq_T) (key: t_Id) : Seq.seq t_T =
    lookup_Id'0 self key
  
  meta "rewrite_def" function index_FMap_Id_Seq_T
  
  function view_Rc_PermCell_Inner_T_Global (self: t_Rc_PermCell_Inner_T_Global) : t_PermCell_Inner_T
  
  function index_Mapping_Id_Int [@inline:trivial] (self: Map.map t_Id int) (a: t_Id) : int = Map.get self a
  
  meta "rewrite_def" function index_Mapping_Id_Int
  
  predicate partial_invariant_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    id_Id self.auth = resource_id
    /\ (forall id: t_Id. contains_Id (view_Authority_Id_Seq_T self.auth) id /\ contains_Id'0 self.perms id
      -> id_Inner_T'0 (index_FMap_Id_PermCellOwn_Inner_T self.perms id) = id
      /\ match val_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self.perms id) with
        | Direct v -> index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id = view_Vec_T_Global v
        | Link index value next -> contains_Id (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))
        /\ index_Mapping_Id_Int self.depth id
          > index_Mapping_Id_Int self.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))
        /\ UInt64.t'int index
          < Seq.length (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next)))
        /\ index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id
        = Seq.set (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))) (UInt64.t'int index) value
        end)
  
  meta "rewrite_def" predicate partial_invariant_T
  
  predicate protocol_PA_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    partial_invariant_T self resource_id
    /\ (forall id: t_Id. contains_Id (view_Authority_Id_Seq_T self.auth) id -> contains_Id'0 self.perms id)
  
  meta "rewrite_def" predicate protocol_PA_T
  
  function public_PA_T (self: t_LocalInvariant_PA_T) : t_Id
  
  function namespace_PA_T (self: t_LocalInvariant_PA_T) : t_Namespace
  
  let rec new_PA_T'0 (value: t_PA_T) (public: t_Id) (namespace: t_Namespace) (return (x: t_LocalInvariant_PA_T)) =
    {[@expl:new 'value' type invariant] inv_Ghost_PA_T value}
    {[@expl:new requires] protocol_PA_T value public}
    any
    [ return (result: t_LocalInvariant_PA_T) -> {public_PA_T result = public}
      {namespace_PA_T result = namespace}
      (! return {result}) ]
  
  let rec into_inner_LocalInvariant_PA_T (self: t_LocalInvariant_PA_T) (return (x: t_LocalInvariant_PA_T)) = any
    [ return (result: t_LocalInvariant_PA_T) -> {result = self} (! return {result}) ]
  
  type t_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Rc_LocalInvariant_PA_T_Global (_1: t_Rc_LocalInvariant_PA_T_Global)
  
  function view_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) : t_LocalInvariant_PA_T
  
  let rec new_LocalInvariant_PA_T (value: t_LocalInvariant_PA_T) (return (x: t_Rc_LocalInvariant_PA_T_Global)) = any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_Rc_LocalInvariant_PA_T_Global result}
      {view_Rc_LocalInvariant_PA_T_Global result = value}
      (! return {result}) ]
  
  predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global
  
  let rec new_Rc_LocalInvariant_PA_T_Global (x: t_Rc_LocalInvariant_PA_T_Global)
    (return (x'0: t_Rc_LocalInvariant_PA_T_Global)) =
    {[@expl:new 'x' type invariant] inv_Rc_LocalInvariant_PA_T_Global x}
    any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_Ghost_Rc_LocalInvariant_PA_T_Global result}
      {result = x}
      (! return {result}) ]
  
  let rec new_PermCell_Inner_T (value: t_PermCell_Inner_T) (return (x: t_Rc_PermCell_Inner_T_Global)) = any
    [ return (result: t_Rc_PermCell_Inner_T_Global) -> {inv_Rc_PermCell_Inner_T_Global result}
      {view_Rc_PermCell_Inner_T_Global result = value}
      (! return {result}) ]
  
  type t_PersistentArray_T = {
    permcell: t_Rc_PermCell_Inner_T_Global;
    frag: t_Fragment_Id_Seq_T;
    inv: t_Rc_LocalInvariant_PA_T_Global }
  
  predicate invariant_PersistentArray_T (self: t_PersistentArray_T) =
    (view_Fragment_Id_Seq_T self.frag).f0'0 = id_Inner_T (view_Rc_PermCell_Inner_T_Global self.permcell)
    /\ id_Id'0 self.frag = public_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv)
    /\ namespace_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv) = Namespace_PARRAY 0
  
  predicate inv_PersistentArray_T (_1: t_PersistentArray_T)
  
  axiom inv_axiom'7 [@rewrite]: forall x: t_PersistentArray_T [inv_PersistentArray_T x]. inv_PersistentArray_T x
      = (invariant_PersistentArray_T x
      /\ inv_Rc_PermCell_Inner_T_Global x.permcell
      /\ inv_Ghost_Fragment_Id_Seq_T x.frag /\ inv_Ghost_Rc_LocalInvariant_PA_T_Global x.inv)
  
  function view_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) : Seq.seq t_T =
    (view_Fragment_Id_Seq_T self.frag).f1'0
  
  meta "rewrite_def" function view_PersistentArray_T
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec new_T (v: t_Vec_T_Global) (return (x: t_PersistentArray_T)) =
    {[@expl:new 'v' type invariant] inv_Vec_T_Global v}
    (! bb0
    [ bb0 = s0
      [ s0 = [ &seq <- view_Vec_T_Global v ] s1
      | s1 = [ &_10 <- Direct v ] s2
      | s2 = new_Inner_T {_10} (fun (_x: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T) -> [ &_9 <- _x ] s3)
      | s3 = [ &permcell'0 <- _9.f0 ] s4
      | s4 = [ &permcellown <- _9.f1 ] s5
      | s5 = new_Id (fun (_x: t_Authority_Id_Seq_T) -> [ &auth'0 <- _x ] s6)
      | s6 = MutBorrow.borrow_mut <t_Authority_Id_Seq_T> {auth'0}
          (fun (_bor: MutBorrow.t t_Authority_Id_Seq_T) ->
            [ &_17 <- _bor ] -{inv_Ghost_Authority_Id_Seq_T _bor.final}-
            [ &auth'0 <- _bor.final ] s7) [ _ck -> (! {inv_Ghost_Authority_Id_Seq_T auth'0} any) ]
      | s7 = deref_mut_Ghost_Authority_Id_Seq_T {_17} (fun (_x: MutBorrow.t t_Authority_Id_Seq_T) -> [ &_16 <- _x ] s8)
      | s8 = MutBorrow.borrow_final <t_Authority_Id_Seq_T> {_16.current} {MutBorrow.get_id _16}
          (fun (_bor: MutBorrow.t t_Authority_Id_Seq_T) ->
            [ &_15 <- _bor ] -{inv_Authority_Id_Seq_T _bor.final}-
            [ &_16 <- { _16 with current = _bor.final } ] s9) [ _ck -> (! {inv_Authority_Id_Seq_T _16.current} any) ]
      | s9 = insert_Id'0 {_15} {id_Inner_T'0 permcellown} {seq} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_14 <- _x ] s10)
      | s10 = s11 [ _ck -> (! {[@expl:type invariant] inv_ref_Authority_Id_Seq_T _16} any) ]
      | s11 = -{resolve_ref_Authority_Id_Seq_T _16}- s12
      | s12 = new_Fragment_Id_Seq_T {_14} (fun (_x: t_Fragment_Id_Seq_T) -> [ &frag'0 <- _x ] s13)
      | s13 = new_Id'0 (fun (_x: t_FMap_Id_PermCellOwn_Inner_T) -> [ &perms'0 <- _x ] s14)
      | s14 = MutBorrow.borrow_mut <t_FMap_Id_PermCellOwn_Inner_T> {perms'0}
          (fun (_bor: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) ->
            [ &_28 <- _bor ] -{inv_Ghost_FMap_Id_PermCellOwn_Inner_T _bor.final}-
            [ &perms'0 <- _bor.final ] s15) [ _ck -> (! {inv_Ghost_FMap_Id_PermCellOwn_Inner_T perms'0} any) ]
      | s15 = deref_mut_Ghost_FMap_Id_PermCellOwn_Inner_T {_28}
          (fun (_x: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) -> [ &_27 <- _x ] s16)
      | s16 = deref_Ghost_PermCellOwn_Inner_T {permcellown} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_34 <- _x ] s17)
      | s17 = id_ghost_Inner_T {_34} (fun (_x: t_Id) -> [ &_32 <- _x ] s18)
      | s18 = deref_Ghost_Id {_32} (fun (_x: t_Id) -> [ &_30 <- _x ] s19)
      | s19 = into_inner_PermCellOwn_Inner_T {permcellown} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_36 <- _x ] s20)
      | s20 = MutBorrow.borrow_final <t_FMap_Id_PermCellOwn_Inner_T> {_27.current} {MutBorrow.get_id _27}
          (fun (_bor: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) ->
            [ &_26 <- _bor ] -{inv_FMap_Id_PermCellOwn_Inner_T _bor.final}-
            [ &_27 <- { _27 with current = _bor.final } ] s21)
        [ _ck -> (! {inv_FMap_Id_PermCellOwn_Inner_T _27.current} any) ]
      | s21 = insert_ghost_Id {_26} {_30} {_36} (fun (_x: t_Option_PermCellOwn_Inner_T) -> [ &_25 <- _x ] s22)
      | s22 = s23 [ _ck -> (! {[@expl:type invariant] inv_Option_PermCellOwn_Inner_T _25} any) ]
      | s23 = -{resolve_Option_PermCellOwn_Inner_T _25}- s24
      | s24 = s25 [ _ck -> (! {[@expl:type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T _27} any) ]
      | s25 = -{resolve_ref_FMap_Id_PermCellOwn_Inner_T _27}- s26
      | s26 = into_inner_FMap_Id_PermCellOwn_Inner_T {perms'0}
          (fun (_x: t_FMap_Id_PermCellOwn_Inner_T) -> [ &_41 <- _x ] s27)
      | s27 = into_inner_Authority_Id_Seq_T {auth'0} (fun (_x: t_Authority_Id_Seq_T) -> [ &_43 <- _x ] s28)
      | s28 = [ &_40 <- { perms = _41; auth = _43; depth = fun (__0: t_Id) -> 0 } ] s29
      | s29 = new_PA_T {_40} (fun (_x: t_PA_T) -> [ &_39 <- _x ] s30)
      | s30 = new_PA_T'0 {_39} {id_Id'0 frag'0} {Namespace_PARRAY 0}
          (fun (_x: t_LocalInvariant_PA_T) -> [ &local_inv <- _x ] s31)
      | s31 = into_inner_LocalInvariant_PA_T {local_inv} (fun (_x: t_LocalInvariant_PA_T) -> [ &_52 <- _x ] s32)
      | s32 = new_LocalInvariant_PA_T {_52} (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &_23 <- _x ] s33)
      | s33 = new_Rc_LocalInvariant_PA_T_Global {_23}
          (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &inv'0 <- _x ] s34)
      | s34 = new_PermCell_Inner_T {permcell'0} (fun (_x: t_Rc_PermCell_Inner_T_Global) -> [ &_54 <- _x ] s35)
      | s35 = [ &_ret <- { permcell = _54; frag = frag'0; inv = inv'0 } ] s36
      | s36 = return {_ret} ] ]
    [ & _ret: t_PersistentArray_T = Any.any_l ()
    | & v: t_Vec_T_Global = v
    | & seq: Seq.seq t_T = Any.any_l ()
    | & permcell'0: t_PermCell_Inner_T = Any.any_l ()
    | & permcellown: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _9: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T = Any.any_l ()
    | & _10: t_Inner_T = Any.any_l ()
    | & auth'0: t_Authority_Id_Seq_T = Any.any_l ()
    | & frag'0: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _14: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _15: MutBorrow.t t_Authority_Id_Seq_T = Any.any_l ()
    | & _16: MutBorrow.t t_Authority_Id_Seq_T = Any.any_l ()
    | & _17: MutBorrow.t t_Authority_Id_Seq_T = Any.any_l ()
    | & inv'0: t_Rc_LocalInvariant_PA_T_Global = Any.any_l ()
    | & _23: t_Rc_LocalInvariant_PA_T_Global = Any.any_l ()
    | & perms'0: t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _25: t_Option_PermCellOwn_Inner_T = Any.any_l ()
    | & _26: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _27: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _28: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _30: t_Id = Any.any_l ()
    | & _32: t_Id = Any.any_l ()
    | & _34: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _36: t_PermCellOwn_Inner_T = Any.any_l ()
    | & local_inv: t_LocalInvariant_PA_T = Any.any_l ()
    | & _39: t_PA_T = Any.any_l ()
    | & _40: t_PA_T = Any.any_l ()
    | & _41: t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _43: t_Authority_Id_Seq_T = Any.any_l ()
    | & _52: t_LocalInvariant_PA_T = Any.any_l ()
    | & _54: t_Rc_PermCell_Inner_T_Global = Any.any_l () ])
    [ return (result: t_PersistentArray_T) -> {[@expl:new result type invariant] inv_PersistentArray_T result}
      {[@expl:new ensures] view_PersistentArray_T result = view_Vec_T_Global v}
      (! return {result}) ]
end
module M_implementation__impl_PersistentArray_T__set (* implementation::PersistentArray<T> *)
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use seq.Seq
  use creusot.int.UInt64
  use mach.int.Int
  use creusot.prelude.MutBorrow
  use map.Map
  use creusot.prelude.Any
  use set.Set
  
  type t_Rc_PermCell_Inner_T_Global
  
  type t_Fragment_Id_Seq_T
  
  type t_Rc_LocalInvariant_PA_T_Global
  
  type t_PersistentArray_T = {
    permcell: t_Rc_PermCell_Inner_T_Global;
    frag: t_Fragment_Id_Seq_T;
    inv: t_Rc_LocalInvariant_PA_T_Global }
  
  type t_T
  
  type t_Id
  
  type tup2_Id_Seq_T = { f0: t_Id; f1: Seq.seq t_T }
  
  function view_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) : tup2_Id_Seq_T
  
  function view_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) : Seq.seq t_T =
    (view_Fragment_Id_Seq_T self.frag).f1
  
  meta "rewrite_def" function view_PersistentArray_T
  
  predicate inv_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate invariant_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (self: t_Rc_PermCell_Inner_T_Global) =
    inv_Rc_PermCell_Inner_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_PermCell_Inner_T_Global
  
  predicate inv_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (_1: t_Rc_PermCell_Inner_T_Global) =
    invariant_ref_Rc_PermCell_Inner_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_PermCell_Inner_T_Global
  
  let rec clone_Rc_PermCell_Inner_T_Global (self_: t_Rc_PermCell_Inner_T_Global)
    (return (x: t_Rc_PermCell_Inner_T_Global)) =
    {[@expl:clone 'self_' type invariant] inv_ref_Rc_PermCell_Inner_T_Global self_}
    any
    [ return (result: t_Rc_PermCell_Inner_T_Global) -> {inv_Rc_PermCell_Inner_T_Global result}
      {result = self_}
      (! return {result}) ]
  
  type t_Vec_T_Global
  
  type t_Inner_T = Direct t_Vec_T_Global | Link UInt64.t t_T t_Rc_PermCell_Inner_T_Global
  
  type t_PermCell_Inner_T
  
  type t_PermCellOwn_Inner_T
  
  type tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T = { f0'0: t_PermCell_Inner_T; f1'0: t_PermCellOwn_Inner_T }
  
  predicate inv_T (_1: t_T)
  
  predicate invariant_Box_T_Global (self: t_T) = inv_T self
  
  predicate inv_Box_T_Global [@inline:trivial] (_1: t_T) = invariant_Box_T_Global _1
  
  meta "rewrite_def" predicate inv_Box_T_Global
  
  predicate invariant_Seq_T [@inline:trivial] (self: Seq.seq t_T) =
    forall i: int. 0 <= i /\ i < Seq.length self -> inv_Box_T_Global (Seq.get self i)
  
  meta "rewrite_def" predicate invariant_Seq_T
  
  predicate inv_Seq_T [@inline:trivial] (_1: Seq.seq t_T) = invariant_Seq_T _1
  
  meta "rewrite_def" predicate inv_Seq_T
  
  constant const_MAX: UInt64.t = (18446744073709551615: UInt64.t)
  
  function view_Vec_T_Global (self: t_Vec_T_Global) : Seq.seq t_T
  
  axiom view_Vec_T_Global_spec: forall self: t_Vec_T_Global. Seq.length (view_Vec_T_Global self)
      <= UInt64.t'int const_MAX
  
  predicate invariant_Vec_T_Global (self: t_Vec_T_Global) = inv_Seq_T (view_Vec_T_Global self)
  
  predicate inv_Vec_T_Global (_1: t_Vec_T_Global)
  
  axiom inv_axiom: forall x: t_Vec_T_Global [inv_Vec_T_Global x]. inv_Vec_T_Global x -> invariant_Vec_T_Global x
  
  predicate inv_Inner_T (_1: t_Inner_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_Inner_T [inv_Inner_T x]. inv_Inner_T x
      = match x with
        | Direct f0'1 -> inv_Vec_T_Global f0'1
        | Link index value next -> inv_T value /\ inv_Rc_PermCell_Inner_T_Global next
        end
  
  predicate invariant_ref_Inner_T [@inline:trivial] (self: t_Inner_T) = inv_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_Inner_T
  
  predicate inv_ref_Inner_T [@inline:trivial] (_1: t_Inner_T) = invariant_ref_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Inner_T
  
  function val_Inner_T (self: t_PermCellOwn_Inner_T) : t_Inner_T
  
  predicate invariant_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_ref_Inner_T (val_Inner_T self)
  
  meta "rewrite_def" predicate invariant_PermCellOwn_Inner_T
  
  predicate inv_PermCellOwn_Inner_T (_1: t_PermCellOwn_Inner_T)
  
  axiom inv_axiom'1 [@rewrite]: forall x: t_PermCellOwn_Inner_T [inv_PermCellOwn_Inner_T x]. inv_PermCellOwn_Inner_T x
      = invariant_PermCellOwn_Inner_T x
  
  predicate invariant_Ghost_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_Ghost_PermCellOwn_Inner_T
  
  predicate inv_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_Ghost_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_Ghost_PermCellOwn_Inner_T
  
  predicate inv_tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T) =
    inv_Ghost_PermCellOwn_Inner_T _1.f1'0
  
  meta "rewrite_def" predicate inv_tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T
  
  function id_Inner_T (self: t_PermCell_Inner_T) : t_Id
  
  function id_Inner_T'0 (self: t_PermCellOwn_Inner_T) : t_Id
  
  function view_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) : t_Inner_T = val_Inner_T self
  
  meta "rewrite_def" function view_PermCellOwn_Inner_T
  
  let rec new_Inner_T (value: t_Inner_T) (return (x: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T)) =
    {[@expl:new 'value' type invariant] inv_Inner_T value}
    any
    [ return (result: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T) ->
    {inv_tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T result}
      {id_Inner_T result.f0'0 = id_Inner_T'0 result.f1'0}
      {view_PermCellOwn_Inner_T result.f1'0 = value}
      (! return {result}) ]
  
  type t_FMap_Id_PermCellOwn_Inner_T
  
  type t_Authority_Id_Seq_T
  
  type t_PA_T = { perms: t_FMap_Id_PermCellOwn_Inner_T; auth: t_Authority_Id_Seq_T; depth: Map.map t_Id int }
  
  type t_Option_PermCellOwn_Inner_T = None | Some t_PermCellOwn_Inner_T
  
  function view_FMap_Id_PermCellOwn_Inner_T (self: t_FMap_Id_PermCellOwn_Inner_T) : Map.map t_Id t_Option_PermCellOwn_Inner_T
  
  function get_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_Option_PermCellOwn_Inner_T =
    Map.get (view_FMap_Id_PermCellOwn_Inner_T self) k
  
  meta "rewrite_def" function get_Id
  
  predicate contains_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) = get_Id self k <> None
  
  meta "rewrite_def" predicate contains_Id
  
  predicate inv_Id [@inline:trivial] (_1: t_Id) = true
  
  meta "rewrite_def" predicate inv_Id
  
  predicate index_Mapping_PermCellOwn_Inner_T_bool [@inline:trivial] (self: Map.map t_PermCellOwn_Inner_T bool) (a: t_PermCellOwn_Inner_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_PermCellOwn_Inner_T_bool
  
  function such_that_PermCellOwn_Inner_T (p: Map.map t_PermCellOwn_Inner_T bool) : t_PermCellOwn_Inner_T
  
  axiom such_that_PermCellOwn_Inner_T_spec:
    forall p: Map.map t_PermCellOwn_Inner_T bool. (exists x: t_PermCellOwn_Inner_T. index_Mapping_PermCellOwn_Inner_T_bool p x)
      -> index_Mapping_PermCellOwn_Inner_T_bool p (such_that_PermCellOwn_Inner_T p)
  
  function unwrap_Option_PermCellOwn_Inner_T (self: t_Option_PermCellOwn_Inner_T) : t_PermCellOwn_Inner_T =
    match self with
      | Some x -> x
      | None -> such_that_PermCellOwn_Inner_T (fun (__0: t_PermCellOwn_Inner_T) -> true)
      end
  
  function lookup_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_PermCellOwn_Inner_T =
    unwrap_Option_PermCellOwn_Inner_T (get_Id self k)
  
  meta "rewrite_def" function lookup_Id
  
  function index_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) : t_PermCellOwn_Inner_T
   = lookup_Id self key
  
  meta "rewrite_def" function index_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    forall k: t_Id. contains_Id self k -> inv_Id k /\ inv_PermCellOwn_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self k)
  
  meta "rewrite_def" predicate invariant_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_FMap_Id_PermCellOwn_Inner_T (_1: t_FMap_Id_PermCellOwn_Inner_T)
  
  axiom inv_axiom'2 [@rewrite]:
    forall x: t_FMap_Id_PermCellOwn_Inner_T [inv_FMap_Id_PermCellOwn_Inner_T x]. inv_FMap_Id_PermCellOwn_Inner_T x
      = invariant_FMap_Id_PermCellOwn_Inner_T x
  
  predicate invariant_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T)
  
  predicate inv_Authority_Id_Seq_T (_1: t_Authority_Id_Seq_T)
  
  axiom inv_axiom'3: forall x: t_Authority_Id_Seq_T [inv_Authority_Id_Seq_T x]. inv_Authority_Id_Seq_T x
      -> invariant_Authority_Id_Seq_T x
  
  predicate inv_PA_T (_1: t_PA_T)
  
  axiom inv_axiom'4 [@rewrite]: forall x: t_PA_T [inv_PA_T x]. inv_PA_T x
      = (inv_FMap_Id_PermCellOwn_Inner_T x.perms /\ inv_Authority_Id_Seq_T x.auth)
  
  predicate invariant_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) =
    inv_PA_T self.current /\ inv_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_PA_T
  
  predicate inv_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_PA_T
  
  predicate invariant_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_PA_T
  
  predicate inv_Ghost_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_PA_T
  
  predicate invariant_ref_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) = inv_Ghost_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_ref_PA_T
  
  predicate inv_ref_Ghost_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_ref_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_ref_PA_T
  
  predicate invariant_ref_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_ref_PA_T
  
  predicate inv_ref_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_ref_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_ref_PA_T
  
  let rec deref_Ghost_ref_PA_T (self: MutBorrow.t t_PA_T) (return (x: MutBorrow.t t_PA_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_ref_PA_T self}
    any [ return (result: MutBorrow.t t_PA_T) -> {inv_ref_ref_PA_T result} {result = self} (! return {result}) ]
  
  type closure0 = { c0: t_PersistentArray_T; c1: t_PermCell_Inner_T; c2: t_PermCellOwn_Inner_T; c3: Seq.seq t_T }
  
  predicate invariant_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T)
  
  predicate inv_Fragment_Id_Seq_T (_1: t_Fragment_Id_Seq_T)
  
  axiom inv_axiom'5: forall x: t_Fragment_Id_Seq_T [inv_Fragment_Id_Seq_T x]. inv_Fragment_Id_Seq_T x
      -> invariant_Fragment_Id_Seq_T x
  
  predicate invariant_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_Ghost_Fragment_Id_Seq_T
  
  predicate inv_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_Ghost_Fragment_Id_Seq_T
  
  predicate invariant_ref_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) =
    inv_Ghost_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Fragment_Id_Seq_T
  
  predicate inv_ref_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_ref_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Fragment_Id_Seq_T
  
  predicate invariant_ref_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Fragment_Id_Seq_T
  
  predicate inv_ref_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) = invariant_ref_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Fragment_Id_Seq_T
  
  let rec deref_Ghost_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) (return (x: t_Fragment_Id_Seq_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_Fragment_Id_Seq_T self}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_ref_Fragment_Id_Seq_T result} {result = self} (! return {result}) ]
  
  predicate invariant_ref_Authority_Id_Seq_T [@inline:trivial] (self: t_Authority_Id_Seq_T) =
    inv_Authority_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Authority_Id_Seq_T
  
  predicate inv_ref_Authority_Id_Seq_T [@inline:trivial] (_1: t_Authority_Id_Seq_T) =
    invariant_ref_Authority_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Authority_Id_Seq_T
  
  function id_Id (self: t_Authority_Id_Seq_T) : t_Id
  
  function id_Id'0 (self: t_Fragment_Id_Seq_T) : t_Id
  
  type t_FMap_Id_Seq_T
  
  type t_Option_Seq_T = None'0 | Some'0 (Seq.seq t_T)
  
  function view_FMap_Id_Seq_T (self: t_FMap_Id_Seq_T) : Map.map t_Id t_Option_Seq_T
  
  function get_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : t_Option_Seq_T =
    Map.get (view_FMap_Id_Seq_T self) k
  
  meta "rewrite_def" function get_Id'0
  
  function view_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T) : t_FMap_Id_Seq_T
  
  let rec contains_Id'0 (self: t_Authority_Id_Seq_T) (frag'0: t_Fragment_Id_Seq_T) (return (x: ())) =
    {[@expl:contains 'self' type invariant] inv_ref_Authority_Id_Seq_T self}
    {[@expl:contains 'frag' type invariant] inv_ref_Fragment_Id_Seq_T frag'0}
    {[@expl:contains requires] id_Id self = id_Id'0 frag'0}
    any
    [ return (result: ()) -> {get_Id'0 (view_Authority_Id_Seq_T self) (view_Fragment_Id_Seq_T frag'0).f0
      = Some'0 ((view_Fragment_Id_Seq_T frag'0).f1)}
      (! return {result}) ]
  
  let rec id_ghost_Inner_T (self: t_PermCell_Inner_T) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = id_Inner_T self} (! return {result}) ]
  
  let rec into_inner_Id (self: t_Id) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = self} (! return {result}) ]
  
  predicate invariant_ref_Ghost_ref_PA_T'0 [@inline:trivial] (self: MutBorrow.t (MutBorrow.t t_PA_T)) =
    inv_Ghost_ref_PA_T self.current /\ inv_Ghost_ref_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Ghost_ref_PA_T'0
  
  predicate inv_ref_Ghost_ref_PA_T'0 [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) =
    invariant_ref_Ghost_ref_PA_T'0 _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_ref_PA_T'0
  
  predicate invariant_ref_ref_PA_T'0 [@inline:trivial] (self: MutBorrow.t (MutBorrow.t t_PA_T)) =
    inv_ref_PA_T self.current /\ inv_ref_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_ref_PA_T'0
  
  predicate inv_ref_ref_PA_T'0 [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) = invariant_ref_ref_PA_T'0 _1
  
  meta "rewrite_def" predicate inv_ref_ref_PA_T'0
  
  let rec deref_mut_Ghost_ref_PA_T (self: MutBorrow.t (MutBorrow.t t_PA_T))
    (return (x: MutBorrow.t (MutBorrow.t t_PA_T))) =
    {[@expl:deref_mut 'self' type invariant] inv_ref_Ghost_ref_PA_T'0 self}
    any
    [ return (result: MutBorrow.t (MutBorrow.t t_PA_T)) -> {inv_ref_ref_PA_T'0 result}
      {result = self}
      (! return {result}) ]
  
  type t_Option_ref_PermCellOwn_Inner_T = None'1 | Some'1 (MutBorrow.t t_PermCellOwn_Inner_T)
  
  predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    inv_FMap_Id_PermCellOwn_Inner_T self.current /\ inv_FMap_Id_PermCellOwn_Inner_T self.final
  
  meta "rewrite_def" predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    invariant_ref_FMap_Id_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_ref_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self.current /\ inv_PermCellOwn_Inner_T self.final
  
  meta "rewrite_def" predicate invariant_ref_PermCellOwn_Inner_T
  
  predicate inv_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_PermCellOwn_Inner_T) =
    invariant_ref_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_PermCellOwn_Inner_T
  
  predicate inv_Option_ref_PermCellOwn_Inner_T (_1: t_Option_ref_PermCellOwn_Inner_T)
  
  axiom inv_axiom'6 [@rewrite]:
    forall x: t_Option_ref_PermCellOwn_Inner_T [inv_Option_ref_PermCellOwn_Inner_T x]. inv_Option_ref_PermCellOwn_Inner_T x
      = match x with
        | None'1 -> true
        | Some'1 f0'1 -> inv_ref_PermCellOwn_Inner_T f0'1
        end
  
  function len_Id (self: t_FMap_Id_PermCellOwn_Inner_T) : int
  
  axiom len_Id_spec: forall self: t_FMap_Id_PermCellOwn_Inner_T. len_Id self >= 0
  
  let rec get_mut_ghost_Id (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id)
    (return (x: t_Option_ref_PermCellOwn_Inner_T)) =
    {[@expl:get_mut_ghost 'self' type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T self}
    any
    [ return (result: t_Option_ref_PermCellOwn_Inner_T) -> {inv_Option_ref_PermCellOwn_Inner_T result}
      {if contains_Id self.current key then
        match result with
          | None'1 -> false
          | Some'1 r -> contains_Id self.final key
          /\ index_FMap_Id_PermCellOwn_Inner_T self.current key = r.current
          /\ index_FMap_Id_PermCellOwn_Inner_T self.final key = r.final
          end
      else
        result = None'1 /\ self.current = self.final
      }
      {forall k: t_Id. k <> key -> get_Id self.current k = get_Id self.final k}
      {len_Id self.current = len_Id self.final}
      (! return {result}) ]
  
  predicate resolve_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_PermCellOwn_Inner_T) =
    _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_PermCellOwn_Inner_T
  
  predicate resolve_ref_ref_PA_T [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_ref_PA_T
  
  let rec elim_Some (_x: t_Option_ref_PermCellOwn_Inner_T) (return (f0'1: MutBorrow.t t_PermCellOwn_Inner_T)) = any
    [ _k (f0'1: MutBorrow.t t_PermCellOwn_Inner_T) -> {Some'1 f0'1 = _x} (! return {f0'1})
    | _chk -> (! {match _x with
        | Some'1 _ -> true
        | _ -> false
        end}
      any) ]
  
  predicate invariant_ref_Ghost_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_Ghost_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_PermCellOwn_Inner_T
  
  predicate inv_ref_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_ref_Ghost_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_PermCellOwn_Inner_T
  
  predicate invariant_ref_PermCellOwn_Inner_T'0 [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_PermCellOwn_Inner_T'0
  
  predicate inv_ref_PermCellOwn_Inner_T'0 [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_ref_PermCellOwn_Inner_T'0 _1
  
  meta "rewrite_def" predicate inv_ref_PermCellOwn_Inner_T'0
  
  let rec deref_Ghost_PermCellOwn_Inner_T (self: t_PermCellOwn_Inner_T) (return (x: t_PermCellOwn_Inner_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_PermCellOwn_Inner_T self}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_ref_PermCellOwn_Inner_T'0 result}
      {result = self}
      (! return {result}) ]
  
  let rec disjoint_lemma_Inner_T (own1: MutBorrow.t t_PermCellOwn_Inner_T) (own2: t_PermCellOwn_Inner_T)
    (return (x: ())) = {[@expl:disjoint_lemma 'own1' type invariant] inv_ref_PermCellOwn_Inner_T own1}
    {[@expl:disjoint_lemma 'own2' type invariant] inv_ref_PermCellOwn_Inner_T'0 own2}
    any
    [ return (result: ()) -> {id_Inner_T'0 own1.current <> id_Inner_T'0 own2}
      {own1.current = own1.final}
      (! return {result}) ]
  
  let rec into_inner_PermCellOwn_Inner_T (self: t_PermCellOwn_Inner_T) (return (x: t_PermCellOwn_Inner_T)) =
    {[@expl:into_inner 'self' type invariant] inv_Ghost_PermCellOwn_Inner_T self}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_PermCellOwn_Inner_T result} {result = self} (! return {result}) ]
  
  predicate inv_Option_PermCellOwn_Inner_T (_1: t_Option_PermCellOwn_Inner_T)
  
  axiom inv_axiom'7 [@rewrite]:
    forall x: t_Option_PermCellOwn_Inner_T [inv_Option_PermCellOwn_Inner_T x]. inv_Option_PermCellOwn_Inner_T x
      = match x with
        | None -> true
        | Some f0'1 -> inv_PermCellOwn_Inner_T f0'1
        end
  
  function insert_Id (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) (v: t_PermCellOwn_Inner_T) : t_FMap_Id_PermCellOwn_Inner_T
  
  axiom insert_Id_spec:
    forall self: t_FMap_Id_PermCellOwn_Inner_T, k: t_Id, v: t_PermCellOwn_Inner_T. view_FMap_Id_PermCellOwn_Inner_T (insert_Id self k v)
      = Map.set (view_FMap_Id_PermCellOwn_Inner_T self) k (Some v)
  
  axiom insert_Id_spec'0:
    forall self: t_FMap_Id_PermCellOwn_Inner_T, k: t_Id, v: t_PermCellOwn_Inner_T. len_Id (insert_Id self k v)
      = (if contains_Id self k then len_Id self else len_Id self + 1)
  
  let rec insert_ghost_Id (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) (value: t_PermCellOwn_Inner_T)
    (return (x: t_Option_PermCellOwn_Inner_T)) =
    {[@expl:insert_ghost 'self' type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T self}
    {[@expl:insert_ghost 'value' type invariant] inv_PermCellOwn_Inner_T value}
    any
    [ return (result: t_Option_PermCellOwn_Inner_T) -> {inv_Option_PermCellOwn_Inner_T result}
      {self.final = insert_Id self.current key value}
      {result = get_Id self.current key}
      (! return {result}) ]
  
  predicate resolve_ref_Inner_T [@inline:trivial] (_1: t_Inner_T) = true
  
  meta "rewrite_def" predicate resolve_ref_Inner_T
  
  predicate resolve_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    resolve_ref_Inner_T (val_Inner_T self)
  
  meta "rewrite_def" predicate resolve_PermCellOwn_Inner_T
  
  predicate resolve_PermCellOwn_Inner_T'0 (_1: t_PermCellOwn_Inner_T)
  
  axiom resolve_axiom:
    forall x: t_PermCellOwn_Inner_T [resolve_PermCellOwn_Inner_T'0 x]. resolve_PermCellOwn_Inner_T'0 x
      -> resolve_PermCellOwn_Inner_T x
  
  predicate resolve_Option_PermCellOwn_Inner_T (_1: t_Option_PermCellOwn_Inner_T)
  
  axiom resolve_axiom'0 [@rewrite]:
    forall x: t_Option_PermCellOwn_Inner_T [resolve_Option_PermCellOwn_Inner_T x]. resolve_Option_PermCellOwn_Inner_T x
      = match x with
        | None -> true
        | Some x0 -> resolve_PermCellOwn_Inner_T'0 x0
        end
  
  function index_Mapping_Id_Int [@inline:trivial] (self: Map.map t_Id int) (a: t_Id) : int = Map.get self a
  
  meta "rewrite_def" function index_Mapping_Id_Int
  
  function view_Rc_PermCell_Inner_T_Global (self: t_Rc_PermCell_Inner_T_Global) : t_PermCell_Inner_T
  
  predicate invariant_ref_Authority_Id_Seq_T'0 [@inline:trivial] (self: MutBorrow.t t_Authority_Id_Seq_T) =
    inv_Authority_Id_Seq_T self.current /\ inv_Authority_Id_Seq_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Authority_Id_Seq_T'0
  
  predicate inv_ref_Authority_Id_Seq_T'0 [@inline:trivial] (_1: MutBorrow.t t_Authority_Id_Seq_T) =
    invariant_ref_Authority_Id_Seq_T'0 _1
  
  meta "rewrite_def" predicate inv_ref_Authority_Id_Seq_T'0
  
  predicate contains_Id'1 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) = get_Id'0 self k <> None'0
  
  meta "rewrite_def" predicate contains_Id'1
  
  function len_Id'0 (self: t_FMap_Id_Seq_T) : int
  
  axiom len_Id_spec'0: forall self: t_FMap_Id_Seq_T. len_Id'0 self >= 0
  
  function insert_Id'0 (self: t_FMap_Id_Seq_T) (k: t_Id) (v: Seq.seq t_T) : t_FMap_Id_Seq_T
  
  axiom insert_Id_spec'1:
    forall self: t_FMap_Id_Seq_T, k: t_Id, v: Seq.seq t_T. view_FMap_Id_Seq_T (insert_Id'0 self k v)
      = Map.set (view_FMap_Id_Seq_T self) k (Some'0 v)
  
  axiom insert_Id_spec'2: forall self: t_FMap_Id_Seq_T, k: t_Id, v: Seq.seq t_T. len_Id'0 (insert_Id'0 self k v)
      = (if contains_Id'1 self k then len_Id'0 self else len_Id'0 self + 1)
  
  let rec insert_Id'1 (self: MutBorrow.t t_Authority_Id_Seq_T) (k: t_Id) (v: Seq.seq t_T)
    (return (x: t_Fragment_Id_Seq_T)) = {[@expl:insert 'self' type invariant] inv_ref_Authority_Id_Seq_T'0 self}
    {[@expl:insert requires] not contains_Id'1 (view_Authority_Id_Seq_T self.current) k}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Fragment_Id_Seq_T result}
      {view_Authority_Id_Seq_T self.final = insert_Id'0 (view_Authority_Id_Seq_T self.current) k v}
      {id_Id self.final = id_Id self.current}
      {view_Fragment_Id_Seq_T result = { f0 = k; f1 = v }}
      {id_Id'0 result = id_Id self.current}
      (! return {result}) ]
  
  predicate resolve_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_PA_T
  
  predicate resolve_Ghost_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = resolve_ref_PA_T _1
  
  meta "rewrite_def" predicate resolve_Ghost_ref_PA_T
  
  let rec new_Fragment_Id_Seq_T (x: t_Fragment_Id_Seq_T) (return (x'0: t_Fragment_Id_Seq_T)) =
    {[@expl:new 'x' type invariant] inv_Fragment_Id_Seq_T x}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Ghost_Fragment_Id_Seq_T result} {result = x} (! return {result}) ]
  
  type t_LocalInvariant_PA_T
  
  function public_PA_T (self: t_LocalInvariant_PA_T) : t_Id
  
  function view_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) : t_LocalInvariant_PA_T
  
  function namespace_PA_T (self: t_LocalInvariant_PA_T) : t_Namespace
  
  predicate invariant_PersistentArray_T (self: t_PersistentArray_T) =
    (view_Fragment_Id_Seq_T self.frag).f0 = id_Inner_T (view_Rc_PermCell_Inner_T_Global self.permcell)
    /\ id_Id'0 self.frag = public_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv)
    /\ namespace_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv) = Namespace_PARRAY 0
  
  predicate inv_Rc_LocalInvariant_PA_T_Global (_1: t_Rc_LocalInvariant_PA_T_Global)
  
  predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_PersistentArray_T (_1: t_PersistentArray_T)
  
  axiom inv_axiom'8 [@rewrite]: forall x: t_PersistentArray_T [inv_PersistentArray_T x]. inv_PersistentArray_T x
      = (invariant_PersistentArray_T x
      /\ inv_Rc_PermCell_Inner_T_Global x.permcell
      /\ inv_Ghost_Fragment_Id_Seq_T x.frag /\ inv_Ghost_Rc_LocalInvariant_PA_T_Global x.inv)
  
  predicate invariant_ref_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) = inv_PersistentArray_T self
  
  meta "rewrite_def" predicate invariant_ref_PersistentArray_T
  
  predicate inv_ref_PersistentArray_T [@inline:trivial] (_1: t_PersistentArray_T) = invariant_ref_PersistentArray_T _1
  
  meta "rewrite_def" predicate inv_ref_PersistentArray_T
  
  predicate inv_closure0 [@inline:trivial] (_1: closure0) =
    let {c0 = x0; c1 = x1; c2 = x2; c3 = x3} = _1 in inv_ref_PersistentArray_T x0 /\ inv_Ghost_PermCellOwn_Inner_T x2
  
  meta "rewrite_def" predicate inv_closure0
  
  let rec closure0 [@coma:extspec] (self: closure0) (pa: MutBorrow.t t_PA_T) (return (x: t_Fragment_Id_Seq_T)) = bb0
    [ bb0 = s0
      [ s0 = deref_Ghost_ref_PA_T {pa} (fun (_x: MutBorrow.t t_PA_T) -> [ &_6 <- _x ] s1)
      | s1 = [ &_11 <- self.c0.frag ] s2
      | s2 = deref_Ghost_Fragment_Id_Seq_T {_11} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_9 <- _x ] s3)
      | s3 = contains_Id'0 {_6.current.auth} {_9} (fun (_x: ()) -> [ &_4 <- _x ] s4)
      | s4 = id_ghost_Inner_T {self.c1} (fun (_x: t_Id) -> [ &_13 <- _x ] s5)
      | s5 = into_inner_Id {_13} (fun (_x: t_Id) -> [ &cell_id <- _x ] s6)
      | s6 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_19 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s7) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s7 = deref_mut_Ghost_ref_PA_T {_19} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_18 <- _x ] s8)
      | s8 = [ &_21 <- cell_id ] s9
      | s9 = MutBorrow.borrow_mut <t_FMap_Id_PermCellOwn_Inner_T> {_18.current.current.perms}
          (fun (_bor: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) ->
            [ &_17 <- _bor ] -{inv_FMap_Id_PermCellOwn_Inner_T _bor.final}-
            [ &_18 <- { _18 with current = { _18.current with current = { _18.current.current with perms = _bor.final } } } ]
            s10) [ _ck -> (! {inv_FMap_Id_PermCellOwn_Inner_T _18.current.current.perms} any) ]
      | s10 = get_mut_ghost_Id {_17} {_21} (fun (_x: t_Option_ref_PermCellOwn_Inner_T) -> [ &_16 <- _x ] s11)
      | s11 = any
        [ br0 -> {_16 = None'1} (! bb12) | br1 (x0: MutBorrow.t t_PermCellOwn_Inner_T) -> {_16 = Some'1 x0} (! bb9) ] ]
    | bb12 = s0
      [ s0 = s1
        [ _ck -> (! {[@expl:type invariant] match _16 with
            | Some'1 x -> inv_ref_PermCellOwn_Inner_T x
            | _ -> true
            end}
          any) ]
      | s1 = -{match _16 with
          | Some'1 x -> resolve_ref_PermCellOwn_Inner_T x
          | _ -> true
          end}-
        s2
      | s2 = s3 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T'0 _18} any) ]
      | s3 = -{resolve_ref_ref_PA_T _18}- s4
      | s4 = bb13 ]
    | bb9 = s0
      [ s0 = elim_Some {_16} (fun (r0: MutBorrow.t t_PermCellOwn_Inner_T) -> [ &other <- r0 ] s1)
      | s1 = [ &_29 <- self.c2 ] s2
      | s2 = deref_Ghost_PermCellOwn_Inner_T {_29} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_27 <- _x ] s3)
      | s3 = MutBorrow.borrow_final <t_PermCellOwn_Inner_T> {other.current} {MutBorrow.get_id other}
          (fun (_bor: MutBorrow.t t_PermCellOwn_Inner_T) ->
            [ &_25 <- _bor ] -{inv_PermCellOwn_Inner_T _bor.final}-
            [ &other <- { other with current = _bor.final } ] s4)
        [ _ck -> (! {inv_PermCellOwn_Inner_T other.current} any) ]
      | s4 = disjoint_lemma_Inner_T {_25} {_27} (fun (_x: ()) -> [ &_24 <- _x ] s5)
      | s5 = s6 [ _ck -> (! {[@expl:type invariant] inv_ref_PermCellOwn_Inner_T other} any) ]
      | s6 = -{resolve_ref_PermCellOwn_Inner_T other}- s7
      | s7 = s8 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T'0 _18} any) ]
      | s8 = -{resolve_ref_ref_PA_T _18}- s9
      | s9 = bb13 ]
    | bb13 = s0
      [ s0 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_33 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s1) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s1 = deref_mut_Ghost_ref_PA_T {_33} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_32 <- _x ] s2)
      | s2 = into_inner_PermCellOwn_Inner_T {self.c2} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_35 <- _x ] s3)
      | s3 = MutBorrow.borrow_mut <t_FMap_Id_PermCellOwn_Inner_T> {_32.current.current.perms}
          (fun (_bor: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) ->
            [ &_31 <- _bor ] -{inv_FMap_Id_PermCellOwn_Inner_T _bor.final}-
            [ &_32 <- { _32 with current = { _32.current with current = { _32.current.current with perms = _bor.final } } } ]
            s4) [ _ck -> (! {inv_FMap_Id_PermCellOwn_Inner_T _32.current.current.perms} any) ]
      | s4 = insert_ghost_Id {_31} {cell_id} {_35} (fun (_x: t_Option_PermCellOwn_Inner_T) -> [ &_30 <- _x ] s5)
      | s5 = s6 [ _ck -> (! {[@expl:type invariant] inv_Option_PermCellOwn_Inner_T _30} any) ]
      | s6 = -{resolve_Option_PermCellOwn_Inner_T _30}- s7
      | s7 = s8 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T'0 _32} any) ]
      | s8 = -{resolve_ref_ref_PA_T _32}- s9
      | s9 =
        [ &_37 <- Map.set pa.current.depth cell_id (index_Mapping_Id_Int pa.current.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global self.c0.permcell))
        + 1) ] s10
      | s10 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_43 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s11) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s11 = deref_mut_Ghost_ref_PA_T {_43} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_42 <- _x ] s12)
      | s12 = [ &_42 <- { _42 with current = { _42.current with current = { _42.current.current with depth = _37 } } } ]
        s13
      | s13 = s14 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T'0 _42} any) ]
      | s14 = -{resolve_ref_ref_PA_T _42}- s15
      | s15 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_46 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s16) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s16 = deref_mut_Ghost_ref_PA_T {_46} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_45 <- _x ] s17)
      | s17 = MutBorrow.borrow_mut <t_Authority_Id_Seq_T> {_45.current.current.auth}
          (fun (_bor: MutBorrow.t t_Authority_Id_Seq_T) ->
            [ &_44 <- _bor ] -{inv_Authority_Id_Seq_T _bor.final}-
            [ &_45 <- { _45 with current = { _45.current with current = { _45.current.current with auth = _bor.final } } } ]
            s18) [ _ck -> (! {inv_Authority_Id_Seq_T _45.current.current.auth} any) ]
      | s18 = insert_Id'1 {_44} {cell_id} {self.c3} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_3 <- _x ] s19)
      | s19 = s20 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T'0 _45} any) ]
      | s20 = -{resolve_ref_ref_PA_T _45}- s21
      | s21 = s22 [ _ck -> (! {[@expl:type invariant] inv_Ghost_ref_PA_T pa} any) ]
      | s22 = -{resolve_Ghost_ref_PA_T pa}- s23
      | s23 = new_Fragment_Id_Seq_T {_3} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_ret <- _x ] s24)
      | s24 = return {_ret} ] ]
    [ & _ret: t_Fragment_Id_Seq_T = Any.any_l ()
    | & self: closure0 = self
    | & pa: MutBorrow.t t_PA_T = pa
    | & _3: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _4: () = Any.any_l ()
    | & _6: MutBorrow.t t_PA_T = Any.any_l ()
    | & _9: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _11: t_Fragment_Id_Seq_T = Any.any_l ()
    | & cell_id: t_Id = Any.any_l ()
    | & _13: t_Id = Any.any_l ()
    | & _16: t_Option_ref_PermCellOwn_Inner_T = Any.any_l ()
    | & _17: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _18: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _19: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _21: t_Id = Any.any_l ()
    | & other: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _24: () = Any.any_l ()
    | & _25: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _27: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _29: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _30: t_Option_PermCellOwn_Inner_T = Any.any_l ()
    | & _31: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _32: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _33: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _35: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _37: Map.map t_Id int = Any.any_l ()
    | & _42: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _43: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _44: MutBorrow.t t_Authority_Id_Seq_T = Any.any_l ()
    | & _45: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _46: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l () ]
  
  meta "rewrite_def" predicate closure0'pre
  
  meta "rewrite_def" predicate closure0'post'return
  
  type t_Tokens
  
  predicate invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Ghost_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global
  
  type tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0 = {
    f0'1: t_Rc_LocalInvariant_PA_T_Global;
    f1'1: t_Tokens;
    f2'1: closure0 }
  
  predicate invariant_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_ref_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate invariant_Ghost_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_ref_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Ghost_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_Ghost_ref_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate precondition_deref [@inline:trivial] (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) =
    let self_ = args in inv_ref_Rc_LocalInvariant_PA_T_Global self_
  
  meta "rewrite_def" predicate precondition_deref
  
  predicate postcondition_once_deref [@inline:trivial] (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (result: t_LocalInvariant_PA_T) =
    let self_ = args in result = view_Rc_LocalInvariant_PA_T_Global self_
  
  meta "rewrite_def" predicate postcondition_once_deref
  
  predicate resolve_deref [@inline:trivial] (_1: ()) = true
  
  meta "rewrite_def" predicate resolve_deref
  
  predicate postcondition_mut_deref [@inline:trivial] (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (result_state: ()) (result: t_LocalInvariant_PA_T) =
    let self_ = args in result = view_Rc_LocalInvariant_PA_T_Global self_
  
  meta "rewrite_def" predicate postcondition_mut_deref
  
  function fn_mut_once_deref (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (res: t_LocalInvariant_PA_T) : ()
  
  axiom fn_mut_once_deref_spec:
    forall self: (), args: t_Rc_LocalInvariant_PA_T_Global, res: t_LocalInvariant_PA_T. postcondition_once_deref self args res
      = (exists res_state: (). postcondition_mut_deref self args res_state res /\ resolve_deref res_state)
  
  predicate hist_inv_deref [@inline:trivial] (self: ()) (result_state: ()) = true
  
  meta "rewrite_def" predicate hist_inv_deref
  
  function hist_inv_trans_deref (self: ()) (b: ()) (c: ()) : ()
  
  axiom hist_inv_trans_deref_spec: forall self: (), b: (), c: (). hist_inv_deref self b
      -> hist_inv_deref b c -> hist_inv_deref self c
  
  function hist_inv_refl_deref (self: ()) : ()
  
  axiom hist_inv_refl_deref_spec: forall self: (). hist_inv_deref self self
  
  function postcondition_mut_hist_inv_deref (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (res_state: ()) (res: t_LocalInvariant_PA_T) : ()
  
  axiom postcondition_mut_hist_inv_deref_spec:
    forall self: (), args: t_Rc_LocalInvariant_PA_T_Global, res_state: (), res: t_LocalInvariant_PA_T. postcondition_mut_deref self args res_state res
      -> hist_inv_deref self res_state
  
  function fn_hist_inv_deref (self: ()) (res_state: ()) : ()
  
  axiom fn_hist_inv_deref_spec: forall self: (), res_state: (). hist_inv_deref self res_state = (self = res_state)
  
  predicate postcondition_deref [@inline:trivial] (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (result: t_LocalInvariant_PA_T) =
    let self_ = args in result = view_Rc_LocalInvariant_PA_T_Global self_
  
  meta "rewrite_def" predicate postcondition_deref
  
  function fn_once_deref (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (res: t_LocalInvariant_PA_T) : ()
  
  axiom fn_once_deref_spec:
    forall self: (), args: t_Rc_LocalInvariant_PA_T_Global, res: t_LocalInvariant_PA_T. postcondition_once_deref self args res
      = (postcondition_deref self args res /\ resolve_deref self)
  
  function fn_mut_deref (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (res_state: ()) (res: t_LocalInvariant_PA_T) : ()
  
  axiom fn_mut_deref_spec:
    forall self: (), args: t_Rc_LocalInvariant_PA_T_Global, res_state: (), res: t_LocalInvariant_PA_T. postcondition_mut_deref self args res_state res
      = (postcondition_deref self args res /\ self = res_state)
  
  type tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0 = {
    f0'2: t_LocalInvariant_PA_T;
    f1'2: t_Tokens;
    f2'2: closure0 }
  
  predicate contains_Namespace [@inline:trivial] (self: Set.set t_Namespace) (e: t_Namespace) = Set.mem e self
  
  meta "rewrite_def" predicate contains_Namespace
  
  function namespaces (self: t_Tokens) : Set.set t_Namespace
  
  predicate contains (self: t_Tokens) (namespace: t_Namespace) = contains_Namespace (namespaces self) namespace
  
  predicate index_Mapping_Seq_T_bool [@inline:trivial] (self: Map.map (Seq.seq t_T) bool) (a: Seq.seq t_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_Seq_T_bool
  
  function such_that_Seq_T (p: Map.map (Seq.seq t_T) bool) : Seq.seq t_T
  
  axiom such_that_Seq_T_spec:
    forall p: Map.map (Seq.seq t_T) bool. (exists x: Seq.seq t_T. index_Mapping_Seq_T_bool p x)
      -> index_Mapping_Seq_T_bool p (such_that_Seq_T p)
  
  function unwrap_Option_Seq_T (self: t_Option_Seq_T) : Seq.seq t_T = match self with
      | Some'0 x -> x
      | None'0 -> such_that_Seq_T (fun (__0: Seq.seq t_T) -> true)
      end
  
  function lookup_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : Seq.seq t_T =
    unwrap_Option_Seq_T (get_Id'0 self k)
  
  meta "rewrite_def" function lookup_Id'0
  
  function index_FMap_Id_Seq_T [@inline:trivial] (self: t_FMap_Id_Seq_T) (key: t_Id) : Seq.seq t_T =
    lookup_Id'0 self key
  
  meta "rewrite_def" function index_FMap_Id_Seq_T
  
  predicate partial_invariant_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    id_Id self.auth = resource_id
    /\ (forall id: t_Id. contains_Id'1 (view_Authority_Id_Seq_T self.auth) id /\ contains_Id self.perms id
      -> id_Inner_T'0 (index_FMap_Id_PermCellOwn_Inner_T self.perms id) = id
      /\ match val_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self.perms id) with
        | Direct v -> index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id = view_Vec_T_Global v
        | Link index value next -> contains_Id'1 (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))
        /\ index_Mapping_Id_Int self.depth id
          > index_Mapping_Id_Int self.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))
        /\ UInt64.t'int index
          < Seq.length (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next)))
        /\ index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id
        = Seq.set (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))) (UInt64.t'int index) value
        end)
  
  meta "rewrite_def" predicate partial_invariant_T
  
  predicate protocol_PA_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    partial_invariant_T self resource_id
    /\ (forall id: t_Id. contains_Id'1 (view_Authority_Id_Seq_T self.auth) id -> contains_Id self.perms id)
  
  meta "rewrite_def" predicate protocol_PA_T
  
  predicate precondition_closure0 [@inline:trivial] (self: closure0) (args: MutBorrow.t t_PA_T) =
    let pa = args in closure0'pre self pa
  
  meta "rewrite_def" predicate precondition_closure0
  
  predicate postcondition_once_closure0 [@inline:trivial] (self: closure0) (args: MutBorrow.t t_PA_T) (result: t_Fragment_Id_Seq_T) =
    let pa = args in closure0'post'return self pa result
  
  meta "rewrite_def" predicate postcondition_once_closure0
  
  function fin_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) : t_PA_T = self.final
  
  meta "rewrite_def" function fin_Ghost_ref_PA_T
  
  predicate precondition_open [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) =
    let {f0'2 = self'0; f1'2 = tokens; f2'2 = f} = args in inv_closure0 f
    /\ contains tokens (namespace_PA_T self'0)
    /\ (forall t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self'0) /\ inv_Ghost_ref_PA_T t
      -> precondition_closure0 f t
      /\ (forall res: t_Fragment_Id_Seq_T. postcondition_once_closure0 f t res
        -> protocol_PA_T (fin_Ghost_ref_PA_T t) (public_PA_T self'0)))
  
  meta "rewrite_def" predicate precondition_open
  
  function new_ref_LocalInvariant_PA_T (x: t_LocalInvariant_PA_T) : t_LocalInvariant_PA_T
  
  axiom new_ref_LocalInvariant_PA_T_spec: forall x: t_LocalInvariant_PA_T. new_ref_LocalInvariant_PA_T x = x
  
  predicate precondition_open'0 [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) =
    let {f0'1 = self'0; f1'1 = tokens; f2'1 = f} = args in inv_Ghost_ref_Rc_LocalInvariant_PA_T_Global self'0
    /\ inv_closure0 f
    /\ precondition_deref () self'0
    /\ (forall this: t_LocalInvariant_PA_T. postcondition_deref () self'0 this
      -> precondition_open () { f0'2 = new_ref_LocalInvariant_PA_T this; f1'2 = tokens; f2'2 = f })
  
  meta "rewrite_def" predicate precondition_open'0
  
  let rec deref_Rc_LocalInvariant_PA_T_Global (self_: t_Rc_LocalInvariant_PA_T_Global)
    (return (x: t_LocalInvariant_PA_T)) =
    {[@expl:deref 'self_' type invariant] inv_ref_Rc_LocalInvariant_PA_T_Global self_}
    any
    [ return (result: t_LocalInvariant_PA_T) -> {result = view_Rc_LocalInvariant_PA_T_Global self_}
      (! return {result}) ]
  
  let rec open_Ghost_ref_LocalInvariant_PA_T (self: t_LocalInvariant_PA_T) (tokens: t_Tokens) (f: closure0)
    (return (x: t_Fragment_Id_Seq_T)) = {[@expl:open 'f' type invariant] inv_closure0 f}
    {[@expl:open requires #0] contains tokens (namespace_PA_T self)}
    {[@expl:open requires #1] forall t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self)
        /\ inv_Ghost_ref_PA_T t
      -> precondition_closure0 f t
      /\ (forall res: t_Fragment_Id_Seq_T. postcondition_once_closure0 f t res
        -> protocol_PA_T (fin_Ghost_ref_PA_T t) (public_PA_T self))}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Ghost_Fragment_Id_Seq_T result}
      {exists t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self)
        /\ postcondition_once_closure0 f t result}
      (! return {result}) ]
  
  predicate postcondition_once_open [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (result: t_Fragment_Id_Seq_T) =
    let {f0'2 = self'0; f1'2 = tokens; f2'2 = f} = args in inv_Ghost_Fragment_Id_Seq_T result
    /\ (exists t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self'0)
      /\ postcondition_once_closure0 f t result)
  
  meta "rewrite_def" predicate postcondition_once_open
  
  predicate resolve_open [@inline:trivial] (_1: ()) = true
  
  meta "rewrite_def" predicate resolve_open
  
  predicate postcondition_mut_open [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (result_state: ()) (result: t_Fragment_Id_Seq_T) =
    let {f0'2 = self'0; f1'2 = tokens; f2'2 = f} = args in inv_Ghost_Fragment_Id_Seq_T result
    /\ (exists t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self'0)
      /\ postcondition_once_closure0 f t result)
  
  meta "rewrite_def" predicate postcondition_mut_open
  
  function fn_mut_once_open (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (res: t_Fragment_Id_Seq_T) : ()
  
  axiom fn_mut_once_open_spec:
    forall self: (), args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0, res: t_Fragment_Id_Seq_T. postcondition_once_open self args res
      = (exists res_state: (). postcondition_mut_open self args res_state res /\ resolve_open res_state)
  
  predicate hist_inv_open [@inline:trivial] (self: ()) (result_state: ()) = true
  
  meta "rewrite_def" predicate hist_inv_open
  
  function hist_inv_trans_open (self: ()) (b: ()) (c: ()) : ()
  
  axiom hist_inv_trans_open_spec: forall self: (), b: (), c: (). hist_inv_open self b
      -> hist_inv_open b c -> hist_inv_open self c
  
  function hist_inv_refl_open (self: ()) : ()
  
  axiom hist_inv_refl_open_spec: forall self: (). hist_inv_open self self
  
  function postcondition_mut_hist_inv_open (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (res_state: ()) (res: t_Fragment_Id_Seq_T) : ()
  
  axiom postcondition_mut_hist_inv_open_spec:
    forall self: (), args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0, res_state: (), res: t_Fragment_Id_Seq_T. postcondition_mut_open self args res_state res
      -> hist_inv_open self res_state
  
  function fn_hist_inv_open (self: ()) (res_state: ()) : ()
  
  axiom fn_hist_inv_open_spec: forall self: (), res_state: (). hist_inv_open self res_state = (self = res_state)
  
  predicate postcondition_open [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (result: t_Fragment_Id_Seq_T) =
    let {f0'2 = self'0; f1'2 = tokens; f2'2 = f} = args in inv_Ghost_Fragment_Id_Seq_T result
    /\ (exists t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self'0)
      /\ postcondition_once_closure0 f t result)
  
  meta "rewrite_def" predicate postcondition_open
  
  function fn_once_open (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (res: t_Fragment_Id_Seq_T) : ()
  
  axiom fn_once_open_spec:
    forall self: (), args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0, res: t_Fragment_Id_Seq_T. postcondition_once_open self args res
      = (postcondition_open self args res /\ resolve_open self)
  
  function fn_mut_open (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (res_state: ()) (res: t_Fragment_Id_Seq_T) : ()
  
  axiom fn_mut_open_spec:
    forall self: (), args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0, res_state: (), res: t_Fragment_Id_Seq_T. postcondition_mut_open self args res_state res
      = (postcondition_open self args res /\ self = res_state)
  
  let rec open_Ghost_ref_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) (tokens: t_Tokens)
    (f: closure0) (return (x: t_Fragment_Id_Seq_T)) =
    {[@expl:open 'self' type invariant] inv_Ghost_ref_Rc_LocalInvariant_PA_T_Global self}
    {[@expl:open 'f' type invariant] inv_closure0 f}
    {[@expl:open requires #0] precondition_deref () self}
    {[@expl:open requires #1] forall this: t_LocalInvariant_PA_T. postcondition_deref () self this
      -> precondition_open () { f0'2 = new_ref_LocalInvariant_PA_T this; f1'2 = tokens; f2'2 = f }}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Ghost_Fragment_Id_Seq_T result}
      {exists this: t_LocalInvariant_PA_T. postcondition_deref () self this
        /\ postcondition_open () { f0'2 = new_ref_LocalInvariant_PA_T this; f1'2 = tokens; f2'2 = f } result}
      (! return {result}) ]
  
  function new_ref_Rc_LocalInvariant_PA_T_Global (x: t_Rc_LocalInvariant_PA_T_Global) : t_Rc_LocalInvariant_PA_T_Global
  
  axiom new_ref_Rc_LocalInvariant_PA_T_Global_spec:
    forall x: t_Rc_LocalInvariant_PA_T_Global. new_ref_Rc_LocalInvariant_PA_T_Global x = x
  
  predicate postcondition_once_open'0 [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (result: t_Fragment_Id_Seq_T) =
    let {f0'1 = self'0; f1'1 = tokens; f2'1 = f} = args in inv_Ghost_Fragment_Id_Seq_T result
    /\ (exists this: t_LocalInvariant_PA_T. postcondition_deref () self'0 this
      /\ postcondition_open () { f0'2 = new_ref_LocalInvariant_PA_T this; f1'2 = tokens; f2'2 = f } result)
  
  meta "rewrite_def" predicate postcondition_once_open'0
  
  predicate resolve_open'0 [@inline:trivial] (_1: ()) = true
  
  meta "rewrite_def" predicate resolve_open'0
  
  predicate postcondition_mut_open'0 [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (result_state: ()) (result: t_Fragment_Id_Seq_T) =
    let {f0'1 = self'0; f1'1 = tokens; f2'1 = f} = args in inv_Ghost_Fragment_Id_Seq_T result
    /\ (exists this: t_LocalInvariant_PA_T. postcondition_deref () self'0 this
      /\ postcondition_open () { f0'2 = new_ref_LocalInvariant_PA_T this; f1'2 = tokens; f2'2 = f } result)
  
  meta "rewrite_def" predicate postcondition_mut_open'0
  
  function fn_mut_once_open'0 (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (res: t_Fragment_Id_Seq_T) : ()
  
  axiom fn_mut_once_open_spec'0:
    forall self: (), args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0, res: t_Fragment_Id_Seq_T. postcondition_once_open'0 self args res
      = (exists res_state: (). postcondition_mut_open'0 self args res_state res /\ resolve_open'0 res_state)
  
  predicate hist_inv_open'0 [@inline:trivial] (self: ()) (result_state: ()) = true
  
  meta "rewrite_def" predicate hist_inv_open'0
  
  function hist_inv_trans_open'0 (self: ()) (b: ()) (c: ()) : ()
  
  axiom hist_inv_trans_open_spec'0: forall self: (), b: (), c: (). hist_inv_open'0 self b
      -> hist_inv_open'0 b c -> hist_inv_open'0 self c
  
  function hist_inv_refl_open'0 (self: ()) : ()
  
  axiom hist_inv_refl_open_spec'0: forall self: (). hist_inv_open'0 self self
  
  function postcondition_mut_hist_inv_open'0 (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (res_state: ()) (res: t_Fragment_Id_Seq_T) : ()
  
  axiom postcondition_mut_hist_inv_open_spec'0:
    forall self: (), args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0, res_state: (), res: t_Fragment_Id_Seq_T. postcondition_mut_open'0 self args res_state res
      -> hist_inv_open'0 self res_state
  
  function fn_hist_inv_open'0 (self: ()) (res_state: ()) : ()
  
  axiom fn_hist_inv_open_spec'0: forall self: (), res_state: (). hist_inv_open'0 self res_state = (self = res_state)
  
  predicate postcondition_open'0 [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (result: t_Fragment_Id_Seq_T) =
    let {f0'1 = self'0; f1'1 = tokens; f2'1 = f} = args in inv_Ghost_Fragment_Id_Seq_T result
    /\ (exists this: t_LocalInvariant_PA_T. postcondition_deref () self'0 this
      /\ postcondition_open () { f0'2 = new_ref_LocalInvariant_PA_T this; f1'2 = tokens; f2'2 = f } result)
  
  meta "rewrite_def" predicate postcondition_open'0
  
  function fn_once_open'0 (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (res: t_Fragment_Id_Seq_T) : ()
  
  axiom fn_once_open_spec'0:
    forall self: (), args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0, res: t_Fragment_Id_Seq_T. postcondition_once_open'0 self args res
      = (postcondition_open'0 self args res /\ resolve_open'0 self)
  
  function fn_mut_open'0 (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (res_state: ()) (res: t_Fragment_Id_Seq_T) : ()
  
  axiom fn_mut_open_spec'0:
    forall self: (), args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0, res_state: (), res: t_Fragment_Id_Seq_T. postcondition_mut_open'0 self args res_state res
      = (postcondition_open'0 self args res /\ self = res_state)
  
  let rec open_ref_Ghost_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) (tokens: t_Tokens)
    (f: closure0) (return (x: t_Fragment_Id_Seq_T)) =
    {[@expl:open 'self' type invariant] inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global self}
    {[@expl:open 'f' type invariant] inv_closure0 f}
    {[@expl:open requires] precondition_open'0 () { f0'1 = new_ref_Rc_LocalInvariant_PA_T_Global self;
                                                    f1'1 = tokens;
                                                    f2'1 = f }}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_Ghost_Fragment_Id_Seq_T result}
      {postcondition_open'0 () { f0'1 = new_ref_Rc_LocalInvariant_PA_T_Global self; f1'1 = tokens; f2'1 = f } result}
      (! return {result}) ]
  
  let rec new_PermCell_Inner_T (value: t_PermCell_Inner_T) (return (x: t_Rc_PermCell_Inner_T_Global)) = any
    [ return (result: t_Rc_PermCell_Inner_T_Global) -> {inv_Rc_PermCell_Inner_T_Global result}
      {view_Rc_PermCell_Inner_T_Global result = value}
      (! return {result}) ]
  
  let rec deref_Ghost_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global)
    (return (x: t_Rc_LocalInvariant_PA_T_Global)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global self}
    any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_ref_Rc_LocalInvariant_PA_T_Global result}
      {result = self}
      (! return {result}) ]
  
  let rec clone_Rc_LocalInvariant_PA_T_Global (self_: t_Rc_LocalInvariant_PA_T_Global)
    (return (x: t_Rc_LocalInvariant_PA_T_Global)) =
    {[@expl:clone 'self_' type invariant] inv_ref_Rc_LocalInvariant_PA_T_Global self_}
    any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_Rc_LocalInvariant_PA_T_Global result}
      {result = self_}
      (! return {result}) ]
  
  let rec new_Rc_LocalInvariant_PA_T_Global (x: t_Rc_LocalInvariant_PA_T_Global)
    (return (x'0: t_Rc_LocalInvariant_PA_T_Global)) =
    {[@expl:new 'x' type invariant] inv_Rc_LocalInvariant_PA_T_Global x}
    any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_Ghost_Rc_LocalInvariant_PA_T_Global result}
      {result = x}
      (! return {result}) ]
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec set_T (self: t_PersistentArray_T) (index: UInt64.t) (value: t_T) (tokens: t_Tokens)
    (return (x: t_PersistentArray_T)) = {[@expl:set 'self' type invariant] inv_ref_PersistentArray_T self}
    {[@expl:set 'value' type invariant] inv_T value}
    {[@expl:set requires #0] UInt64.t'int index < Seq.length (view_PersistentArray_T self)}
    {[@expl:set requires #1] contains tokens (Namespace_PARRAY 0)}
    (! bb0
    [ bb0 = s0
      [ s0 = [ &new_seq <- Seq.set (view_PersistentArray_T self) (UInt64.t'int index) value ] s1
      | s1 = clone_Rc_PermCell_Inner_T_Global {self.permcell}
          (fun (_x: t_Rc_PermCell_Inner_T_Global) -> [ &_25 <- _x ] s2)
      | s2 = [ &_22 <- Link index value _25 ] s3
      | s3 = new_Inner_T {_22} (fun (_x: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T) -> [ &_21 <- _x ] s4)
      | s4 = [ &permcell'0 <- _21.f0'0 ] s5
      | s5 = [ &permcellown <- _21.f1'0 ] s6
      | s6 = [ &_30 <- { c0 = self; c1 = permcell'0; c2 = permcellown; c3 = new_seq } ] s7
      | s7 = open_ref_Ghost_Rc_LocalInvariant_PA_T_Global {self.inv} {tokens} {_30}
          (fun (_x: t_Fragment_Id_Seq_T) -> [ &frag'0 <- _x ] s8)
      | s8 = new_PermCell_Inner_T {permcell'0} (fun (_x: t_Rc_PermCell_Inner_T_Global) -> [ &_34 <- _x ] s9)
      | s9 = deref_Ghost_Rc_LocalInvariant_PA_T_Global {self.inv}
          (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &_40 <- _x ] s10)
      | s10 = clone_Rc_LocalInvariant_PA_T_Global {_40}
          (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &_38 <- _x ] s11)
      | s11 = new_Rc_LocalInvariant_PA_T_Global {_38} (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &_37 <- _x ] s12)
      | s12 = [ &_ret <- { permcell = _34; frag = frag'0; inv = _37 } ] s13
      | s13 = return {_ret} ] ]
    [ & _ret: t_PersistentArray_T = Any.any_l ()
    | & self: t_PersistentArray_T = self
    | & index: UInt64.t = index
    | & value: t_T = value
    | & tokens: t_Tokens = tokens
    | & new_seq: Seq.seq t_T = Any.any_l ()
    | & permcell'0: t_PermCell_Inner_T = Any.any_l ()
    | & permcellown: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _21: tup2_PermCell_Inner_T_Ghost_PermCellOwn_Inner_T = Any.any_l ()
    | & _22: t_Inner_T = Any.any_l ()
    | & _25: t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & frag'0: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _30: closure0 = Any.any_l ()
    | & _34: t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & _37: t_Rc_LocalInvariant_PA_T_Global = Any.any_l ()
    | & _38: t_Rc_LocalInvariant_PA_T_Global = Any.any_l ()
    | & _40: t_Rc_LocalInvariant_PA_T_Global = Any.any_l () ])
    [ return (result: t_PersistentArray_T) -> {[@expl:set result type invariant] inv_PersistentArray_T result}
      {[@expl:set ensures] view_PersistentArray_T result
      = Seq.set (view_PersistentArray_T self) (UInt64.t'int index) value}
      (! return {result}) ]
end
module M_implementation__impl_PersistentArray_T__get_immut (* implementation::PersistentArray<T> *)
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use map.Map
  use set.Set
  use creusot.int.UInt64
  use seq.Seq
  use mach.int.Int
  use creusot.prelude.Any
  
  type t_Rc_LocalInvariant_PA_T_Global
  
  type t_Rc_PermCell_Inner_T_Global
  
  type t_Fragment_Id_Seq_T
  
  type t_PersistentArray_T = {
    permcell: t_Rc_PermCell_Inner_T_Global;
    frag: t_Fragment_Id_Seq_T;
    inv: t_Rc_LocalInvariant_PA_T_Global }
  
  predicate inv_Rc_LocalInvariant_PA_T_Global (_1: t_Rc_LocalInvariant_PA_T_Global)
  
  predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Ghost_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate invariant_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_ref_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_LocalInvariant_PA_T_Global
  
  let rec deref_Ghost_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global)
    (return (x: t_Rc_LocalInvariant_PA_T_Global)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global self}
    any
    [ return (result: t_Rc_LocalInvariant_PA_T_Global) -> {inv_ref_Rc_LocalInvariant_PA_T_Global result}
      {result = self}
      (! return {result}) ]
  
  type t_LocalInvariant_PA_T
  
  function view_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) : t_LocalInvariant_PA_T
  
  let rec deref_Rc_LocalInvariant_PA_T_Global (self_: t_Rc_LocalInvariant_PA_T_Global)
    (return (x: t_LocalInvariant_PA_T)) =
    {[@expl:deref 'self_' type invariant] inv_ref_Rc_LocalInvariant_PA_T_Global self_}
    any
    [ return (result: t_LocalInvariant_PA_T) -> {result = view_Rc_LocalInvariant_PA_T_Global self_}
      (! return {result}) ]
  
  type t_Tokens
  
  let rec deref_Ghost_ref_Tokens (self: t_Tokens) (return (x: t_Tokens)) = any
    [ return (result: t_Tokens) -> {result = self} (! return {result}) ]
  
  type t_FMap_Id_PermCellOwn_Inner_T
  
  type t_Authority_Id_Seq_T
  
  type t_Id
  
  type t_PA_T = { perms: t_FMap_Id_PermCellOwn_Inner_T; auth: t_Authority_Id_Seq_T; depth: Map.map t_Id int }
  
  predicate contains_Namespace [@inline:trivial] (self: Set.set t_Namespace) (e: t_Namespace) = Set.mem e self
  
  meta "rewrite_def" predicate contains_Namespace
  
  function namespaces (self: t_Tokens) : Set.set t_Namespace
  
  predicate contains (self: t_Tokens) (namespace: t_Namespace) = contains_Namespace (namespaces self) namespace
  
  function namespace_PA_T (self: t_LocalInvariant_PA_T) : t_Namespace
  
  type t_PermCellOwn_Inner_T
  
  type t_Option_PermCellOwn_Inner_T = None | Some t_PermCellOwn_Inner_T
  
  function view_FMap_Id_PermCellOwn_Inner_T (self: t_FMap_Id_PermCellOwn_Inner_T) : Map.map t_Id t_Option_PermCellOwn_Inner_T
  
  function get_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_Option_PermCellOwn_Inner_T =
    Map.get (view_FMap_Id_PermCellOwn_Inner_T self) k
  
  meta "rewrite_def" function get_Id
  
  predicate contains_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) = get_Id self k <> None
  
  meta "rewrite_def" predicate contains_Id
  
  predicate inv_Id [@inline:trivial] (_1: t_Id) = true
  
  meta "rewrite_def" predicate inv_Id
  
  type t_Vec_T_Global
  
  type t_T
  
  type t_Inner_T = Direct t_Vec_T_Global | Link UInt64.t t_T t_Rc_PermCell_Inner_T_Global
  
  predicate inv_T (_1: t_T)
  
  predicate invariant_Box_T_Global (self: t_T) = inv_T self
  
  predicate inv_Box_T_Global [@inline:trivial] (_1: t_T) = invariant_Box_T_Global _1
  
  meta "rewrite_def" predicate inv_Box_T_Global
  
  predicate invariant_Seq_T [@inline:trivial] (self: Seq.seq t_T) =
    forall i: int. 0 <= i /\ i < Seq.length self -> inv_Box_T_Global (Seq.get self i)
  
  meta "rewrite_def" predicate invariant_Seq_T
  
  predicate inv_Seq_T [@inline:trivial] (_1: Seq.seq t_T) = invariant_Seq_T _1
  
  meta "rewrite_def" predicate inv_Seq_T
  
  constant const_MAX: UInt64.t = (18446744073709551615: UInt64.t)
  
  function view_Vec_T_Global (self: t_Vec_T_Global) : Seq.seq t_T
  
  axiom view_Vec_T_Global_spec: forall self: t_Vec_T_Global. Seq.length (view_Vec_T_Global self)
      <= UInt64.t'int const_MAX
  
  predicate invariant_Vec_T_Global (self: t_Vec_T_Global) = inv_Seq_T (view_Vec_T_Global self)
  
  predicate inv_Vec_T_Global (_1: t_Vec_T_Global)
  
  axiom inv_axiom: forall x: t_Vec_T_Global [inv_Vec_T_Global x]. inv_Vec_T_Global x -> invariant_Vec_T_Global x
  
  predicate inv_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate inv_Inner_T (_1: t_Inner_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_Inner_T [inv_Inner_T x]. inv_Inner_T x
      = match x with
        | Direct f0 -> inv_Vec_T_Global f0
        | Link index value next -> inv_T value /\ inv_Rc_PermCell_Inner_T_Global next
        end
  
  predicate invariant_ref_Inner_T [@inline:trivial] (self: t_Inner_T) = inv_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_Inner_T
  
  predicate inv_ref_Inner_T [@inline:trivial] (_1: t_Inner_T) = invariant_ref_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Inner_T
  
  function val_Inner_T (self: t_PermCellOwn_Inner_T) : t_Inner_T
  
  predicate invariant_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_ref_Inner_T (val_Inner_T self)
  
  meta "rewrite_def" predicate invariant_PermCellOwn_Inner_T
  
  predicate inv_PermCellOwn_Inner_T (_1: t_PermCellOwn_Inner_T)
  
  axiom inv_axiom'1 [@rewrite]: forall x: t_PermCellOwn_Inner_T [inv_PermCellOwn_Inner_T x]. inv_PermCellOwn_Inner_T x
      = invariant_PermCellOwn_Inner_T x
  
  predicate index_Mapping_PermCellOwn_Inner_T_bool [@inline:trivial] (self: Map.map t_PermCellOwn_Inner_T bool) (a: t_PermCellOwn_Inner_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_PermCellOwn_Inner_T_bool
  
  function such_that_PermCellOwn_Inner_T (p: Map.map t_PermCellOwn_Inner_T bool) : t_PermCellOwn_Inner_T
  
  axiom such_that_PermCellOwn_Inner_T_spec:
    forall p: Map.map t_PermCellOwn_Inner_T bool. (exists x: t_PermCellOwn_Inner_T. index_Mapping_PermCellOwn_Inner_T_bool p x)
      -> index_Mapping_PermCellOwn_Inner_T_bool p (such_that_PermCellOwn_Inner_T p)
  
  function unwrap_Option_PermCellOwn_Inner_T (self: t_Option_PermCellOwn_Inner_T) : t_PermCellOwn_Inner_T =
    match self with
      | Some x -> x
      | None -> such_that_PermCellOwn_Inner_T (fun (__0: t_PermCellOwn_Inner_T) -> true)
      end
  
  function lookup_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_PermCellOwn_Inner_T =
    unwrap_Option_PermCellOwn_Inner_T (get_Id self k)
  
  meta "rewrite_def" function lookup_Id
  
  function index_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) : t_PermCellOwn_Inner_T
   = lookup_Id self key
  
  meta "rewrite_def" function index_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    forall k: t_Id. contains_Id self k -> inv_Id k /\ inv_PermCellOwn_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self k)
  
  meta "rewrite_def" predicate invariant_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_FMap_Id_PermCellOwn_Inner_T (_1: t_FMap_Id_PermCellOwn_Inner_T)
  
  axiom inv_axiom'2 [@rewrite]:
    forall x: t_FMap_Id_PermCellOwn_Inner_T [inv_FMap_Id_PermCellOwn_Inner_T x]. inv_FMap_Id_PermCellOwn_Inner_T x
      = invariant_FMap_Id_PermCellOwn_Inner_T x
  
  predicate invariant_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T)
  
  predicate inv_Authority_Id_Seq_T (_1: t_Authority_Id_Seq_T)
  
  axiom inv_axiom'3: forall x: t_Authority_Id_Seq_T [inv_Authority_Id_Seq_T x]. inv_Authority_Id_Seq_T x
      -> invariant_Authority_Id_Seq_T x
  
  predicate inv_PA_T (_1: t_PA_T)
  
  axiom inv_axiom'4 [@rewrite]: forall x: t_PA_T [inv_PA_T x]. inv_PA_T x
      = (inv_FMap_Id_PermCellOwn_Inner_T x.perms /\ inv_Authority_Id_Seq_T x.auth)
  
  predicate invariant_ref_PA_T [@inline:trivial] (self: t_PA_T) = inv_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_PA_T
  
  predicate inv_ref_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_PA_T
  
  function id_Id (self: t_Authority_Id_Seq_T) : t_Id
  
  type t_FMap_Id_Seq_T
  
  type t_Option_Seq_T = None'0 | Some'0 (Seq.seq t_T)
  
  function view_FMap_Id_Seq_T (self: t_FMap_Id_Seq_T) : Map.map t_Id t_Option_Seq_T
  
  function get_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : t_Option_Seq_T =
    Map.get (view_FMap_Id_Seq_T self) k
  
  meta "rewrite_def" function get_Id'0
  
  predicate contains_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) = get_Id'0 self k <> None'0
  
  meta "rewrite_def" predicate contains_Id'0
  
  function view_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T) : t_FMap_Id_Seq_T
  
  function id_Inner_T (self: t_PermCellOwn_Inner_T) : t_Id
  
  predicate index_Mapping_Seq_T_bool [@inline:trivial] (self: Map.map (Seq.seq t_T) bool) (a: Seq.seq t_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_Seq_T_bool
  
  function such_that_Seq_T (p: Map.map (Seq.seq t_T) bool) : Seq.seq t_T
  
  axiom such_that_Seq_T_spec:
    forall p: Map.map (Seq.seq t_T) bool. (exists x: Seq.seq t_T. index_Mapping_Seq_T_bool p x)
      -> index_Mapping_Seq_T_bool p (such_that_Seq_T p)
  
  function unwrap_Option_Seq_T (self: t_Option_Seq_T) : Seq.seq t_T = match self with
      | Some'0 x -> x
      | None'0 -> such_that_Seq_T (fun (__0: Seq.seq t_T) -> true)
      end
  
  function lookup_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : Seq.seq t_T =
    unwrap_Option_Seq_T (get_Id'0 self k)
  
  meta "rewrite_def" function lookup_Id'0
  
  function index_FMap_Id_Seq_T [@inline:trivial] (self: t_FMap_Id_Seq_T) (key: t_Id) : Seq.seq t_T =
    lookup_Id'0 self key
  
  meta "rewrite_def" function index_FMap_Id_Seq_T
  
  type t_PermCell_Inner_T
  
  function id_Inner_T'0 (self: t_PermCell_Inner_T) : t_Id
  
  function view_Rc_PermCell_Inner_T_Global (self: t_Rc_PermCell_Inner_T_Global) : t_PermCell_Inner_T
  
  function index_Mapping_Id_Int [@inline:trivial] (self: Map.map t_Id int) (a: t_Id) : int = Map.get self a
  
  meta "rewrite_def" function index_Mapping_Id_Int
  
  predicate partial_invariant_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    id_Id self.auth = resource_id
    /\ (forall id: t_Id. contains_Id'0 (view_Authority_Id_Seq_T self.auth) id /\ contains_Id self.perms id
      -> id_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self.perms id) = id
      /\ match val_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self.perms id) with
        | Direct v -> index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id = view_Vec_T_Global v
        | Link index value next -> contains_Id'0 (view_Authority_Id_Seq_T self.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global next))
        /\ index_Mapping_Id_Int self.depth id
          > index_Mapping_Id_Int self.depth (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global next))
        /\ UInt64.t'int index
          < Seq.length (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global next)))
        /\ index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id
        = Seq.set (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global next))) (UInt64.t'int index) value
        end)
  
  meta "rewrite_def" predicate partial_invariant_T
  
  predicate protocol_PA_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    partial_invariant_T self resource_id
    /\ (forall id: t_Id. contains_Id'0 (view_Authority_Id_Seq_T self.auth) id -> contains_Id self.perms id)
  
  meta "rewrite_def" predicate protocol_PA_T
  
  function public_PA_T (self: t_LocalInvariant_PA_T) : t_Id
  
  let rec open_const_PA_T (self: t_LocalInvariant_PA_T) (tokens: t_Tokens) (return (x: t_PA_T)) =
    {[@expl:open_const requires] contains tokens (namespace_PA_T self)}
    any
    [ return (result: t_PA_T) -> {inv_ref_PA_T result} {protocol_PA_T result (public_PA_T self)} (! return {result}) ]
  
  predicate invariant_Ghost_ref_PA_T [@inline:trivial] (self: t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_PA_T
  
  predicate inv_Ghost_ref_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_PA_T
  
  let rec new_ref_PA_T (x: t_PA_T) (return (x'0: t_PA_T)) = {[@expl:new 'x' type invariant] inv_ref_PA_T x}
    any [ return (result: t_PA_T) -> {inv_Ghost_ref_PA_T result} {result = x} (! return {result}) ]
  
  predicate invariant_ref_Ghost_ref_PA_T [@inline:trivial] (self: t_PA_T) = inv_Ghost_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_ref_PA_T
  
  predicate inv_ref_Ghost_ref_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_ref_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_ref_PA_T
  
  predicate invariant_ref_ref_PA_T [@inline:trivial] (self: t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_ref_PA_T
  
  predicate inv_ref_ref_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_ref_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_ref_PA_T
  
  let rec deref_Ghost_ref_PA_T (self: t_PA_T) (return (x: t_PA_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_ref_PA_T self}
    any [ return (result: t_PA_T) -> {inv_ref_ref_PA_T result} {result = self} (! return {result}) ]
  
  predicate invariant_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T)
  
  predicate inv_Fragment_Id_Seq_T (_1: t_Fragment_Id_Seq_T)
  
  axiom inv_axiom'5: forall x: t_Fragment_Id_Seq_T [inv_Fragment_Id_Seq_T x]. inv_Fragment_Id_Seq_T x
      -> invariant_Fragment_Id_Seq_T x
  
  predicate invariant_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_Ghost_Fragment_Id_Seq_T
  
  predicate inv_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_Ghost_Fragment_Id_Seq_T
  
  predicate invariant_ref_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) =
    inv_Ghost_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Fragment_Id_Seq_T
  
  predicate inv_ref_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_ref_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Fragment_Id_Seq_T
  
  predicate invariant_ref_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Fragment_Id_Seq_T
  
  predicate inv_ref_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) = invariant_ref_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Fragment_Id_Seq_T
  
  let rec deref_Ghost_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) (return (x: t_Fragment_Id_Seq_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_Fragment_Id_Seq_T self}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_ref_Fragment_Id_Seq_T result} {result = self} (! return {result}) ]
  
  predicate invariant_ref_Authority_Id_Seq_T [@inline:trivial] (self: t_Authority_Id_Seq_T) =
    inv_Authority_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Authority_Id_Seq_T
  
  predicate inv_ref_Authority_Id_Seq_T [@inline:trivial] (_1: t_Authority_Id_Seq_T) =
    invariant_ref_Authority_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Authority_Id_Seq_T
  
  function id_Id'0 (self: t_Fragment_Id_Seq_T) : t_Id
  
  type tup2_Id_Seq_T = { f0: t_Id; f1: Seq.seq t_T }
  
  function view_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) : tup2_Id_Seq_T
  
  let rec contains_Id'1 (self: t_Authority_Id_Seq_T) (frag'0: t_Fragment_Id_Seq_T) (return (x: ())) =
    {[@expl:contains 'self' type invariant] inv_ref_Authority_Id_Seq_T self}
    {[@expl:contains 'frag' type invariant] inv_ref_Fragment_Id_Seq_T frag'0}
    {[@expl:contains requires] id_Id self = id_Id'0 frag'0}
    any
    [ return (result: ()) -> {get_Id'0 (view_Authority_Id_Seq_T self) (view_Fragment_Id_Seq_T frag'0).f0
      = Some'0 ((view_Fragment_Id_Seq_T frag'0).f1)}
      (! return {result}) ]
  
  let rec new_unit (x: ()) (return (x'0: ())) = any [ return (result: ()) -> {result = x} (! return {result}) ]
  
  predicate invariant_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (self: t_Rc_PermCell_Inner_T_Global) =
    inv_Rc_PermCell_Inner_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_PermCell_Inner_T_Global
  
  predicate inv_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (_1: t_Rc_PermCell_Inner_T_Global) =
    invariant_ref_Rc_PermCell_Inner_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_PermCell_Inner_T_Global
  
  predicate invariant_ref_T [@inline:trivial] (self: t_T) = inv_T self
  
  meta "rewrite_def" predicate invariant_ref_T
  
  predicate inv_ref_T [@inline:trivial] (_1: t_T) = invariant_ref_T _1
  
  meta "rewrite_def" predicate inv_ref_T
  
  let rec get_inner_immut_T (inner: t_Rc_PermCell_Inner_T_Global) (i: UInt64.t) (pa: t_PA_T) (return (x: t_T)) =
    {[@expl:get_inner_immut 'inner' type invariant] inv_ref_Rc_PermCell_Inner_T_Global inner}
    {[@expl:get_inner_immut 'pa' type invariant] inv_Ghost_ref_PA_T pa}
    {[@expl:get_inner_immut requires #0] exists p: t_Id. protocol_PA_T pa p}
    {[@expl:get_inner_immut requires #1] contains_Id'0 (view_Authority_Id_Seq_T pa.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global inner))}
    {[@expl:get_inner_immut requires #2] UInt64.t'int i
    < Seq.length (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T pa.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global inner)))}
    any
    [ return (result: t_T) -> {inv_ref_T result}
      {result
      = Seq.get (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T pa.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global inner))) (UInt64.t'int i)}
      (! return {result}) ]
  
  predicate invariant_PersistentArray_T (self: t_PersistentArray_T) =
    (view_Fragment_Id_Seq_T self.frag).f0 = id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global self.permcell)
    /\ id_Id'0 self.frag = public_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv)
    /\ namespace_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv) = Namespace_PARRAY 0
  
  predicate inv_PersistentArray_T (_1: t_PersistentArray_T)
  
  axiom inv_axiom'6 [@rewrite]: forall x: t_PersistentArray_T [inv_PersistentArray_T x]. inv_PersistentArray_T x
      = (invariant_PersistentArray_T x
      /\ inv_Rc_PermCell_Inner_T_Global x.permcell
      /\ inv_Ghost_Fragment_Id_Seq_T x.frag /\ inv_Ghost_Rc_LocalInvariant_PA_T_Global x.inv)
  
  predicate invariant_ref_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) = inv_PersistentArray_T self
  
  meta "rewrite_def" predicate invariant_ref_PersistentArray_T
  
  predicate inv_ref_PersistentArray_T [@inline:trivial] (_1: t_PersistentArray_T) = invariant_ref_PersistentArray_T _1
  
  meta "rewrite_def" predicate inv_ref_PersistentArray_T
  
  function view_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) : Seq.seq t_T =
    (view_Fragment_Id_Seq_T self.frag).f1
  
  meta "rewrite_def" function view_PersistentArray_T
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec get_immut_T (self: t_PersistentArray_T) (index: UInt64.t) (tokens: t_Tokens) (return (x: t_T)) =
    {[@expl:get_immut 'self' type invariant] inv_ref_PersistentArray_T self}
    {[@expl:get_immut requires #0] contains tokens (Namespace_PARRAY 0)}
    {[@expl:get_immut requires #1] UInt64.t'int index < Seq.length (view_PersistentArray_T self)}
    (! bb0
    [ bb0 = s0
      [ s0 = deref_Ghost_Rc_LocalInvariant_PA_T_Global {self.inv}
          (fun (_x: t_Rc_LocalInvariant_PA_T_Global) -> [ &_17 <- _x ] s1)
      | s1 = deref_Rc_LocalInvariant_PA_T_Global {_17} (fun (_x: t_LocalInvariant_PA_T) -> [ &_15 <- _x ] s2)
      | s2 = deref_Ghost_ref_Tokens {tokens} (fun (_x: t_Tokens) -> [ &_20 <- _x ] s3)
      | s3 = open_const_PA_T {_15} {_20} (fun (_x: t_PA_T) -> [ &_13 <- _x ] s4)
      | s4 = new_ref_PA_T {_13} (fun (_x: t_PA_T) -> [ &pa <- _x ] s5)
      | s5 = deref_Ghost_ref_PA_T {pa} (fun (_x: t_PA_T) -> [ &_25 <- _x ] s6)
      | s6 = [ &_30 <- self.frag ] s7
      | s7 = deref_Ghost_Fragment_Id_Seq_T {_30} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_28 <- _x ] s8)
      | s8 = contains_Id'1 {_25.auth} {_28} (fun (_x: ()) -> [ &_23 <- _x ] s9)
      | s9 = new_unit {_23} (fun (_x: ()) -> [ &_22 <- _x ] s10)
      | s10 = [ &_33 <- self.permcell ] s11
      | s11 = get_inner_immut_T {_33} {index} {pa} (fun (_x: t_T) -> [ &_31 <- _x ] s12)
      | s12 = [ &_ret <- _31 ] s13
      | s13 = return {_ret} ] ]
    [ & _ret: t_T = Any.any_l ()
    | & self: t_PersistentArray_T = self
    | & index: UInt64.t = index
    | & tokens: t_Tokens = tokens
    | & pa: t_PA_T = Any.any_l ()
    | & _13: t_PA_T = Any.any_l ()
    | & _15: t_LocalInvariant_PA_T = Any.any_l ()
    | & _17: t_Rc_LocalInvariant_PA_T_Global = Any.any_l ()
    | & _20: t_Tokens = Any.any_l ()
    | & _22: () = Any.any_l ()
    | & _23: () = Any.any_l ()
    | & _25: t_PA_T = Any.any_l ()
    | & _28: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _30: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _31: t_T = Any.any_l ()
    | & _33: t_Rc_PermCell_Inner_T_Global = Any.any_l () ])
    [ return (result: t_T) -> {[@expl:get_immut result type invariant] inv_ref_T result}
      {[@expl:get_immut ensures] result = Seq.get (view_PersistentArray_T self) (UInt64.t'int index)}
      (! return {result}) ]
end
module M_implementation__impl_PersistentArray_T__get_inner_immut (* implementation::PersistentArray<T> *)
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use map.Map
  use creusot.int.UInt64
  use seq.Seq
  use mach.int.Int
  use creusot.prelude.Any
  
  type t_Rc_PermCell_Inner_T_Global
  
  type t_PermCell_Inner_T
  
  predicate inv_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate invariant_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (self: t_Rc_PermCell_Inner_T_Global) =
    inv_Rc_PermCell_Inner_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_PermCell_Inner_T_Global
  
  predicate inv_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (_1: t_Rc_PermCell_Inner_T_Global) =
    invariant_ref_Rc_PermCell_Inner_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_PermCell_Inner_T_Global
  
  function view_Rc_PermCell_Inner_T_Global (self: t_Rc_PermCell_Inner_T_Global) : t_PermCell_Inner_T
  
  let rec deref_Rc_PermCell_Inner_T_Global (self_: t_Rc_PermCell_Inner_T_Global) (return (x: t_PermCell_Inner_T)) =
    {[@expl:deref 'self_' type invariant] inv_ref_Rc_PermCell_Inner_T_Global self_}
    any [ return (result: t_PermCell_Inner_T) -> {result = view_Rc_PermCell_Inner_T_Global self_} (! return {result}) ]
  
  type t_FMap_Id_PermCellOwn_Inner_T
  
  type t_Authority_Id_Seq_T
  
  type t_Id
  
  type t_PA_T = { perms: t_FMap_Id_PermCellOwn_Inner_T; auth: t_Authority_Id_Seq_T; depth: Map.map t_Id int }
  
  type t_PermCellOwn_Inner_T
  
  type t_Option_PermCellOwn_Inner_T = None | Some t_PermCellOwn_Inner_T
  
  function view_FMap_Id_PermCellOwn_Inner_T (self: t_FMap_Id_PermCellOwn_Inner_T) : Map.map t_Id t_Option_PermCellOwn_Inner_T
  
  function get_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_Option_PermCellOwn_Inner_T =
    Map.get (view_FMap_Id_PermCellOwn_Inner_T self) k
  
  meta "rewrite_def" function get_Id
  
  predicate contains_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) = get_Id self k <> None
  
  meta "rewrite_def" predicate contains_Id
  
  predicate inv_Id [@inline:trivial] (_1: t_Id) = true
  
  meta "rewrite_def" predicate inv_Id
  
  type t_Vec_T_Global
  
  type t_T
  
  type t_Inner_T = Direct t_Vec_T_Global | Link UInt64.t t_T t_Rc_PermCell_Inner_T_Global
  
  predicate inv_T (_1: t_T)
  
  predicate invariant_Box_T_Global (self: t_T) = inv_T self
  
  predicate inv_Box_T_Global [@inline:trivial] (_1: t_T) = invariant_Box_T_Global _1
  
  meta "rewrite_def" predicate inv_Box_T_Global
  
  predicate invariant_Seq_T [@inline:trivial] (self: Seq.seq t_T) =
    forall i: int. 0 <= i /\ i < Seq.length self -> inv_Box_T_Global (Seq.get self i)
  
  meta "rewrite_def" predicate invariant_Seq_T
  
  predicate inv_Seq_T [@inline:trivial] (_1: Seq.seq t_T) = invariant_Seq_T _1
  
  meta "rewrite_def" predicate inv_Seq_T
  
  constant const_MAX: UInt64.t = (18446744073709551615: UInt64.t)
  
  function view_Vec_T_Global (self: t_Vec_T_Global) : Seq.seq t_T
  
  axiom view_Vec_T_Global_spec: forall self: t_Vec_T_Global. Seq.length (view_Vec_T_Global self)
      <= UInt64.t'int const_MAX
  
  predicate invariant_Vec_T_Global (self: t_Vec_T_Global) = inv_Seq_T (view_Vec_T_Global self)
  
  predicate inv_Vec_T_Global (_1: t_Vec_T_Global)
  
  axiom inv_axiom: forall x: t_Vec_T_Global [inv_Vec_T_Global x]. inv_Vec_T_Global x -> invariant_Vec_T_Global x
  
  predicate inv_Inner_T (_1: t_Inner_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_Inner_T [inv_Inner_T x]. inv_Inner_T x
      = match x with
        | Direct f0 -> inv_Vec_T_Global f0
        | Link index value next -> inv_T value /\ inv_Rc_PermCell_Inner_T_Global next
        end
  
  predicate invariant_ref_Inner_T [@inline:trivial] (self: t_Inner_T) = inv_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_Inner_T
  
  predicate inv_ref_Inner_T [@inline:trivial] (_1: t_Inner_T) = invariant_ref_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Inner_T
  
  function val_Inner_T (self: t_PermCellOwn_Inner_T) : t_Inner_T
  
  predicate invariant_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_ref_Inner_T (val_Inner_T self)
  
  meta "rewrite_def" predicate invariant_PermCellOwn_Inner_T
  
  predicate inv_PermCellOwn_Inner_T (_1: t_PermCellOwn_Inner_T)
  
  axiom inv_axiom'1 [@rewrite]: forall x: t_PermCellOwn_Inner_T [inv_PermCellOwn_Inner_T x]. inv_PermCellOwn_Inner_T x
      = invariant_PermCellOwn_Inner_T x
  
  predicate index_Mapping_PermCellOwn_Inner_T_bool [@inline:trivial] (self: Map.map t_PermCellOwn_Inner_T bool) (a: t_PermCellOwn_Inner_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_PermCellOwn_Inner_T_bool
  
  function such_that_PermCellOwn_Inner_T (p: Map.map t_PermCellOwn_Inner_T bool) : t_PermCellOwn_Inner_T
  
  axiom such_that_PermCellOwn_Inner_T_spec:
    forall p: Map.map t_PermCellOwn_Inner_T bool. (exists x: t_PermCellOwn_Inner_T. index_Mapping_PermCellOwn_Inner_T_bool p x)
      -> index_Mapping_PermCellOwn_Inner_T_bool p (such_that_PermCellOwn_Inner_T p)
  
  function unwrap_Option_PermCellOwn_Inner_T (self: t_Option_PermCellOwn_Inner_T) : t_PermCellOwn_Inner_T =
    match self with
      | Some x -> x
      | None -> such_that_PermCellOwn_Inner_T (fun (__0: t_PermCellOwn_Inner_T) -> true)
      end
  
  function lookup_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_PermCellOwn_Inner_T =
    unwrap_Option_PermCellOwn_Inner_T (get_Id self k)
  
  meta "rewrite_def" function lookup_Id
  
  function index_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) : t_PermCellOwn_Inner_T
   = lookup_Id self key
  
  meta "rewrite_def" function index_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    forall k: t_Id. contains_Id self k -> inv_Id k /\ inv_PermCellOwn_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self k)
  
  meta "rewrite_def" predicate invariant_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_FMap_Id_PermCellOwn_Inner_T (_1: t_FMap_Id_PermCellOwn_Inner_T)
  
  axiom inv_axiom'2 [@rewrite]:
    forall x: t_FMap_Id_PermCellOwn_Inner_T [inv_FMap_Id_PermCellOwn_Inner_T x]. inv_FMap_Id_PermCellOwn_Inner_T x
      = invariant_FMap_Id_PermCellOwn_Inner_T x
  
  predicate invariant_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T)
  
  predicate inv_Authority_Id_Seq_T (_1: t_Authority_Id_Seq_T)
  
  axiom inv_axiom'3: forall x: t_Authority_Id_Seq_T [inv_Authority_Id_Seq_T x]. inv_Authority_Id_Seq_T x
      -> invariant_Authority_Id_Seq_T x
  
  predicate inv_PA_T (_1: t_PA_T)
  
  axiom inv_axiom'4 [@rewrite]: forall x: t_PA_T [inv_PA_T x]. inv_PA_T x
      = (inv_FMap_Id_PermCellOwn_Inner_T x.perms /\ inv_Authority_Id_Seq_T x.auth)
  
  predicate invariant_ref_PA_T [@inline:trivial] (self: t_PA_T) = inv_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_PA_T
  
  predicate inv_ref_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_PA_T
  
  predicate invariant_Ghost_ref_PA_T [@inline:trivial] (self: t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_PA_T
  
  predicate inv_Ghost_ref_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_PA_T
  
  predicate invariant_ref_Ghost_ref_PA_T [@inline:trivial] (self: t_PA_T) = inv_Ghost_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_ref_PA_T
  
  predicate inv_ref_Ghost_ref_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_ref_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_ref_PA_T
  
  predicate invariant_ref_ref_PA_T [@inline:trivial] (self: t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_ref_PA_T
  
  predicate inv_ref_ref_PA_T [@inline:trivial] (_1: t_PA_T) = invariant_ref_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_ref_PA_T
  
  let rec deref_Ghost_ref_PA_T (self: t_PA_T) (return (x: t_PA_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_ref_PA_T self}
    any [ return (result: t_PA_T) -> {inv_ref_ref_PA_T result} {result = self} (! return {result}) ]
  
  function id_Inner_T (self: t_PermCell_Inner_T) : t_Id
  
  let rec id_ghost_Inner_T (self: t_PermCell_Inner_T) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = id_Inner_T self} (! return {result}) ]
  
  let rec deref_Ghost_Id (self: t_Id) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = self} (! return {result}) ]
  
  type t_Option_ref_PermCellOwn_Inner_T = None'0 | Some'0 t_PermCellOwn_Inner_T
  
  predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    inv_FMap_Id_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (_1: t_FMap_Id_PermCellOwn_Inner_T) =
    invariant_ref_FMap_Id_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_ref_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_PermCellOwn_Inner_T
  
  predicate inv_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_ref_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_PermCellOwn_Inner_T
  
  predicate inv_Option_ref_PermCellOwn_Inner_T (_1: t_Option_ref_PermCellOwn_Inner_T)
  
  axiom inv_axiom'5 [@rewrite]:
    forall x: t_Option_ref_PermCellOwn_Inner_T [inv_Option_ref_PermCellOwn_Inner_T x]. inv_Option_ref_PermCellOwn_Inner_T x
      = match x with
        | None'0 -> true
        | Some'0 f0 -> inv_ref_PermCellOwn_Inner_T f0
        end
  
  function map_Option_PermCellOwn_Inner_T (self: t_Option_PermCellOwn_Inner_T) (f: Map.map t_PermCellOwn_Inner_T t_PermCellOwn_Inner_T) : t_Option_ref_PermCellOwn_Inner_T
   = match self with
      | None -> None'0
      | Some x -> Some'0 (Map.get f x)
      end
  
  let rec get_ghost_Id (self: t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id)
    (return (x: t_Option_ref_PermCellOwn_Inner_T)) =
    {[@expl:get_ghost 'self' type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T self}
    any
    [ return (result: t_Option_ref_PermCellOwn_Inner_T) -> {inv_Option_ref_PermCellOwn_Inner_T result}
      {result = map_Option_PermCellOwn_Inner_T (get_Id self key) (fun (v: t_PermCellOwn_Inner_T) -> v)}
      (! return {result}) ]
  
  let rec unwrap_ref_PermCellOwn_Inner_T (self_: t_Option_ref_PermCellOwn_Inner_T) (return (x: t_PermCellOwn_Inner_T)) =
    {[@expl:unwrap 'self_' type invariant] inv_Option_ref_PermCellOwn_Inner_T self_}
    {[@expl:unwrap requires] self_ <> None'0}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_ref_PermCellOwn_Inner_T result}
      {Some'0 result = self_}
      (! return {result}) ]
  
  predicate invariant_Ghost_ref_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_ref_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_PermCellOwn_Inner_T
  
  predicate inv_Ghost_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_Ghost_ref_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_PermCellOwn_Inner_T
  
  let rec new_ref_PermCellOwn_Inner_T (x: t_PermCellOwn_Inner_T) (return (x'0: t_PermCellOwn_Inner_T)) =
    {[@expl:new 'x' type invariant] inv_ref_PermCellOwn_Inner_T x}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_Ghost_ref_PermCellOwn_Inner_T result}
      {result = x}
      (! return {result}) ]
  
  function id_Inner_T'0 (self: t_PermCellOwn_Inner_T) : t_Id
  
  function view_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) : t_Inner_T = val_Inner_T self
  
  meta "rewrite_def" function view_PermCellOwn_Inner_T
  
  let rec borrow_Inner_T (self: t_PermCell_Inner_T) (perm: t_PermCellOwn_Inner_T) (return (x: t_Inner_T)) =
    {[@expl:borrow 'perm' type invariant] inv_Ghost_ref_PermCellOwn_Inner_T perm}
    {[@expl:borrow requires] id_Inner_T self = id_Inner_T'0 perm}
    any
    [ return (result: t_Inner_T) -> {inv_ref_Inner_T result}
      {result = view_PermCellOwn_Inner_T perm}
      (! return {result}) ]
  
  let rec elim_Link (_x: t_Inner_T) (return (index: UInt64.t) (value: t_T) (next: t_Rc_PermCell_Inner_T_Global)) = any
    [ _k (index: UInt64.t) (value: t_T) (next: t_Rc_PermCell_Inner_T_Global) -> {Link index value next = _x}
      (! return {index} {value} {next})
    | _chk -> (! {match _x with
        | Link _ _ _ -> true
        | _ -> false
        end}
      any) ]
  
  let rec elim_Direct (_x: t_Inner_T) (return (f0: t_Vec_T_Global)) = any
    [ _k (f0: t_Vec_T_Global) -> {Direct f0 = _x} (! return {f0})
    | _chk -> (! {match _x with
        | Direct _ -> true
        | _ -> false
        end}
      any) ]
  
  predicate invariant_ref_Vec_T_Global [@inline:trivial] (self: t_Vec_T_Global) = inv_Vec_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Vec_T_Global
  
  predicate inv_ref_Vec_T_Global [@inline:trivial] (_1: t_Vec_T_Global) = invariant_ref_Vec_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Vec_T_Global
  
  predicate in_bounds_usize [@inline:trivial] (self: UInt64.t) (seq: Seq.seq t_T) = UInt64.t'int self < Seq.length seq
  
  meta "rewrite_def" predicate in_bounds_usize
  
  predicate invariant_ref_T [@inline:trivial] (self: t_T) = inv_T self
  
  meta "rewrite_def" predicate invariant_ref_T
  
  predicate inv_ref_T [@inline:trivial] (_1: t_T) = invariant_ref_T _1
  
  meta "rewrite_def" predicate inv_ref_T
  
  predicate has_value_usize [@inline:trivial] (self: UInt64.t) (seq: Seq.seq t_T) (out: t_T) =
    Seq.get seq (UInt64.t'int self) = out
  
  meta "rewrite_def" predicate has_value_usize
  
  let rec index_Vec_T_Global (self_: t_Vec_T_Global) (ix: UInt64.t) (return (x: t_T)) =
    {[@expl:index 'self_' type invariant] inv_ref_Vec_T_Global self_}
    {[@expl:index requires] in_bounds_usize ix (view_Vec_T_Global self_)}
    any
    [ return (result: t_T) -> {inv_ref_T result}
      {has_value_usize ix (view_Vec_T_Global self_) result}
      (! return {result}) ]
  
  function id_Id (self: t_Authority_Id_Seq_T) : t_Id
  
  type t_FMap_Id_Seq_T
  
  type t_Option_Seq_T = None'1 | Some'1 (Seq.seq t_T)
  
  function view_FMap_Id_Seq_T (self: t_FMap_Id_Seq_T) : Map.map t_Id t_Option_Seq_T
  
  function get_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : t_Option_Seq_T =
    Map.get (view_FMap_Id_Seq_T self) k
  
  meta "rewrite_def" function get_Id'0
  
  predicate contains_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) = get_Id'0 self k <> None'1
  
  meta "rewrite_def" predicate contains_Id'0
  
  function view_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T) : t_FMap_Id_Seq_T
  
  predicate index_Mapping_Seq_T_bool [@inline:trivial] (self: Map.map (Seq.seq t_T) bool) (a: Seq.seq t_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_Seq_T_bool
  
  function such_that_Seq_T (p: Map.map (Seq.seq t_T) bool) : Seq.seq t_T
  
  axiom such_that_Seq_T_spec:
    forall p: Map.map (Seq.seq t_T) bool. (exists x: Seq.seq t_T. index_Mapping_Seq_T_bool p x)
      -> index_Mapping_Seq_T_bool p (such_that_Seq_T p)
  
  function unwrap_Option_Seq_T (self: t_Option_Seq_T) : Seq.seq t_T = match self with
      | Some'1 x -> x
      | None'1 -> such_that_Seq_T (fun (__0: Seq.seq t_T) -> true)
      end
  
  function lookup_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : Seq.seq t_T =
    unwrap_Option_Seq_T (get_Id'0 self k)
  
  meta "rewrite_def" function lookup_Id'0
  
  function index_FMap_Id_Seq_T [@inline:trivial] (self: t_FMap_Id_Seq_T) (key: t_Id) : Seq.seq t_T =
    lookup_Id'0 self key
  
  meta "rewrite_def" function index_FMap_Id_Seq_T
  
  function index_Mapping_Id_Int [@inline:trivial] (self: Map.map t_Id int) (a: t_Id) : int = Map.get self a
  
  meta "rewrite_def" function index_Mapping_Id_Int
  
  predicate partial_invariant_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    id_Id self.auth = resource_id
    /\ (forall id: t_Id. contains_Id'0 (view_Authority_Id_Seq_T self.auth) id /\ contains_Id self.perms id
      -> id_Inner_T'0 (index_FMap_Id_PermCellOwn_Inner_T self.perms id) = id
      /\ match val_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self.perms id) with
        | Direct v -> index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id = view_Vec_T_Global v
        | Link index value next -> contains_Id'0 (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))
        /\ index_Mapping_Id_Int self.depth id
          > index_Mapping_Id_Int self.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))
        /\ UInt64.t'int index
          < Seq.length (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next)))
        /\ index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id
        = Seq.set (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))) (UInt64.t'int index) value
        end)
  
  meta "rewrite_def" predicate partial_invariant_T
  
  predicate protocol_PA_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    partial_invariant_T self resource_id
    /\ (forall id: t_Id. contains_Id'0 (view_Authority_Id_Seq_T self.auth) id -> contains_Id self.perms id)
  
  meta "rewrite_def" predicate protocol_PA_T
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec get_inner_immut_T (inner: t_Rc_PermCell_Inner_T_Global) (i: UInt64.t) (pa: t_PA_T) (return (x: t_T)) =
    {[@expl:get_inner_immut 'inner' type invariant] inv_ref_Rc_PermCell_Inner_T_Global inner}
    {[@expl:get_inner_immut 'pa' type invariant] inv_Ghost_ref_PA_T pa}
    {[@expl:get_inner_immut requires #0] exists p: t_Id. protocol_PA_T pa p}
    {[@expl:get_inner_immut requires #1] contains_Id'0 (view_Authority_Id_Seq_T pa.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global inner))}
    {[@expl:get_inner_immut requires #2] UInt64.t'int i
    < Seq.length (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T pa.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global inner)))}
    (! bb0
    [ bb0 = s0
      [ s0 = deref_Rc_PermCell_Inner_T_Global {inner} (fun (_x: t_PermCell_Inner_T) -> [ &_20 <- _x ] s1)
      | s1 = deref_Ghost_ref_PA_T {pa} (fun (_x: t_PA_T) -> [ &_27 <- _x ] s2)
      | s2 = deref_Rc_PermCell_Inner_T_Global {inner} (fun (_x: t_PermCell_Inner_T) -> [ &_35 <- _x ] s3)
      | s3 = id_ghost_Inner_T {_35} (fun (_x: t_Id) -> [ &_33 <- _x ] s4)
      | s4 = deref_Ghost_Id {_33} (fun (_x: t_Id) -> [ &_31 <- _x ] s5)
      | s5 = [ &_30 <- _31 ] s6
      | s6 = get_ghost_Id {_27.perms} {_30} (fun (_x: t_Option_ref_PermCellOwn_Inner_T) -> [ &_25 <- _x ] s7)
      | s7 = unwrap_ref_PermCellOwn_Inner_T {_25} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_24 <- _x ] s8)
      | s8 = new_ref_PermCellOwn_Inner_T {_24} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_22 <- _x ] s9)
      | s9 = borrow_Inner_T {_20} {_22} (fun (_x: t_Inner_T) -> [ &_18 <- _x ] s10)
      | s10 = any
        [ br0 (x0: t_Vec_T_Global) -> {_18 = Direct x0} (! bb15)
        | br1 (x0: UInt64.t) (x1: t_T) (x2: t_Rc_PermCell_Inner_T_Global) -> {_18 = Link x0 x1 x2} (! bb14) ] ]
    | bb14 = s0
      [ s0 = elim_Link {_18}
          (fun (rindex: UInt64.t) (rvalue: t_T) (rnext: t_Rc_PermCell_Inner_T_Global) -> [ &index <- rindex ] s1)
      | s1 = [ &index'0 <- index ] s2
      | s2 = elim_Link {_18}
          (fun (rindex: UInt64.t) (rvalue: t_T) (rnext: t_Rc_PermCell_Inner_T_Global) -> [ &value <- rvalue ] s3)
      | s3 = [ &_49 <- i = index'0 ] s4
      | s4 = any [ br0 -> {_49 = false} (! bb13) | br1 -> {_49} (! bb17) ] ]
    | bb17 = s0 [ s0 = [ &_17 <- value ] s1 | s1 = bb20 ]
    | bb13 = s0
      [ s0 = elim_Link {_18}
          (fun (rindex: UInt64.t) (rvalue: t_T) (rnext: t_Rc_PermCell_Inner_T_Global) -> [ &next <- rnext ] s1)
      | s1 = get_inner_immut_T {next} {i} {pa} (fun (_x: t_T) -> [ &_54 <- _x ] s2)
      | s2 = [ &_53 <- _54 ] s3
      | s3 = [ &_17 <- _53 ] s4
      | s4 = bb20 ]
    | bb15 = s0
      [ s0 = elim_Direct {_18} (fun (r0: t_Vec_T_Global) -> [ &v <- r0 ] s1)
      | s1 = index_Vec_T_Global {v} {i} (fun (_x: t_T) -> [ &_42 <- _x ] s2)
      | s2 = [ &_41 <- _42 ] s3
      | s3 = [ &_17 <- _41 ] s4
      | s4 = bb20 ]
    | bb20 = s0 [ s0 = [ &_ret <- _17 ] s1 | s1 = return {_ret} ] ]
    [ & _ret: t_T = Any.any_l ()
    | & inner: t_Rc_PermCell_Inner_T_Global = inner
    | & i: UInt64.t = i
    | & pa: t_PA_T = pa
    | & _17: t_T = Any.any_l ()
    | & _18: t_Inner_T = Any.any_l ()
    | & _20: t_PermCell_Inner_T = Any.any_l ()
    | & _22: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _24: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _25: t_Option_ref_PermCellOwn_Inner_T = Any.any_l ()
    | & _27: t_PA_T = Any.any_l ()
    | & _30: t_Id = Any.any_l ()
    | & _31: t_Id = Any.any_l ()
    | & _33: t_Id = Any.any_l ()
    | & _35: t_PermCell_Inner_T = Any.any_l ()
    | & v: t_Vec_T_Global = Any.any_l ()
    | & _41: t_T = Any.any_l ()
    | & _42: t_T = Any.any_l ()
    | & index: UInt64.t = Any.any_l ()
    | & index'0: UInt64.t = Any.any_l ()
    | & value: t_T = Any.any_l ()
    | & _49: bool = Any.any_l ()
    | & next: t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & _53: t_T = Any.any_l ()
    | & _54: t_T = Any.any_l () ])
    [ return (result: t_T) -> {[@expl:get_inner_immut result type invariant] inv_ref_T result}
      {[@expl:get_inner_immut ensures] result
      = Seq.get (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T pa.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global inner))) (UInt64.t'int i)}
      (! return {result}) ]
end
module M_implementation__impl_PersistentArray_T__get (* implementation::PersistentArray<T> *)
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use creusot.prelude.MutBorrow
  use map.Map
  use creusot.int.UInt64
  use seq.Seq
  use mach.int.Int
  use creusot.slice.Slice64
  use creusot.prelude.Any
  use set.Set
  
  type t_LocalInvariant_PA_T
  
  type t_Id
  
  function public_PA_T (self: t_LocalInvariant_PA_T) : t_Id
  
  type t_Rc_LocalInvariant_PA_T_Global
  
  function view_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) : t_LocalInvariant_PA_T
  
  type t_Rc_PermCell_Inner_T_Global
  
  type t_Fragment_Id_Seq_T
  
  type t_PersistentArray_T = {
    permcell: t_Rc_PermCell_Inner_T_Global;
    frag: t_Fragment_Id_Seq_T;
    inv: t_Rc_LocalInvariant_PA_T_Global }
  
  type t_FMap_Id_PermCellOwn_Inner_T
  
  type t_Authority_Id_Seq_T
  
  type t_PA_T = { perms: t_FMap_Id_PermCellOwn_Inner_T; auth: t_Authority_Id_Seq_T; depth: Map.map t_Id int }
  
  type t_PermCellOwn_Inner_T
  
  type t_Option_PermCellOwn_Inner_T = None | Some t_PermCellOwn_Inner_T
  
  function view_FMap_Id_PermCellOwn_Inner_T (self: t_FMap_Id_PermCellOwn_Inner_T) : Map.map t_Id t_Option_PermCellOwn_Inner_T
  
  function get_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_Option_PermCellOwn_Inner_T =
    Map.get (view_FMap_Id_PermCellOwn_Inner_T self) k
  
  meta "rewrite_def" function get_Id
  
  predicate contains_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) = get_Id self k <> None
  
  meta "rewrite_def" predicate contains_Id
  
  predicate inv_Id [@inline:trivial] (_1: t_Id) = true
  
  meta "rewrite_def" predicate inv_Id
  
  type t_Vec_T_Global
  
  type t_T
  
  type t_Inner_T = Direct t_Vec_T_Global | Link UInt64.t t_T t_Rc_PermCell_Inner_T_Global
  
  predicate inv_T (_1: t_T)
  
  predicate invariant_Box_T_Global (self: t_T) = inv_T self
  
  predicate inv_Box_T_Global [@inline:trivial] (_1: t_T) = invariant_Box_T_Global _1
  
  meta "rewrite_def" predicate inv_Box_T_Global
  
  predicate invariant_Seq_T [@inline:trivial] (self: Seq.seq t_T) =
    forall i: int. 0 <= i /\ i < Seq.length self -> inv_Box_T_Global (Seq.get self i)
  
  meta "rewrite_def" predicate invariant_Seq_T
  
  predicate inv_Seq_T [@inline:trivial] (_1: Seq.seq t_T) = invariant_Seq_T _1
  
  meta "rewrite_def" predicate inv_Seq_T
  
  constant const_MAX: UInt64.t = (18446744073709551615: UInt64.t)
  
  function view_Vec_T_Global (self: t_Vec_T_Global) : Seq.seq t_T
  
  axiom view_Vec_T_Global_spec: forall self: t_Vec_T_Global. Seq.length (view_Vec_T_Global self)
      <= UInt64.t'int const_MAX
  
  predicate invariant_Vec_T_Global (self: t_Vec_T_Global) = inv_Seq_T (view_Vec_T_Global self)
  
  predicate inv_Vec_T_Global (_1: t_Vec_T_Global)
  
  axiom inv_axiom: forall x: t_Vec_T_Global [inv_Vec_T_Global x]. inv_Vec_T_Global x -> invariant_Vec_T_Global x
  
  predicate inv_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate inv_Inner_T (_1: t_Inner_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_Inner_T [inv_Inner_T x]. inv_Inner_T x
      = match x with
        | Direct f0 -> inv_Vec_T_Global f0
        | Link index value next -> inv_T value /\ inv_Rc_PermCell_Inner_T_Global next
        end
  
  predicate invariant_ref_Inner_T [@inline:trivial] (self: t_Inner_T) = inv_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_Inner_T
  
  predicate inv_ref_Inner_T [@inline:trivial] (_1: t_Inner_T) = invariant_ref_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Inner_T
  
  function val_Inner_T (self: t_PermCellOwn_Inner_T) : t_Inner_T
  
  predicate invariant_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_ref_Inner_T (val_Inner_T self)
  
  meta "rewrite_def" predicate invariant_PermCellOwn_Inner_T
  
  predicate inv_PermCellOwn_Inner_T (_1: t_PermCellOwn_Inner_T)
  
  axiom inv_axiom'1 [@rewrite]: forall x: t_PermCellOwn_Inner_T [inv_PermCellOwn_Inner_T x]. inv_PermCellOwn_Inner_T x
      = invariant_PermCellOwn_Inner_T x
  
  predicate index_Mapping_PermCellOwn_Inner_T_bool [@inline:trivial] (self: Map.map t_PermCellOwn_Inner_T bool) (a: t_PermCellOwn_Inner_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_PermCellOwn_Inner_T_bool
  
  function such_that_PermCellOwn_Inner_T (p: Map.map t_PermCellOwn_Inner_T bool) : t_PermCellOwn_Inner_T
  
  axiom such_that_PermCellOwn_Inner_T_spec:
    forall p: Map.map t_PermCellOwn_Inner_T bool. (exists x: t_PermCellOwn_Inner_T. index_Mapping_PermCellOwn_Inner_T_bool p x)
      -> index_Mapping_PermCellOwn_Inner_T_bool p (such_that_PermCellOwn_Inner_T p)
  
  function unwrap_Option_PermCellOwn_Inner_T (self: t_Option_PermCellOwn_Inner_T) : t_PermCellOwn_Inner_T =
    match self with
      | Some x -> x
      | None -> such_that_PermCellOwn_Inner_T (fun (__0: t_PermCellOwn_Inner_T) -> true)
      end
  
  function lookup_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_PermCellOwn_Inner_T =
    unwrap_Option_PermCellOwn_Inner_T (get_Id self k)
  
  meta "rewrite_def" function lookup_Id
  
  function index_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) : t_PermCellOwn_Inner_T
   = lookup_Id self key
  
  meta "rewrite_def" function index_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    forall k: t_Id. contains_Id self k -> inv_Id k /\ inv_PermCellOwn_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self k)
  
  meta "rewrite_def" predicate invariant_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_FMap_Id_PermCellOwn_Inner_T (_1: t_FMap_Id_PermCellOwn_Inner_T)
  
  axiom inv_axiom'2 [@rewrite]:
    forall x: t_FMap_Id_PermCellOwn_Inner_T [inv_FMap_Id_PermCellOwn_Inner_T x]. inv_FMap_Id_PermCellOwn_Inner_T x
      = invariant_FMap_Id_PermCellOwn_Inner_T x
  
  predicate invariant_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T)
  
  predicate inv_Authority_Id_Seq_T (_1: t_Authority_Id_Seq_T)
  
  axiom inv_axiom'3: forall x: t_Authority_Id_Seq_T [inv_Authority_Id_Seq_T x]. inv_Authority_Id_Seq_T x
      -> invariant_Authority_Id_Seq_T x
  
  predicate inv_PA_T (_1: t_PA_T)
  
  axiom inv_axiom'4 [@rewrite]: forall x: t_PA_T [inv_PA_T x]. inv_PA_T x
      = (inv_FMap_Id_PermCellOwn_Inner_T x.perms /\ inv_Authority_Id_Seq_T x.auth)
  
  predicate invariant_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) =
    inv_PA_T self.current /\ inv_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_PA_T
  
  predicate inv_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_PA_T
  
  predicate invariant_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_PA_T
  
  predicate inv_Ghost_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_PA_T
  
  predicate invariant_ref_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) = inv_Ghost_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_ref_PA_T
  
  predicate inv_ref_Ghost_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_ref_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_ref_PA_T
  
  predicate invariant_ref_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_ref_ref_PA_T
  
  predicate inv_ref_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_ref_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_ref_PA_T
  
  let rec deref_Ghost_ref_PA_T (self: MutBorrow.t t_PA_T) (return (x: MutBorrow.t t_PA_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_ref_PA_T self}
    any [ return (result: MutBorrow.t t_PA_T) -> {inv_ref_ref_PA_T result} {result = self} (! return {result}) ]
  
  type closure0 = { c0: t_PersistentArray_T; c1: t_Id; c2: UInt64.t }
  
  predicate invariant_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T)
  
  predicate inv_Fragment_Id_Seq_T (_1: t_Fragment_Id_Seq_T)
  
  axiom inv_axiom'5: forall x: t_Fragment_Id_Seq_T [inv_Fragment_Id_Seq_T x]. inv_Fragment_Id_Seq_T x
      -> invariant_Fragment_Id_Seq_T x
  
  predicate invariant_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_Ghost_Fragment_Id_Seq_T
  
  predicate inv_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_Ghost_Fragment_Id_Seq_T
  
  predicate invariant_ref_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) =
    inv_Ghost_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Fragment_Id_Seq_T
  
  predicate inv_ref_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_ref_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Fragment_Id_Seq_T
  
  predicate invariant_ref_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Fragment_Id_Seq_T
  
  predicate inv_ref_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) = invariant_ref_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Fragment_Id_Seq_T
  
  let rec deref_Ghost_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) (return (x: t_Fragment_Id_Seq_T)) =
    {[@expl:deref 'self' type invariant] inv_ref_Ghost_Fragment_Id_Seq_T self}
    any
    [ return (result: t_Fragment_Id_Seq_T) -> {inv_ref_Fragment_Id_Seq_T result} {result = self} (! return {result}) ]
  
  predicate invariant_ref_Authority_Id_Seq_T [@inline:trivial] (self: t_Authority_Id_Seq_T) =
    inv_Authority_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_ref_Authority_Id_Seq_T
  
  predicate inv_ref_Authority_Id_Seq_T [@inline:trivial] (_1: t_Authority_Id_Seq_T) =
    invariant_ref_Authority_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_ref_Authority_Id_Seq_T
  
  function id_Id (self: t_Authority_Id_Seq_T) : t_Id
  
  function id_Id'0 (self: t_Fragment_Id_Seq_T) : t_Id
  
  type t_FMap_Id_Seq_T
  
  type t_Option_Seq_T = None'0 | Some'0 (Seq.seq t_T)
  
  function view_FMap_Id_Seq_T (self: t_FMap_Id_Seq_T) : Map.map t_Id t_Option_Seq_T
  
  function get_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : t_Option_Seq_T =
    Map.get (view_FMap_Id_Seq_T self) k
  
  meta "rewrite_def" function get_Id'0
  
  function view_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T) : t_FMap_Id_Seq_T
  
  type tup2_Id_Seq_T = { f0: t_Id; f1: Seq.seq t_T }
  
  function view_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) : tup2_Id_Seq_T
  
  let rec contains_Id'0 (self: t_Authority_Id_Seq_T) (frag'0: t_Fragment_Id_Seq_T) (return (x: ())) =
    {[@expl:contains 'self' type invariant] inv_ref_Authority_Id_Seq_T self}
    {[@expl:contains 'frag' type invariant] inv_ref_Fragment_Id_Seq_T frag'0}
    {[@expl:contains requires] id_Id self = id_Id'0 frag'0}
    any
    [ return (result: ()) -> {get_Id'0 (view_Authority_Id_Seq_T self) (view_Fragment_Id_Seq_T frag'0).f0
      = Some'0 ((view_Fragment_Id_Seq_T frag'0).f1)}
      (! return {result}) ]
  
  let rec new_unit (x: ()) (return (x'0: ())) = any [ return (result: ()) -> {result = x} (! return {result}) ]
  
  predicate invariant_ref_Ghost_ref_PA_T'0 [@inline:trivial] (self: MutBorrow.t (MutBorrow.t t_PA_T)) =
    inv_Ghost_ref_PA_T self.current /\ inv_Ghost_ref_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Ghost_ref_PA_T'0
  
  predicate inv_ref_Ghost_ref_PA_T'0 [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) =
    invariant_ref_Ghost_ref_PA_T'0 _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_ref_PA_T'0
  
  predicate invariant_ref_ref_PA_T'0 [@inline:trivial] (self: MutBorrow.t (MutBorrow.t t_PA_T)) =
    inv_ref_PA_T self.current /\ inv_ref_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_ref_PA_T'0
  
  predicate inv_ref_ref_PA_T'0 [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) = invariant_ref_ref_PA_T'0 _1
  
  meta "rewrite_def" predicate inv_ref_ref_PA_T'0
  
  let rec deref_mut_Ghost_ref_PA_T (self: MutBorrow.t (MutBorrow.t t_PA_T))
    (return (x: MutBorrow.t (MutBorrow.t t_PA_T))) =
    {[@expl:deref_mut 'self' type invariant] inv_ref_Ghost_ref_PA_T'0 self}
    any
    [ return (result: MutBorrow.t (MutBorrow.t t_PA_T)) -> {inv_ref_ref_PA_T'0 result}
      {result = self}
      (! return {result}) ]
  
  predicate resolve_ref_ref_PA_T [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_ref_PA_T
  
  let rec new_ref_PA_T (x: MutBorrow.t t_PA_T) (return (x'0: MutBorrow.t t_PA_T)) =
    {[@expl:new 'x' type invariant] inv_ref_PA_T x}
    any [ return (result: MutBorrow.t t_PA_T) -> {inv_Ghost_ref_PA_T result} {result = x} (! return {result}) ]
  
  predicate resolve_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_PA_T
  
  predicate invariant_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (self: t_Rc_PermCell_Inner_T_Global) =
    inv_Rc_PermCell_Inner_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_PermCell_Inner_T_Global
  
  predicate inv_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (_1: t_Rc_PermCell_Inner_T_Global) =
    invariant_ref_Rc_PermCell_Inner_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_PermCell_Inner_T_Global
  
  predicate contains_Id'1 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) = get_Id'0 self k <> None'0
  
  meta "rewrite_def" predicate contains_Id'1
  
  function id_Inner_T (self: t_PermCellOwn_Inner_T) : t_Id
  
  predicate index_Mapping_Seq_T_bool [@inline:trivial] (self: Map.map (Seq.seq t_T) bool) (a: Seq.seq t_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_Seq_T_bool
  
  function such_that_Seq_T (p: Map.map (Seq.seq t_T) bool) : Seq.seq t_T
  
  axiom such_that_Seq_T_spec:
    forall p: Map.map (Seq.seq t_T) bool. (exists x: Seq.seq t_T. index_Mapping_Seq_T_bool p x)
      -> index_Mapping_Seq_T_bool p (such_that_Seq_T p)
  
  function unwrap_Option_Seq_T (self: t_Option_Seq_T) : Seq.seq t_T = match self with
      | Some'0 x -> x
      | None'0 -> such_that_Seq_T (fun (__0: Seq.seq t_T) -> true)
      end
  
  function lookup_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : Seq.seq t_T =
    unwrap_Option_Seq_T (get_Id'0 self k)
  
  meta "rewrite_def" function lookup_Id'0
  
  function index_FMap_Id_Seq_T [@inline:trivial] (self: t_FMap_Id_Seq_T) (key: t_Id) : Seq.seq t_T =
    lookup_Id'0 self key
  
  meta "rewrite_def" function index_FMap_Id_Seq_T
  
  type t_PermCell_Inner_T
  
  function id_Inner_T'0 (self: t_PermCell_Inner_T) : t_Id
  
  function view_Rc_PermCell_Inner_T_Global (self: t_Rc_PermCell_Inner_T_Global) : t_PermCell_Inner_T
  
  function index_Mapping_Id_Int [@inline:trivial] (self: Map.map t_Id int) (a: t_Id) : int = Map.get self a
  
  meta "rewrite_def" function index_Mapping_Id_Int
  
  predicate partial_invariant_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    id_Id self.auth = resource_id
    /\ (forall id: t_Id. contains_Id'1 (view_Authority_Id_Seq_T self.auth) id /\ contains_Id self.perms id
      -> id_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self.perms id) = id
      /\ match val_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self.perms id) with
        | Direct v -> index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id = view_Vec_T_Global v
        | Link index value next -> contains_Id'1 (view_Authority_Id_Seq_T self.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global next))
        /\ index_Mapping_Id_Int self.depth id
          > index_Mapping_Id_Int self.depth (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global next))
        /\ UInt64.t'int index
          < Seq.length (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global next)))
        /\ index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id
        = Seq.set (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global next))) (UInt64.t'int index) value
        end)
  
  meta "rewrite_def" predicate partial_invariant_T
  
  function fin_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) : t_PA_T = self.final
  
  meta "rewrite_def" function fin_Ghost_ref_PA_T
  
  let rec reroot_T (cur: t_Rc_PermCell_Inner_T_Global) (auth_id: t_Id) (pa: MutBorrow.t t_PA_T) (return (x: ())) =
    {[@expl:reroot 'cur' type invariant] inv_ref_Rc_PermCell_Inner_T_Global cur}
    {[@expl:reroot 'pa' type invariant] inv_Ghost_ref_PA_T pa}
    {[@expl:reroot requires #0] partial_invariant_T pa.current auth_id}
    {[@expl:reroot requires #1] contains_Id'1 (view_Authority_Id_Seq_T pa.current.auth) (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global cur))}
    {[@expl:reroot requires #2] forall id: t_Id. contains_Id'1 (view_Authority_Id_Seq_T pa.current.auth) id
        /\ index_Mapping_Id_Int pa.current.depth id
        <= index_Mapping_Id_Int pa.current.depth (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global cur))
      -> contains_Id pa.current.perms id}
    any
    [ return (result: ()) -> {partial_invariant_T (fin_Ghost_ref_PA_T pa) auth_id}
      {(fin_Ghost_ref_PA_T pa).auth = pa.current.auth}
      {forall id: t_Id. index_Mapping_Id_Int pa.current.depth id
          > index_Mapping_Id_Int pa.current.depth (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global cur))
        -> get_Id pa.current.perms id = get_Id (fin_Ghost_ref_PA_T pa).perms id
        /\ index_Mapping_Id_Int pa.current.depth id = index_Mapping_Id_Int (fin_Ghost_ref_PA_T pa).depth id}
      {forall id: t_Id. contains_Id (fin_Ghost_ref_PA_T pa).perms id = contains_Id pa.current.perms id}
      {match val_Inner_T (index_FMap_Id_PermCellOwn_Inner_T (fin_Ghost_ref_PA_T pa).perms (id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global cur))) with
        | Direct _ -> true
        | Link _ _ _ -> false
        end}
      (! return {result}) ]
  
  let rec into_inner_ref_PA_T (self: MutBorrow.t t_PA_T) (return (x: MutBorrow.t t_PA_T)) =
    {[@expl:into_inner 'self' type invariant] inv_Ghost_ref_PA_T self}
    any [ return (result: MutBorrow.t t_PA_T) -> {inv_ref_PA_T result} {result = self} (! return {result}) ]
  
  let rec deref_Rc_PermCell_Inner_T_Global (self_: t_Rc_PermCell_Inner_T_Global) (return (x: t_PermCell_Inner_T)) =
    {[@expl:deref 'self_' type invariant] inv_ref_Rc_PermCell_Inner_T_Global self_}
    any [ return (result: t_PermCell_Inner_T) -> {result = view_Rc_PermCell_Inner_T_Global self_} (! return {result}) ]
  
  let rec id_ghost_Inner_T (self: t_PermCell_Inner_T) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = id_Inner_T'0 self} (! return {result}) ]
  
  let rec deref_Ghost_Id (self: t_Id) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = self} (! return {result}) ]
  
  type t_Option_ref_PermCellOwn_Inner_T = None'1 | Some'1 t_PermCellOwn_Inner_T
  
  predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    inv_FMap_Id_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (_1: t_FMap_Id_PermCellOwn_Inner_T) =
    invariant_ref_FMap_Id_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_ref_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_PermCellOwn_Inner_T
  
  predicate inv_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_ref_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_PermCellOwn_Inner_T
  
  predicate inv_Option_ref_PermCellOwn_Inner_T (_1: t_Option_ref_PermCellOwn_Inner_T)
  
  axiom inv_axiom'6 [@rewrite]:
    forall x: t_Option_ref_PermCellOwn_Inner_T [inv_Option_ref_PermCellOwn_Inner_T x]. inv_Option_ref_PermCellOwn_Inner_T x
      = match x with
        | None'1 -> true
        | Some'1 f0'0 -> inv_ref_PermCellOwn_Inner_T f0'0
        end
  
  function map_Option_PermCellOwn_Inner_T (self: t_Option_PermCellOwn_Inner_T) (f: Map.map t_PermCellOwn_Inner_T t_PermCellOwn_Inner_T) : t_Option_ref_PermCellOwn_Inner_T
   = match self with
      | None -> None'1
      | Some x -> Some'1 (Map.get f x)
      end
  
  let rec get_ghost_Id (self: t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id)
    (return (x: t_Option_ref_PermCellOwn_Inner_T)) =
    {[@expl:get_ghost 'self' type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T self}
    any
    [ return (result: t_Option_ref_PermCellOwn_Inner_T) -> {inv_Option_ref_PermCellOwn_Inner_T result}
      {result = map_Option_PermCellOwn_Inner_T (get_Id self key) (fun (v: t_PermCellOwn_Inner_T) -> v)}
      (! return {result}) ]
  
  let rec unwrap_ref_PermCellOwn_Inner_T (self_: t_Option_ref_PermCellOwn_Inner_T) (return (x: t_PermCellOwn_Inner_T)) =
    {[@expl:unwrap 'self_' type invariant] inv_Option_ref_PermCellOwn_Inner_T self_}
    {[@expl:unwrap requires] self_ <> None'1}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_ref_PermCellOwn_Inner_T result}
      {Some'1 result = self_}
      (! return {result}) ]
  
  predicate invariant_Ghost_ref_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_ref_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_PermCellOwn_Inner_T
  
  predicate inv_Ghost_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_Ghost_ref_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_PermCellOwn_Inner_T
  
  let rec new_ref_PermCellOwn_Inner_T (x: t_PermCellOwn_Inner_T) (return (x'0: t_PermCellOwn_Inner_T)) =
    {[@expl:new 'x' type invariant] inv_ref_PermCellOwn_Inner_T x}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_Ghost_ref_PermCellOwn_Inner_T result}
      {result = x}
      (! return {result}) ]
  
  function view_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) : t_Inner_T = val_Inner_T self
  
  meta "rewrite_def" function view_PermCellOwn_Inner_T
  
  let rec borrow_Inner_T (self: t_PermCell_Inner_T) (perm: t_PermCellOwn_Inner_T) (return (x: t_Inner_T)) =
    {[@expl:borrow 'perm' type invariant] inv_Ghost_ref_PermCellOwn_Inner_T perm}
    {[@expl:borrow requires] id_Inner_T'0 self = id_Inner_T perm}
    any
    [ return (result: t_Inner_T) -> {inv_ref_Inner_T result}
      {result = view_PermCellOwn_Inner_T perm}
      (! return {result}) ]
  
  let rec elim_Direct (_x: t_Inner_T) (return (f0'0: t_Vec_T_Global)) = any
    [ _k (f0'0: t_Vec_T_Global) -> {Direct f0'0 = _x} (! return {f0'0})
    | _chk -> (! {match _x with
        | Direct _ -> true
        | _ -> false
        end}
      any) ]
  
  predicate invariant_ref_Vec_T_Global [@inline:trivial] (self: t_Vec_T_Global) = inv_Vec_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Vec_T_Global
  
  predicate inv_ref_Vec_T_Global [@inline:trivial] (_1: t_Vec_T_Global) = invariant_ref_Vec_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Vec_T_Global
  
  predicate invariant_slice_T (self: Slice64.slice t_T) = inv_Seq_T (Slice64.view self)
  
  predicate inv_slice_T [@inline:trivial] (_1: Slice64.slice t_T) = invariant_slice_T _1
  
  meta "rewrite_def" predicate inv_slice_T
  
  predicate invariant_ref_slice_T [@inline:trivial] (self: Slice64.slice t_T) = inv_slice_T self
  
  meta "rewrite_def" predicate invariant_ref_slice_T
  
  predicate inv_ref_slice_T [@inline:trivial] (_1: Slice64.slice t_T) = invariant_ref_slice_T _1
  
  meta "rewrite_def" predicate inv_ref_slice_T
  
  let rec deref_Vec_T_Global (self_: t_Vec_T_Global) (return (x: Slice64.slice t_T)) =
    {[@expl:deref 'self_' type invariant] inv_ref_Vec_T_Global self_}
    any
    [ return (result: Slice64.slice t_T) -> {inv_ref_slice_T result}
      {Slice64.view result = view_Vec_T_Global self_}
      (! return {result}) ]
  
  predicate in_bounds_usize [@inline:trivial] (self: UInt64.t) (seq: Seq.seq t_T) = UInt64.t'int self < Seq.length seq
  
  meta "rewrite_def" predicate in_bounds_usize
  
  predicate invariant_ref_T [@inline:trivial] (self: t_T) = inv_T self
  
  meta "rewrite_def" predicate invariant_ref_T
  
  predicate inv_ref_T [@inline:trivial] (_1: t_T) = invariant_ref_T _1
  
  meta "rewrite_def" predicate inv_ref_T
  
  predicate has_value_usize [@inline:trivial] (self: UInt64.t) (seq: Seq.seq t_T) (out: t_T) =
    Seq.get seq (UInt64.t'int self) = out
  
  meta "rewrite_def" predicate has_value_usize
  
  let rec get_unchecked_T (self_: Slice64.slice t_T) (ix: UInt64.t) (return (x: t_T)) =
    {[@expl:get_unchecked 'self_' type invariant] inv_ref_slice_T self_}
    {[@expl:get_unchecked requires] in_bounds_usize ix (Slice64.view self_)}
    any
    [ return (result: t_T) -> {inv_ref_T result} {has_value_usize ix (Slice64.view self_) result} (! return {result}) ]
  
  function namespace_PA_T (self: t_LocalInvariant_PA_T) : t_Namespace
  
  predicate invariant_PersistentArray_T (self: t_PersistentArray_T) =
    (view_Fragment_Id_Seq_T self.frag).f0 = id_Inner_T'0 (view_Rc_PermCell_Inner_T_Global self.permcell)
    /\ id_Id'0 self.frag = public_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv)
    /\ namespace_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv) = Namespace_PARRAY 0
  
  predicate inv_Rc_LocalInvariant_PA_T_Global (_1: t_Rc_LocalInvariant_PA_T_Global)
  
  predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_PersistentArray_T (_1: t_PersistentArray_T)
  
  axiom inv_axiom'7 [@rewrite]: forall x: t_PersistentArray_T [inv_PersistentArray_T x]. inv_PersistentArray_T x
      = (invariant_PersistentArray_T x
      /\ inv_Rc_PermCell_Inner_T_Global x.permcell
      /\ inv_Ghost_Fragment_Id_Seq_T x.frag /\ inv_Ghost_Rc_LocalInvariant_PA_T_Global x.inv)
  
  predicate invariant_ref_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) = inv_PersistentArray_T self
  
  meta "rewrite_def" predicate invariant_ref_PersistentArray_T
  
  predicate inv_ref_PersistentArray_T [@inline:trivial] (_1: t_PersistentArray_T) = invariant_ref_PersistentArray_T _1
  
  meta "rewrite_def" predicate inv_ref_PersistentArray_T
  
  predicate inv_closure0 [@inline:trivial] (_1: closure0) =
    let {c0 = x0; c1 = x1; c2 = x2} = _1 in inv_ref_PersistentArray_T x0
  
  meta "rewrite_def" predicate inv_closure0
  
  let rec closure0 [@coma:extspec] (self: closure0) (pa: MutBorrow.t t_PA_T) (return (x: t_T)) = bb0
    [ bb0 = s0
      [ s0 = deref_Ghost_ref_PA_T {pa} (fun (_x: MutBorrow.t t_PA_T) -> [ &_6 <- _x ] s1)
      | s1 = [ &_11 <- self.c0.frag ] s2
      | s2 = deref_Ghost_Fragment_Id_Seq_T {_11} (fun (_x: t_Fragment_Id_Seq_T) -> [ &_9 <- _x ] s3)
      | s3 = contains_Id'0 {_6.current.auth} {_9} (fun (_x: ()) -> [ &_4 <- _x ] s4)
      | s4 = new_unit {_4} (fun (_x: ()) -> [ &_3 <- _x ] s5)
      | s5 = [ &_14 <- self.c0.permcell ] s6
      | s6 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_21 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s7) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s7 = deref_mut_Ghost_ref_PA_T {_21} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_20 <- _x ] s8)
      | s8 = MutBorrow.borrow_final <MutBorrow.t t_PA_T> {_20.current} {MutBorrow.get_id _20}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_19 <- _bor ] -{inv_ref_PA_T _bor.final}-
            [ &_20 <- { _20 with current = _bor.final } ] s9) [ _ck -> (! {inv_ref_PA_T _20.current} any) ]
      | s9 = MutBorrow.borrow_mut <t_PA_T> {_19.current.current}
          (fun (_bor: MutBorrow.t t_PA_T) ->
            [ &_18 <- _bor ] -{inv_PA_T _bor.final}-
            [ &_19 <- { _19 with current = { _19.current with current = _bor.final } } ] s10)
        [ _ck -> (! {inv_PA_T _19.current.current} any) ]
      | s10 = s11 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T'0 _20} any) ]
      | s11 = -{resolve_ref_ref_PA_T _20}- s12
      | s12 = s13 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T'0 _19} any) ]
      | s13 = -{resolve_ref_ref_PA_T _19}- s14
      | s14 = MutBorrow.borrow_final <t_PA_T> {_18.current} {MutBorrow.get_id _18}
          (fun (_bor: MutBorrow.t t_PA_T) ->
            [ &_17 <- _bor ] -{inv_PA_T _bor.final}-
            [ &_18 <- { _18 with current = _bor.final } ] s15) [ _ck -> (! {inv_PA_T _18.current} any) ]
      | s15 = new_ref_PA_T {_17} (fun (_x: MutBorrow.t t_PA_T) -> [ &_16 <- _x ] s16)
      | s16 = s17 [ _ck -> (! {[@expl:type invariant] inv_ref_PA_T _18} any) ]
      | s17 = -{resolve_ref_PA_T _18}- s18
      | s18 = reroot_T {_14} {self.c1} {_16} (fun (_x: ()) -> [ &_12 <- _x ] s19)
      | s19 = into_inner_ref_PA_T {pa} (fun (_x: MutBorrow.t t_PA_T) -> [ &_26 <- _x ] s20)
      | s20 = s21 [ _ck -> (! {[@expl:type invariant] inv_ref_PA_T _26} any) ]
      | s21 = -{resolve_ref_PA_T _26}- s22
      | s22 = deref_Rc_PermCell_Inner_T_Global {self.c0.permcell} (fun (_x: t_PermCell_Inner_T) -> [ &_34 <- _x ] s23)
      | s23 = id_ghost_Inner_T {_34} (fun (_x: t_Id) -> [ &_32 <- _x ] s24)
      | s24 = [ &_31 <- _32 ] s25
      | s25 = deref_Ghost_Id {_31} (fun (_x: t_Id) -> [ &_29 <- _x ] s26)
      | s26 = get_ghost_Id {_26.current.perms} {_29} (fun (_x: t_Option_ref_PermCellOwn_Inner_T) -> [ &_24 <- _x ] s27)
      | s27 = unwrap_ref_PermCellOwn_Inner_T {_24} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_23 <- _x ] s28)
      | s28 = new_ref_PermCellOwn_Inner_T {_23} (fun (_x: t_PermCellOwn_Inner_T) -> [ &perm <- _x ] s29)
      | s29 = deref_Rc_PermCell_Inner_T_Global {self.c0.permcell} (fun (_x: t_PermCell_Inner_T) -> [ &_40 <- _x ] s30)
      | s30 = borrow_Inner_T {_40} {perm} (fun (_x: t_Inner_T) -> [ &_38 <- _x ] s31)
      | s31 = any
        [ br0 (x0: t_Vec_T_Global) -> {_38 = Direct x0} (! bb18)
        | br1 (x0: UInt64.t) (x1: t_T) (x2: t_Rc_PermCell_Inner_T_Global) -> {_38 = Link x0 x1 x2} (! bb19) ] ]
    | bb19 = {false} any
    | bb18 = s0
      [ s0 = elim_Direct {_38} (fun (r0: t_Vec_T_Global) -> [ &arr <- r0 ] s1)
      | s1 = deref_Vec_T_Global {arr} (fun (_x: Slice64.slice t_T) -> [ &_45 <- _x ] s2)
      | s2 = get_unchecked_T {_45} {self.c2} (fun (_x: t_T) -> [ &_ret <- _x ] s3)
      | s3 = return {_ret} ] ]
    [ & _ret: t_T = Any.any_l ()
    | & self: closure0 = self
    | & pa: MutBorrow.t t_PA_T = pa
    | & _3: () = Any.any_l ()
    | & _4: () = Any.any_l ()
    | & _6: MutBorrow.t t_PA_T = Any.any_l ()
    | & _9: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _11: t_Fragment_Id_Seq_T = Any.any_l ()
    | & _12: () = Any.any_l ()
    | & _14: t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & _16: MutBorrow.t t_PA_T = Any.any_l ()
    | & _17: MutBorrow.t t_PA_T = Any.any_l ()
    | & _18: MutBorrow.t t_PA_T = Any.any_l ()
    | & _19: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _20: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _21: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & perm: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _23: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _24: t_Option_ref_PermCellOwn_Inner_T = Any.any_l ()
    | & _26: MutBorrow.t t_PA_T = Any.any_l ()
    | & _29: t_Id = Any.any_l ()
    | & _31: t_Id = Any.any_l ()
    | & _32: t_Id = Any.any_l ()
    | & _34: t_PermCell_Inner_T = Any.any_l ()
    | & arr: t_Vec_T_Global = Any.any_l ()
    | & _38: t_Inner_T = Any.any_l ()
    | & _40: t_PermCell_Inner_T = Any.any_l ()
    | & _45: Slice64.slice t_T = Any.any_l () ]
  
  meta "rewrite_def" predicate closure0'pre
  
  meta "rewrite_def" predicate closure0'post'return
  
  type t_Tokens
  
  predicate invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Ghost_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_ref_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global
  
  type tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0 = {
    f0'0: t_Rc_LocalInvariant_PA_T_Global;
    f1'0: t_Tokens;
    f2'0: closure0 }
  
  predicate invariant_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_ref_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate invariant_Ghost_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_ref_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Ghost_ref_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_Ghost_ref_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_Rc_LocalInvariant_PA_T_Global
  
  predicate precondition_deref [@inline:trivial] (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) =
    let self_ = args in inv_ref_Rc_LocalInvariant_PA_T_Global self_
  
  meta "rewrite_def" predicate precondition_deref
  
  predicate postcondition_once_deref [@inline:trivial] (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (result: t_LocalInvariant_PA_T) =
    let self_ = args in result = view_Rc_LocalInvariant_PA_T_Global self_
  
  meta "rewrite_def" predicate postcondition_once_deref
  
  predicate resolve_deref [@inline:trivial] (_1: ()) = true
  
  meta "rewrite_def" predicate resolve_deref
  
  predicate postcondition_mut_deref [@inline:trivial] (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (result_state: ()) (result: t_LocalInvariant_PA_T) =
    let self_ = args in result = view_Rc_LocalInvariant_PA_T_Global self_
  
  meta "rewrite_def" predicate postcondition_mut_deref
  
  function fn_mut_once_deref (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (res: t_LocalInvariant_PA_T) : ()
  
  axiom fn_mut_once_deref_spec:
    forall self: (), args: t_Rc_LocalInvariant_PA_T_Global, res: t_LocalInvariant_PA_T. postcondition_once_deref self args res
      = (exists res_state: (). postcondition_mut_deref self args res_state res /\ resolve_deref res_state)
  
  predicate hist_inv_deref [@inline:trivial] (self: ()) (result_state: ()) = true
  
  meta "rewrite_def" predicate hist_inv_deref
  
  function hist_inv_trans_deref (self: ()) (b: ()) (c: ()) : ()
  
  axiom hist_inv_trans_deref_spec: forall self: (), b: (), c: (). hist_inv_deref self b
      -> hist_inv_deref b c -> hist_inv_deref self c
  
  function hist_inv_refl_deref (self: ()) : ()
  
  axiom hist_inv_refl_deref_spec: forall self: (). hist_inv_deref self self
  
  function postcondition_mut_hist_inv_deref (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (res_state: ()) (res: t_LocalInvariant_PA_T) : ()
  
  axiom postcondition_mut_hist_inv_deref_spec:
    forall self: (), args: t_Rc_LocalInvariant_PA_T_Global, res_state: (), res: t_LocalInvariant_PA_T. postcondition_mut_deref self args res_state res
      -> hist_inv_deref self res_state
  
  function fn_hist_inv_deref (self: ()) (res_state: ()) : ()
  
  axiom fn_hist_inv_deref_spec: forall self: (), res_state: (). hist_inv_deref self res_state = (self = res_state)
  
  predicate postcondition_deref [@inline:trivial] (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (result: t_LocalInvariant_PA_T) =
    let self_ = args in result = view_Rc_LocalInvariant_PA_T_Global self_
  
  meta "rewrite_def" predicate postcondition_deref
  
  function fn_once_deref (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (res: t_LocalInvariant_PA_T) : ()
  
  axiom fn_once_deref_spec:
    forall self: (), args: t_Rc_LocalInvariant_PA_T_Global, res: t_LocalInvariant_PA_T. postcondition_once_deref self args res
      = (postcondition_deref self args res /\ resolve_deref self)
  
  function fn_mut_deref (self: ()) (args: t_Rc_LocalInvariant_PA_T_Global) (res_state: ()) (res: t_LocalInvariant_PA_T) : ()
  
  axiom fn_mut_deref_spec:
    forall self: (), args: t_Rc_LocalInvariant_PA_T_Global, res_state: (), res: t_LocalInvariant_PA_T. postcondition_mut_deref self args res_state res
      = (postcondition_deref self args res /\ self = res_state)
  
  type tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0 = {
    f0'1: t_LocalInvariant_PA_T;
    f1'1: t_Tokens;
    f2'1: closure0 }
  
  predicate contains_Namespace [@inline:trivial] (self: Set.set t_Namespace) (e: t_Namespace) = Set.mem e self
  
  meta "rewrite_def" predicate contains_Namespace
  
  function namespaces (self: t_Tokens) : Set.set t_Namespace
  
  predicate contains (self: t_Tokens) (namespace: t_Namespace) = contains_Namespace (namespaces self) namespace
  
  predicate protocol_PA_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    partial_invariant_T self resource_id
    /\ (forall id: t_Id. contains_Id'1 (view_Authority_Id_Seq_T self.auth) id -> contains_Id self.perms id)
  
  meta "rewrite_def" predicate protocol_PA_T
  
  predicate precondition_closure0 [@inline:trivial] (self: closure0) (args: MutBorrow.t t_PA_T) =
    let pa = args in closure0'pre self pa
  
  meta "rewrite_def" predicate precondition_closure0
  
  predicate postcondition_once_closure0 [@inline:trivial] (self: closure0) (args: MutBorrow.t t_PA_T) (result: t_T) =
    let pa = args in closure0'post'return self pa result
  
  meta "rewrite_def" predicate postcondition_once_closure0
  
  predicate precondition_open [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) =
    let {f0'1 = self'0; f1'1 = tokens; f2'1 = f} = args in inv_closure0 f
    /\ contains tokens (namespace_PA_T self'0)
    /\ (forall t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self'0) /\ inv_Ghost_ref_PA_T t
      -> precondition_closure0 f t
      /\ (forall res: t_T. postcondition_once_closure0 f t res
        -> protocol_PA_T (fin_Ghost_ref_PA_T t) (public_PA_T self'0)))
  
  meta "rewrite_def" predicate precondition_open
  
  function new_ref_LocalInvariant_PA_T (x: t_LocalInvariant_PA_T) : t_LocalInvariant_PA_T
  
  axiom new_ref_LocalInvariant_PA_T_spec: forall x: t_LocalInvariant_PA_T. new_ref_LocalInvariant_PA_T x = x
  
  predicate precondition_open'0 [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) =
    let {f0'0 = self'0; f1'0 = tokens; f2'0 = f} = args in inv_Ghost_ref_Rc_LocalInvariant_PA_T_Global self'0
    /\ inv_closure0 f
    /\ precondition_deref () self'0
    /\ (forall this: t_LocalInvariant_PA_T. postcondition_deref () self'0 this
      -> precondition_open () { f0'1 = new_ref_LocalInvariant_PA_T this; f1'1 = tokens; f2'1 = f })
  
  meta "rewrite_def" predicate precondition_open'0
  
  let rec deref_Rc_LocalInvariant_PA_T_Global (self_: t_Rc_LocalInvariant_PA_T_Global)
    (return (x: t_LocalInvariant_PA_T)) =
    {[@expl:deref 'self_' type invariant] inv_ref_Rc_LocalInvariant_PA_T_Global self_}
    any
    [ return (result: t_LocalInvariant_PA_T) -> {result = view_Rc_LocalInvariant_PA_T_Global self_}
      (! return {result}) ]
  
  let rec open_Ghost_ref_LocalInvariant_PA_T (self: t_LocalInvariant_PA_T) (tokens: t_Tokens) (f: closure0)
    (return (x: t_T)) = {[@expl:open 'f' type invariant] inv_closure0 f}
    {[@expl:open requires #0] contains tokens (namespace_PA_T self)}
    {[@expl:open requires #1] forall t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self)
        /\ inv_Ghost_ref_PA_T t
      -> precondition_closure0 f t
      /\ (forall res: t_T. postcondition_once_closure0 f t res
        -> protocol_PA_T (fin_Ghost_ref_PA_T t) (public_PA_T self))}
    any
    [ return (result: t_T) -> {inv_ref_T result}
      {exists t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self)
        /\ postcondition_once_closure0 f t result}
      (! return {result}) ]
  
  predicate postcondition_once_open [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (result: t_T) =
    let {f0'1 = self'0; f1'1 = tokens; f2'1 = f} = args in inv_ref_T result
    /\ (exists t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self'0)
      /\ postcondition_once_closure0 f t result)
  
  meta "rewrite_def" predicate postcondition_once_open
  
  predicate resolve_open [@inline:trivial] (_1: ()) = true
  
  meta "rewrite_def" predicate resolve_open
  
  predicate postcondition_mut_open [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (result_state: ()) (result: t_T) =
    let {f0'1 = self'0; f1'1 = tokens; f2'1 = f} = args in inv_ref_T result
    /\ (exists t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self'0)
      /\ postcondition_once_closure0 f t result)
  
  meta "rewrite_def" predicate postcondition_mut_open
  
  function fn_mut_once_open (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (res: t_T) : ()
  
  axiom fn_mut_once_open_spec:
    forall self: (), args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0, res: t_T. postcondition_once_open self args res
      = (exists res_state: (). postcondition_mut_open self args res_state res /\ resolve_open res_state)
  
  predicate hist_inv_open [@inline:trivial] (self: ()) (result_state: ()) = true
  
  meta "rewrite_def" predicate hist_inv_open
  
  function hist_inv_trans_open (self: ()) (b: ()) (c: ()) : ()
  
  axiom hist_inv_trans_open_spec: forall self: (), b: (), c: (). hist_inv_open self b
      -> hist_inv_open b c -> hist_inv_open self c
  
  function hist_inv_refl_open (self: ()) : ()
  
  axiom hist_inv_refl_open_spec: forall self: (). hist_inv_open self self
  
  function postcondition_mut_hist_inv_open (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (res_state: ()) (res: t_T) : ()
  
  axiom postcondition_mut_hist_inv_open_spec:
    forall self: (), args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0, res_state: (), res: t_T. postcondition_mut_open self args res_state res
      -> hist_inv_open self res_state
  
  function fn_hist_inv_open (self: ()) (res_state: ()) : ()
  
  axiom fn_hist_inv_open_spec: forall self: (), res_state: (). hist_inv_open self res_state = (self = res_state)
  
  predicate postcondition_open [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (result: t_T) =
    let {f0'1 = self'0; f1'1 = tokens; f2'1 = f} = args in inv_ref_T result
    /\ (exists t: MutBorrow.t t_PA_T. protocol_PA_T t.current (public_PA_T self'0)
      /\ postcondition_once_closure0 f t result)
  
  meta "rewrite_def" predicate postcondition_open
  
  function fn_once_open (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (res: t_T) : ()
  
  axiom fn_once_open_spec:
    forall self: (), args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0, res: t_T. postcondition_once_open self args res
      = (postcondition_open self args res /\ resolve_open self)
  
  function fn_mut_open (self: ()) (args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0) (res_state: ()) (res: t_T) : ()
  
  axiom fn_mut_open_spec:
    forall self: (), args: tup3_Ghost_ref_LocalInvariant_PA_T_Ghost_Tokens_closure0, res_state: (), res: t_T. postcondition_mut_open self args res_state res
      = (postcondition_open self args res /\ self = res_state)
  
  let rec open_Ghost_ref_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) (tokens: t_Tokens)
    (f: closure0) (return (x: t_T)) =
    {[@expl:open 'self' type invariant] inv_Ghost_ref_Rc_LocalInvariant_PA_T_Global self}
    {[@expl:open 'f' type invariant] inv_closure0 f}
    {[@expl:open requires #0] precondition_deref () self}
    {[@expl:open requires #1] forall this: t_LocalInvariant_PA_T. postcondition_deref () self this
      -> precondition_open () { f0'1 = new_ref_LocalInvariant_PA_T this; f1'1 = tokens; f2'1 = f }}
    any
    [ return (result: t_T) -> {inv_ref_T result}
      {exists this: t_LocalInvariant_PA_T. postcondition_deref () self this
        /\ postcondition_open () { f0'1 = new_ref_LocalInvariant_PA_T this; f1'1 = tokens; f2'1 = f } result}
      (! return {result}) ]
  
  function new_ref_Rc_LocalInvariant_PA_T_Global (x: t_Rc_LocalInvariant_PA_T_Global) : t_Rc_LocalInvariant_PA_T_Global
  
  axiom new_ref_Rc_LocalInvariant_PA_T_Global_spec:
    forall x: t_Rc_LocalInvariant_PA_T_Global. new_ref_Rc_LocalInvariant_PA_T_Global x = x
  
  predicate postcondition_once_open'0 [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (result: t_T) =
    let {f0'0 = self'0; f1'0 = tokens; f2'0 = f} = args in inv_ref_T result
    /\ (exists this: t_LocalInvariant_PA_T. postcondition_deref () self'0 this
      /\ postcondition_open () { f0'1 = new_ref_LocalInvariant_PA_T this; f1'1 = tokens; f2'1 = f } result)
  
  meta "rewrite_def" predicate postcondition_once_open'0
  
  predicate resolve_open'0 [@inline:trivial] (_1: ()) = true
  
  meta "rewrite_def" predicate resolve_open'0
  
  predicate postcondition_mut_open'0 [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (result_state: ()) (result: t_T) =
    let {f0'0 = self'0; f1'0 = tokens; f2'0 = f} = args in inv_ref_T result
    /\ (exists this: t_LocalInvariant_PA_T. postcondition_deref () self'0 this
      /\ postcondition_open () { f0'1 = new_ref_LocalInvariant_PA_T this; f1'1 = tokens; f2'1 = f } result)
  
  meta "rewrite_def" predicate postcondition_mut_open'0
  
  function fn_mut_once_open'0 (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (res: t_T) : ()
  
  axiom fn_mut_once_open_spec'0:
    forall self: (), args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0, res: t_T. postcondition_once_open'0 self args res
      = (exists res_state: (). postcondition_mut_open'0 self args res_state res /\ resolve_open'0 res_state)
  
  predicate hist_inv_open'0 [@inline:trivial] (self: ()) (result_state: ()) = true
  
  meta "rewrite_def" predicate hist_inv_open'0
  
  function hist_inv_trans_open'0 (self: ()) (b: ()) (c: ()) : ()
  
  axiom hist_inv_trans_open_spec'0: forall self: (), b: (), c: (). hist_inv_open'0 self b
      -> hist_inv_open'0 b c -> hist_inv_open'0 self c
  
  function hist_inv_refl_open'0 (self: ()) : ()
  
  axiom hist_inv_refl_open_spec'0: forall self: (). hist_inv_open'0 self self
  
  function postcondition_mut_hist_inv_open'0 (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (res_state: ()) (res: t_T) : ()
  
  axiom postcondition_mut_hist_inv_open_spec'0:
    forall self: (), args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0, res_state: (), res: t_T. postcondition_mut_open'0 self args res_state res
      -> hist_inv_open'0 self res_state
  
  function fn_hist_inv_open'0 (self: ()) (res_state: ()) : ()
  
  axiom fn_hist_inv_open_spec'0: forall self: (), res_state: (). hist_inv_open'0 self res_state = (self = res_state)
  
  predicate postcondition_open'0 [@inline:trivial] (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (result: t_T) =
    let {f0'0 = self'0; f1'0 = tokens; f2'0 = f} = args in inv_ref_T result
    /\ (exists this: t_LocalInvariant_PA_T. postcondition_deref () self'0 this
      /\ postcondition_open () { f0'1 = new_ref_LocalInvariant_PA_T this; f1'1 = tokens; f2'1 = f } result)
  
  meta "rewrite_def" predicate postcondition_open'0
  
  function fn_once_open'0 (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (res: t_T) : ()
  
  axiom fn_once_open_spec'0:
    forall self: (), args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0, res: t_T. postcondition_once_open'0 self args res
      = (postcondition_open'0 self args res /\ resolve_open'0 self)
  
  function fn_mut_open'0 (self: ()) (args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0) (res_state: ()) (res: t_T) : ()
  
  axiom fn_mut_open_spec'0:
    forall self: (), args: tup3_Ghost_ref_Rc_LocalInvariant_PA_T_Global_Ghost_Tokens_closure0, res_state: (), res: t_T. postcondition_mut_open'0 self args res_state res
      = (postcondition_open'0 self args res /\ self = res_state)
  
  let rec open_ref_Ghost_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) (tokens: t_Tokens)
    (f: closure0) (return (x: t_T)) =
    {[@expl:open 'self' type invariant] inv_ref_Ghost_Rc_LocalInvariant_PA_T_Global self}
    {[@expl:open 'f' type invariant] inv_closure0 f}
    {[@expl:open requires] precondition_open'0 () { f0'0 = new_ref_Rc_LocalInvariant_PA_T_Global self;
                                                    f1'0 = tokens;
                                                    f2'0 = f }}
    any
    [ return (result: t_T) -> {inv_ref_T result}
      {postcondition_open'0 () { f0'0 = new_ref_Rc_LocalInvariant_PA_T_Global self; f1'0 = tokens; f2'0 = f } result}
      (! return {result}) ]
  
  function view_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) : Seq.seq t_T =
    (view_Fragment_Id_Seq_T self.frag).f1
  
  meta "rewrite_def" function view_PersistentArray_T
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec get_T (self: t_PersistentArray_T) (index: UInt64.t) (tokens: t_Tokens) (return (x: t_T)) =
    {[@expl:get 'self' type invariant] inv_ref_PersistentArray_T self}
    {[@expl:get requires #0] contains tokens (Namespace_PARRAY 0)}
    {[@expl:get requires #1] UInt64.t'int index < Seq.length (view_PersistentArray_T self)}
    (! bb0
    [ bb0 = s0
      [ s0 = [ &auth_id <- public_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv) ] s1
      | s1 = [ &_18 <- { c0 = self; c1 = auth_id; c2 = index } ] s2
      | s2 = open_ref_Ghost_Rc_LocalInvariant_PA_T_Global {self.inv} {tokens} {_18} (fun (_x: t_T) -> [ &_15 <- _x ] s3)
      | s3 = [ &_ret <- _15 ] s4
      | s4 = return {_ret} ] ]
    [ & _ret: t_T = Any.any_l ()
    | & self: t_PersistentArray_T = self
    | & index: UInt64.t = index
    | & tokens: t_Tokens = tokens
    | & auth_id: t_Id = Any.any_l ()
    | & _15: t_T = Any.any_l ()
    | & _18: closure0 = Any.any_l () ])
    [ return (result: t_T) -> {[@expl:get result type invariant] inv_ref_T result}
      {[@expl:get ensures] result = Seq.get (view_PersistentArray_T self) (UInt64.t'int index)}
      (! return {result}) ]
end
module M_implementation__impl_PersistentArray_T__reroot (* implementation::PersistentArray<T> *)
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use creusot.prelude.MutBorrow
  use map.Map
  use creusot.int.UInt64
  use seq.Seq
  use mach.int.Int
  use int.MinMax
  use creusot.prelude.Any
  
  type t_FMap_Id_PermCellOwn_Inner_T
  
  type t_Authority_Id_Seq_T
  
  type t_Id
  
  type t_PA_T = { perms: t_FMap_Id_PermCellOwn_Inner_T; auth: t_Authority_Id_Seq_T; depth: Map.map t_Id int }
  
  type t_PermCellOwn_Inner_T
  
  type t_Option_PermCellOwn_Inner_T = None | Some t_PermCellOwn_Inner_T
  
  function view_FMap_Id_PermCellOwn_Inner_T (self: t_FMap_Id_PermCellOwn_Inner_T) : Map.map t_Id t_Option_PermCellOwn_Inner_T
  
  function get_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_Option_PermCellOwn_Inner_T =
    Map.get (view_FMap_Id_PermCellOwn_Inner_T self) k
  
  meta "rewrite_def" function get_Id
  
  predicate contains_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) = get_Id self k <> None
  
  meta "rewrite_def" predicate contains_Id
  
  predicate inv_Id [@inline:trivial] (_1: t_Id) = true
  
  meta "rewrite_def" predicate inv_Id
  
  type t_Vec_T_Global
  
  type t_T
  
  type t_Rc_PermCell_Inner_T_Global
  
  type t_Inner_T = Direct t_Vec_T_Global | Link UInt64.t t_T t_Rc_PermCell_Inner_T_Global
  
  predicate inv_T (_1: t_T)
  
  predicate invariant_Box_T_Global (self: t_T) = inv_T self
  
  predicate inv_Box_T_Global [@inline:trivial] (_1: t_T) = invariant_Box_T_Global _1
  
  meta "rewrite_def" predicate inv_Box_T_Global
  
  predicate invariant_Seq_T [@inline:trivial] (self: Seq.seq t_T) =
    forall i: int. 0 <= i /\ i < Seq.length self -> inv_Box_T_Global (Seq.get self i)
  
  meta "rewrite_def" predicate invariant_Seq_T
  
  predicate inv_Seq_T [@inline:trivial] (_1: Seq.seq t_T) = invariant_Seq_T _1
  
  meta "rewrite_def" predicate inv_Seq_T
  
  constant const_MAX: UInt64.t = (18446744073709551615: UInt64.t)
  
  function view_Vec_T_Global (self: t_Vec_T_Global) : Seq.seq t_T
  
  axiom view_Vec_T_Global_spec: forall self: t_Vec_T_Global. Seq.length (view_Vec_T_Global self)
      <= UInt64.t'int const_MAX
  
  predicate invariant_Vec_T_Global (self: t_Vec_T_Global) = inv_Seq_T (view_Vec_T_Global self)
  
  predicate inv_Vec_T_Global (_1: t_Vec_T_Global)
  
  axiom inv_axiom: forall x: t_Vec_T_Global [inv_Vec_T_Global x]. inv_Vec_T_Global x -> invariant_Vec_T_Global x
  
  predicate inv_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate inv_Inner_T (_1: t_Inner_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_Inner_T [inv_Inner_T x]. inv_Inner_T x
      = match x with
        | Direct f0 -> inv_Vec_T_Global f0
        | Link index value next -> inv_T value /\ inv_Rc_PermCell_Inner_T_Global next
        end
  
  predicate invariant_ref_Inner_T [@inline:trivial] (self: t_Inner_T) = inv_Inner_T self
  
  meta "rewrite_def" predicate invariant_ref_Inner_T
  
  predicate inv_ref_Inner_T [@inline:trivial] (_1: t_Inner_T) = invariant_ref_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Inner_T
  
  function val_Inner_T (self: t_PermCellOwn_Inner_T) : t_Inner_T
  
  predicate invariant_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_ref_Inner_T (val_Inner_T self)
  
  meta "rewrite_def" predicate invariant_PermCellOwn_Inner_T
  
  predicate inv_PermCellOwn_Inner_T (_1: t_PermCellOwn_Inner_T)
  
  axiom inv_axiom'1 [@rewrite]: forall x: t_PermCellOwn_Inner_T [inv_PermCellOwn_Inner_T x]. inv_PermCellOwn_Inner_T x
      = invariant_PermCellOwn_Inner_T x
  
  predicate index_Mapping_PermCellOwn_Inner_T_bool [@inline:trivial] (self: Map.map t_PermCellOwn_Inner_T bool) (a: t_PermCellOwn_Inner_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_PermCellOwn_Inner_T_bool
  
  function such_that_PermCellOwn_Inner_T (p: Map.map t_PermCellOwn_Inner_T bool) : t_PermCellOwn_Inner_T
  
  axiom such_that_PermCellOwn_Inner_T_spec:
    forall p: Map.map t_PermCellOwn_Inner_T bool. (exists x: t_PermCellOwn_Inner_T. index_Mapping_PermCellOwn_Inner_T_bool p x)
      -> index_Mapping_PermCellOwn_Inner_T_bool p (such_that_PermCellOwn_Inner_T p)
  
  function unwrap_Option_PermCellOwn_Inner_T (self: t_Option_PermCellOwn_Inner_T) : t_PermCellOwn_Inner_T =
    match self with
      | Some x -> x
      | None -> such_that_PermCellOwn_Inner_T (fun (__0: t_PermCellOwn_Inner_T) -> true)
      end
  
  function lookup_Id [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_PermCellOwn_Inner_T =
    unwrap_Option_PermCellOwn_Inner_T (get_Id self k)
  
  meta "rewrite_def" function lookup_Id
  
  function index_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) : t_PermCellOwn_Inner_T
   = lookup_Id self key
  
  meta "rewrite_def" function index_FMap_Id_PermCellOwn_Inner_T
  
  predicate invariant_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: t_FMap_Id_PermCellOwn_Inner_T) =
    forall k: t_Id. contains_Id self k -> inv_Id k /\ inv_PermCellOwn_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self k)
  
  meta "rewrite_def" predicate invariant_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_FMap_Id_PermCellOwn_Inner_T (_1: t_FMap_Id_PermCellOwn_Inner_T)
  
  axiom inv_axiom'2 [@rewrite]:
    forall x: t_FMap_Id_PermCellOwn_Inner_T [inv_FMap_Id_PermCellOwn_Inner_T x]. inv_FMap_Id_PermCellOwn_Inner_T x
      = invariant_FMap_Id_PermCellOwn_Inner_T x
  
  predicate invariant_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T)
  
  predicate inv_Authority_Id_Seq_T (_1: t_Authority_Id_Seq_T)
  
  axiom inv_axiom'3: forall x: t_Authority_Id_Seq_T [inv_Authority_Id_Seq_T x]. inv_Authority_Id_Seq_T x
      -> invariant_Authority_Id_Seq_T x
  
  predicate inv_PA_T (_1: t_PA_T)
  
  axiom inv_axiom'4 [@rewrite]: forall x: t_PA_T [inv_PA_T x]. inv_PA_T x
      = (inv_FMap_Id_PermCellOwn_Inner_T x.perms /\ inv_Authority_Id_Seq_T x.auth)
  
  predicate invariant_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) =
    inv_PA_T self.current /\ inv_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_PA_T
  
  predicate inv_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_PA_T
  
  predicate invariant_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) = inv_ref_PA_T self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_PA_T
  
  predicate inv_Ghost_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = invariant_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_PA_T
  
  predicate invariant_ref_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t (MutBorrow.t t_PA_T)) =
    inv_Ghost_ref_PA_T self.current /\ inv_Ghost_ref_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Ghost_ref_PA_T
  
  predicate inv_ref_Ghost_ref_PA_T [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) =
    invariant_ref_Ghost_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_ref_PA_T
  
  predicate invariant_ref_ref_PA_T [@inline:trivial] (self: MutBorrow.t (MutBorrow.t t_PA_T)) =
    inv_ref_PA_T self.current /\ inv_ref_PA_T self.final
  
  meta "rewrite_def" predicate invariant_ref_ref_PA_T
  
  predicate inv_ref_ref_PA_T [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) = invariant_ref_ref_PA_T _1
  
  meta "rewrite_def" predicate inv_ref_ref_PA_T
  
  let rec deref_mut_Ghost_ref_PA_T (self: MutBorrow.t (MutBorrow.t t_PA_T))
    (return (x: MutBorrow.t (MutBorrow.t t_PA_T))) =
    {[@expl:deref_mut 'self' type invariant] inv_ref_Ghost_ref_PA_T self}
    any
    [ return (result: MutBorrow.t (MutBorrow.t t_PA_T)) -> {inv_ref_ref_PA_T result}
      {result = self}
      (! return {result}) ]
  
  type t_PermCell_Inner_T
  
  predicate invariant_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (self: t_Rc_PermCell_Inner_T_Global) =
    inv_Rc_PermCell_Inner_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_PermCell_Inner_T_Global
  
  predicate inv_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (_1: t_Rc_PermCell_Inner_T_Global) =
    invariant_ref_Rc_PermCell_Inner_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_PermCell_Inner_T_Global
  
  function view_Rc_PermCell_Inner_T_Global (self: t_Rc_PermCell_Inner_T_Global) : t_PermCell_Inner_T
  
  let rec deref_Rc_PermCell_Inner_T_Global (self_: t_Rc_PermCell_Inner_T_Global) (return (x: t_PermCell_Inner_T)) =
    {[@expl:deref 'self_' type invariant] inv_ref_Rc_PermCell_Inner_T_Global self_}
    any [ return (result: t_PermCell_Inner_T) -> {result = view_Rc_PermCell_Inner_T_Global self_} (! return {result}) ]
  
  function id_Inner_T (self: t_PermCell_Inner_T) : t_Id
  
  let rec id_ghost_Inner_T (self: t_PermCell_Inner_T) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = id_Inner_T self} (! return {result}) ]
  
  let rec deref_Ghost_Id (self: t_Id) (return (x: t_Id)) = any
    [ return (result: t_Id) -> {result = self} (! return {result}) ]
  
  predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    inv_FMap_Id_PermCellOwn_Inner_T self.current /\ inv_FMap_Id_PermCellOwn_Inner_T self.final
  
  meta "rewrite_def" predicate invariant_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_ref_FMap_Id_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) =
    invariant_ref_FMap_Id_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_FMap_Id_PermCellOwn_Inner_T
  
  predicate inv_Option_PermCellOwn_Inner_T (_1: t_Option_PermCellOwn_Inner_T)
  
  axiom inv_axiom'5 [@rewrite]:
    forall x: t_Option_PermCellOwn_Inner_T [inv_Option_PermCellOwn_Inner_T x]. inv_Option_PermCellOwn_Inner_T x
      = match x with
        | None -> true
        | Some f0 -> inv_PermCellOwn_Inner_T f0
        end
  
  function len_Id (self: t_FMap_Id_PermCellOwn_Inner_T) : int
  
  axiom len_Id_spec: forall self: t_FMap_Id_PermCellOwn_Inner_T. len_Id self >= 0
  
  function remove_Id (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) : t_FMap_Id_PermCellOwn_Inner_T
  
  axiom remove_Id_spec:
    forall self: t_FMap_Id_PermCellOwn_Inner_T, k: t_Id. view_FMap_Id_PermCellOwn_Inner_T (remove_Id self k)
      = Map.set (view_FMap_Id_PermCellOwn_Inner_T self) k (None)
  
  axiom remove_Id_spec'0: forall self: t_FMap_Id_PermCellOwn_Inner_T, k: t_Id. len_Id (remove_Id self k)
      = (if contains_Id self k then len_Id self - 1 else len_Id self)
  
  let rec remove_ghost_Id (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id)
    (return (x: t_Option_PermCellOwn_Inner_T)) =
    {[@expl:remove_ghost 'self' type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T self}
    any
    [ return (result: t_Option_PermCellOwn_Inner_T) -> {inv_Option_PermCellOwn_Inner_T result}
      {self.final = remove_Id self.current key}
      {result = get_Id self.current key}
      (! return {result}) ]
  
  predicate resolve_ref_ref_PA_T [@inline:trivial] (_1: MutBorrow.t (MutBorrow.t t_PA_T)) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_ref_PA_T
  
  let rec unwrap_PermCellOwn_Inner_T (self_: t_Option_PermCellOwn_Inner_T) (return (x: t_PermCellOwn_Inner_T)) =
    {[@expl:unwrap 'self_' type invariant] inv_Option_PermCellOwn_Inner_T self_}
    {[@expl:unwrap requires] self_ <> None}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_PermCellOwn_Inner_T result}
      {Some result = self_}
      (! return {result}) ]
  
  predicate invariant_Ghost_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_Ghost_PermCellOwn_Inner_T
  
  predicate inv_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: t_PermCellOwn_Inner_T) =
    invariant_Ghost_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_Ghost_PermCellOwn_Inner_T
  
  let rec new_PermCellOwn_Inner_T (x: t_PermCellOwn_Inner_T) (return (x'0: t_PermCellOwn_Inner_T)) =
    {[@expl:new 'x' type invariant] inv_PermCellOwn_Inner_T x}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_Ghost_PermCellOwn_Inner_T result}
      {result = x}
      (! return {result}) ]
  
  predicate invariant_ref_Ghost_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_PermCellOwn_Inner_T) =
    inv_Ghost_PermCellOwn_Inner_T self.current /\ inv_Ghost_PermCellOwn_Inner_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Ghost_PermCellOwn_Inner_T
  
  predicate inv_ref_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_PermCellOwn_Inner_T) =
    invariant_ref_Ghost_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_Ghost_PermCellOwn_Inner_T
  
  predicate invariant_ref_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_PermCellOwn_Inner_T) =
    inv_PermCellOwn_Inner_T self.current /\ inv_PermCellOwn_Inner_T self.final
  
  meta "rewrite_def" predicate invariant_ref_PermCellOwn_Inner_T
  
  predicate inv_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_PermCellOwn_Inner_T) =
    invariant_ref_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_ref_PermCellOwn_Inner_T
  
  let rec deref_mut_Ghost_PermCellOwn_Inner_T (self: MutBorrow.t t_PermCellOwn_Inner_T)
    (return (x: MutBorrow.t t_PermCellOwn_Inner_T)) =
    {[@expl:deref_mut 'self' type invariant] inv_ref_Ghost_PermCellOwn_Inner_T self}
    any
    [ return (result: MutBorrow.t t_PermCellOwn_Inner_T) -> {inv_ref_PermCellOwn_Inner_T result}
      {result = self}
      (! return {result}) ]
  
  predicate resolve_ref_Ghost_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_PermCellOwn_Inner_T) =
    _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_Ghost_PermCellOwn_Inner_T
  
  predicate resolve_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_PermCellOwn_Inner_T) =
    _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_PermCellOwn_Inner_T
  
  predicate invariant_Ghost_ref_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_PermCellOwn_Inner_T) =
    inv_ref_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_Ghost_ref_PermCellOwn_Inner_T
  
  predicate inv_Ghost_ref_PermCellOwn_Inner_T [@inline:trivial] (_1: MutBorrow.t t_PermCellOwn_Inner_T) =
    invariant_Ghost_ref_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_Ghost_ref_PermCellOwn_Inner_T
  
  let rec new_ref_PermCellOwn_Inner_T (x: MutBorrow.t t_PermCellOwn_Inner_T)
    (return (x'0: MutBorrow.t t_PermCellOwn_Inner_T)) = {[@expl:new 'x' type invariant] inv_ref_PermCellOwn_Inner_T x}
    any
    [ return (result: MutBorrow.t t_PermCellOwn_Inner_T) -> {inv_Ghost_ref_PermCellOwn_Inner_T result}
      {result = x}
      (! return {result}) ]
  
  function id_Inner_T'0 (self: t_PermCellOwn_Inner_T) : t_Id
  
  predicate invariant_ref_Inner_T'0 [@inline:trivial] (self: MutBorrow.t t_Inner_T) =
    inv_Inner_T self.current /\ inv_Inner_T self.final
  
  meta "rewrite_def" predicate invariant_ref_Inner_T'0
  
  predicate inv_ref_Inner_T'0 [@inline:trivial] (_1: MutBorrow.t t_Inner_T) = invariant_ref_Inner_T'0 _1
  
  meta "rewrite_def" predicate inv_ref_Inner_T'0
  
  function fin_Ghost_ref_PermCellOwn_Inner_T [@inline:trivial] (self: MutBorrow.t t_PermCellOwn_Inner_T) : t_PermCellOwn_Inner_T
   = self.final
  
  meta "rewrite_def" function fin_Ghost_ref_PermCellOwn_Inner_T
  
  function view_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) : t_Inner_T = val_Inner_T self
  
  meta "rewrite_def" function view_PermCellOwn_Inner_T
  
  let rec borrow_mut_Inner_T (self: t_PermCell_Inner_T) (perm: MutBorrow.t t_PermCellOwn_Inner_T)
    (return (x: MutBorrow.t t_Inner_T)) =
    {[@expl:borrow_mut 'perm' type invariant] inv_Ghost_ref_PermCellOwn_Inner_T perm}
    {[@expl:borrow_mut requires] id_Inner_T self = id_Inner_T'0 perm.current}
    any
    [ return (result: MutBorrow.t t_Inner_T) -> {inv_ref_Inner_T'0 result}
      {id_Inner_T self = id_Inner_T'0 (fin_Ghost_ref_PermCellOwn_Inner_T perm)}
      {result.current = view_PermCellOwn_Inner_T perm.current}
      {result.final = view_PermCellOwn_Inner_T (fin_Ghost_ref_PermCellOwn_Inner_T perm)}
      (! return {result}) ]
  
  predicate resolve_ref_Inner_T [@inline:trivial] (_1: MutBorrow.t t_Inner_T) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_Inner_T
  
  let rec into_inner_PermCellOwn_Inner_T (self: t_PermCellOwn_Inner_T) (return (x: t_PermCellOwn_Inner_T)) =
    {[@expl:into_inner 'self' type invariant] inv_Ghost_PermCellOwn_Inner_T self}
    any
    [ return (result: t_PermCellOwn_Inner_T) -> {inv_PermCellOwn_Inner_T result} {result = self} (! return {result}) ]
  
  function insert_Id (self: t_FMap_Id_PermCellOwn_Inner_T) (k: t_Id) (v: t_PermCellOwn_Inner_T) : t_FMap_Id_PermCellOwn_Inner_T
  
  axiom insert_Id_spec:
    forall self: t_FMap_Id_PermCellOwn_Inner_T, k: t_Id, v: t_PermCellOwn_Inner_T. view_FMap_Id_PermCellOwn_Inner_T (insert_Id self k v)
      = Map.set (view_FMap_Id_PermCellOwn_Inner_T self) k (Some v)
  
  axiom insert_Id_spec'0:
    forall self: t_FMap_Id_PermCellOwn_Inner_T, k: t_Id, v: t_PermCellOwn_Inner_T. len_Id (insert_Id self k v)
      = (if contains_Id self k then len_Id self else len_Id self + 1)
  
  let rec insert_ghost_Id (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id) (value: t_PermCellOwn_Inner_T)
    (return (x: t_Option_PermCellOwn_Inner_T)) =
    {[@expl:insert_ghost 'self' type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T self}
    {[@expl:insert_ghost 'value' type invariant] inv_PermCellOwn_Inner_T value}
    any
    [ return (result: t_Option_PermCellOwn_Inner_T) -> {inv_Option_PermCellOwn_Inner_T result}
      {self.final = insert_Id self.current key value}
      {result = get_Id self.current key}
      (! return {result}) ]
  
  predicate resolve_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_PA_T
  
  predicate resolve_Ghost_ref_PA_T [@inline:trivial] (_1: MutBorrow.t t_PA_T) = resolve_ref_PA_T _1
  
  meta "rewrite_def" predicate resolve_Ghost_ref_PA_T
  
  predicate invariant_Ghost_Option_PermCellOwn_Inner_T [@inline:trivial] (self: t_Option_PermCellOwn_Inner_T) =
    inv_Option_PermCellOwn_Inner_T self
  
  meta "rewrite_def" predicate invariant_Ghost_Option_PermCellOwn_Inner_T
  
  predicate inv_Ghost_Option_PermCellOwn_Inner_T [@inline:trivial] (_1: t_Option_PermCellOwn_Inner_T) =
    invariant_Ghost_Option_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate inv_Ghost_Option_PermCellOwn_Inner_T
  
  let rec new_Option_PermCellOwn_Inner_T (x: t_Option_PermCellOwn_Inner_T)
    (return (x'0: t_Option_PermCellOwn_Inner_T)) = {[@expl:new 'x' type invariant] inv_Option_PermCellOwn_Inner_T x}
    any
    [ return (result: t_Option_PermCellOwn_Inner_T) -> {inv_Ghost_Option_PermCellOwn_Inner_T result}
      {result = x}
      (! return {result}) ]
  
  predicate resolve_ref_Inner_T'0 [@inline:trivial] (_1: t_Inner_T) = true
  
  meta "rewrite_def" predicate resolve_ref_Inner_T'0
  
  predicate resolve_PermCellOwn_Inner_T [@inline:trivial] (self: t_PermCellOwn_Inner_T) =
    resolve_ref_Inner_T'0 (val_Inner_T self)
  
  meta "rewrite_def" predicate resolve_PermCellOwn_Inner_T
  
  predicate resolve_PermCellOwn_Inner_T'0 (_1: t_PermCellOwn_Inner_T)
  
  axiom resolve_axiom:
    forall x: t_PermCellOwn_Inner_T [resolve_PermCellOwn_Inner_T'0 x]. resolve_PermCellOwn_Inner_T'0 x
      -> resolve_PermCellOwn_Inner_T x
  
  predicate resolve_Option_PermCellOwn_Inner_T (_1: t_Option_PermCellOwn_Inner_T)
  
  axiom resolve_axiom'0 [@rewrite]:
    forall x: t_Option_PermCellOwn_Inner_T [resolve_Option_PermCellOwn_Inner_T x]. resolve_Option_PermCellOwn_Inner_T x
      = match x with
        | None -> true
        | Some x0 -> resolve_PermCellOwn_Inner_T'0 x0
        end
  
  predicate resolve_Ghost_Option_PermCellOwn_Inner_T [@inline:trivial] (_1: t_Option_PermCellOwn_Inner_T) =
    resolve_Option_PermCellOwn_Inner_T _1
  
  meta "rewrite_def" predicate resolve_Ghost_Option_PermCellOwn_Inner_T
  
  let rec elim_Link (_x: t_Inner_T) (return (index: UInt64.t) (value: t_T) (next: t_Rc_PermCell_Inner_T_Global)) = any
    [ _k (index: UInt64.t) (value: t_T) (next: t_Rc_PermCell_Inner_T_Global) -> {Link index value next = _x}
      (! return {index} {value} {next})
    | _chk -> (! {match _x with
        | Link _ _ _ -> true
        | _ -> false
        end}
      any) ]
  
  let rec new_ref_PA_T (x: MutBorrow.t t_PA_T) (return (x'0: MutBorrow.t t_PA_T)) =
    {[@expl:new 'x' type invariant] inv_ref_PA_T x}
    any [ return (result: MutBorrow.t t_PA_T) -> {inv_Ghost_ref_PA_T result} {result = x} (! return {result}) ]
  
  let rec clone_Rc_PermCell_Inner_T_Global (self_: t_Rc_PermCell_Inner_T_Global)
    (return (x: t_Rc_PermCell_Inner_T_Global)) =
    {[@expl:clone 'self_' type invariant] inv_ref_Rc_PermCell_Inner_T_Global self_}
    any
    [ return (result: t_Rc_PermCell_Inner_T_Global) -> {inv_Rc_PermCell_Inner_T_Global result}
      {result = self_}
      (! return {result}) ]
  
  predicate invariant_ref_Rc_PermCell_Inner_T_Global'0 [@inline:trivial] (self: MutBorrow.t t_Rc_PermCell_Inner_T_Global) =
    inv_Rc_PermCell_Inner_T_Global self.current /\ inv_Rc_PermCell_Inner_T_Global self.final
  
  meta "rewrite_def" predicate invariant_ref_Rc_PermCell_Inner_T_Global'0
  
  predicate inv_ref_Rc_PermCell_Inner_T_Global'0 [@inline:trivial] (_1: MutBorrow.t t_Rc_PermCell_Inner_T_Global) =
    invariant_ref_Rc_PermCell_Inner_T_Global'0 _1
  
  meta "rewrite_def" predicate inv_ref_Rc_PermCell_Inner_T_Global'0
  
  let rec replace_Rc_PermCell_Inner_T_Global (dest: MutBorrow.t t_Rc_PermCell_Inner_T_Global)
    (src: t_Rc_PermCell_Inner_T_Global) (return (x: t_Rc_PermCell_Inner_T_Global)) =
    {[@expl:replace 'dest' type invariant] inv_ref_Rc_PermCell_Inner_T_Global'0 dest}
    {[@expl:replace 'src' type invariant] inv_Rc_PermCell_Inner_T_Global src}
    any
    [ return (result: t_Rc_PermCell_Inner_T_Global) -> {inv_Rc_PermCell_Inner_T_Global result}
      {dest.final = src}
      {result = dest.current}
      (! return {result}) ]
  
  predicate resolve_ref_Rc_PermCell_Inner_T_Global [@inline:trivial] (_1: MutBorrow.t t_Rc_PermCell_Inner_T_Global) =
    _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_Rc_PermCell_Inner_T_Global
  
  type t_Option_ref_PermCellOwn_Inner_T = None'0 | Some'0 (MutBorrow.t t_PermCellOwn_Inner_T)
  
  predicate inv_Option_ref_PermCellOwn_Inner_T (_1: t_Option_ref_PermCellOwn_Inner_T)
  
  axiom inv_axiom'6 [@rewrite]:
    forall x: t_Option_ref_PermCellOwn_Inner_T [inv_Option_ref_PermCellOwn_Inner_T x]. inv_Option_ref_PermCellOwn_Inner_T x
      = match x with
        | None'0 -> true
        | Some'0 f0 -> inv_ref_PermCellOwn_Inner_T f0
        end
  
  let rec get_mut_ghost_Id (self: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) (key: t_Id)
    (return (x: t_Option_ref_PermCellOwn_Inner_T)) =
    {[@expl:get_mut_ghost 'self' type invariant] inv_ref_FMap_Id_PermCellOwn_Inner_T self}
    any
    [ return (result: t_Option_ref_PermCellOwn_Inner_T) -> {inv_Option_ref_PermCellOwn_Inner_T result}
      {if contains_Id self.current key then
        match result with
          | None'0 -> false
          | Some'0 r -> contains_Id self.final key
          /\ index_FMap_Id_PermCellOwn_Inner_T self.current key = r.current
          /\ index_FMap_Id_PermCellOwn_Inner_T self.final key = r.final
          end
      else
        result = None'0 /\ self.current = self.final
      }
      {forall k: t_Id. k <> key -> get_Id self.current k = get_Id self.final k}
      {len_Id self.current = len_Id self.final}
      (! return {result}) ]
  
  let rec unwrap_ref_PermCellOwn_Inner_T (self_: t_Option_ref_PermCellOwn_Inner_T)
    (return (x: MutBorrow.t t_PermCellOwn_Inner_T)) =
    {[@expl:unwrap 'self_' type invariant] inv_Option_ref_PermCellOwn_Inner_T self_}
    {[@expl:unwrap requires] self_ <> None'0}
    any
    [ return (result: MutBorrow.t t_PermCellOwn_Inner_T) -> {inv_ref_PermCellOwn_Inner_T result}
      {Some'0 result = self_}
      (! return {result}) ]
  
  predicate resolve_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate resolve_ref_usize [@inline:trivial] (_1: MutBorrow.t UInt64.t) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_usize
  
  predicate invariant_ref_T [@inline:trivial] (self: MutBorrow.t t_T) = inv_T self.current /\ inv_T self.final
  
  meta "rewrite_def" predicate invariant_ref_T
  
  predicate inv_ref_T [@inline:trivial] (_1: MutBorrow.t t_T) = invariant_ref_T _1
  
  meta "rewrite_def" predicate inv_ref_T
  
  predicate resolve_ref_T [@inline:trivial] (_1: MutBorrow.t t_T) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_T
  
  let rec elim_Direct (_x: t_Inner_T) (return (f0: t_Vec_T_Global)) = any
    [ _k (f0: t_Vec_T_Global) -> {Direct f0 = _x} (! return {f0})
    | _chk -> (! {match _x with
        | Direct _ -> true
        | _ -> false
        end}
      any) ]
  
  predicate invariant_ref_Vec_T_Global [@inline:trivial] (self: MutBorrow.t t_Vec_T_Global) =
    inv_Vec_T_Global self.current /\ inv_Vec_T_Global self.final
  
  meta "rewrite_def" predicate invariant_ref_Vec_T_Global
  
  predicate inv_ref_Vec_T_Global [@inline:trivial] (_1: MutBorrow.t t_Vec_T_Global) = invariant_ref_Vec_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Vec_T_Global
  
  predicate in_bounds_usize [@inline:trivial] (self: UInt64.t) (seq: Seq.seq t_T) = UInt64.t'int self < Seq.length seq
  
  meta "rewrite_def" predicate in_bounds_usize
  
  predicate has_value_usize [@inline:trivial] (self: UInt64.t) (seq: Seq.seq t_T) (out: t_T) =
    Seq.get seq (UInt64.t'int self) = out
  
  meta "rewrite_def" predicate has_value_usize
  
  predicate resolve_elswhere_usize [@inline:trivial] (self: UInt64.t) (old': Seq.seq t_T) (fin: Seq.seq t_T) =
    forall i: int. 0 <= i /\ i <> UInt64.t'int self /\ i < Seq.length old' -> Seq.get old' i = Seq.get fin i
  
  meta "rewrite_def" predicate resolve_elswhere_usize
  
  let rec index_mut_Vec_T_Global (self_: MutBorrow.t t_Vec_T_Global) (ix: UInt64.t) (return (x: MutBorrow.t t_T)) =
    {[@expl:index_mut 'self_' type invariant] inv_ref_Vec_T_Global self_}
    {[@expl:index_mut requires] in_bounds_usize ix (view_Vec_T_Global self_.current)}
    any
    [ return (result: MutBorrow.t t_T) -> {inv_ref_T result}
      {has_value_usize ix (view_Vec_T_Global self_.current) result.current}
      {has_value_usize ix (view_Vec_T_Global self_.final) result.final}
      {resolve_elswhere_usize ix (view_Vec_T_Global self_.current) (view_Vec_T_Global self_.final)}
      {Seq.length (view_Vec_T_Global self_.final) = Seq.length (view_Vec_T_Global self_.current)}
      (! return {result}) ]
  
  let rec swap_T (x: MutBorrow.t t_T) (y: MutBorrow.t t_T) (return (x'0: ())) =
    {[@expl:swap 'x' type invariant] inv_ref_T x}
    {[@expl:swap 'y' type invariant] inv_ref_T y}
    any [ return (result: ()) -> {x.final = y.current} {y.final = x.current} (! return {result}) ]
  
  predicate resolve_ref_Vec_T_Global [@inline:trivial] (_1: MutBorrow.t t_Vec_T_Global) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_Vec_T_Global
  
  let rec swap_Inner_T (x: MutBorrow.t t_Inner_T) (y: MutBorrow.t t_Inner_T) (return (x'0: ())) =
    {[@expl:swap 'x' type invariant] inv_ref_Inner_T'0 x}
    {[@expl:swap 'y' type invariant] inv_ref_Inner_T'0 y}
    any [ return (result: ()) -> {x.final = y.current} {y.final = x.current} (! return {result}) ]
  
  let rec new_unit (x: ()) (return (x'0: ())) = any [ return (result: ()) -> {result = x} (! return {result}) ]
  
  function id_Id (self: t_Authority_Id_Seq_T) : t_Id
  
  type t_FMap_Id_Seq_T
  
  type t_Option_Seq_T = None'1 | Some'1 (Seq.seq t_T)
  
  function view_FMap_Id_Seq_T (self: t_FMap_Id_Seq_T) : Map.map t_Id t_Option_Seq_T
  
  function get_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : t_Option_Seq_T =
    Map.get (view_FMap_Id_Seq_T self) k
  
  meta "rewrite_def" function get_Id'0
  
  predicate contains_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) = get_Id'0 self k <> None'1
  
  meta "rewrite_def" predicate contains_Id'0
  
  function view_Authority_Id_Seq_T (self: t_Authority_Id_Seq_T) : t_FMap_Id_Seq_T
  
  predicate index_Mapping_Seq_T_bool [@inline:trivial] (self: Map.map (Seq.seq t_T) bool) (a: Seq.seq t_T) =
    Map.get self a
  
  meta "rewrite_def" predicate index_Mapping_Seq_T_bool
  
  function such_that_Seq_T (p: Map.map (Seq.seq t_T) bool) : Seq.seq t_T
  
  axiom such_that_Seq_T_spec:
    forall p: Map.map (Seq.seq t_T) bool. (exists x: Seq.seq t_T. index_Mapping_Seq_T_bool p x)
      -> index_Mapping_Seq_T_bool p (such_that_Seq_T p)
  
  function unwrap_Option_Seq_T (self: t_Option_Seq_T) : Seq.seq t_T = match self with
      | Some'1 x -> x
      | None'1 -> such_that_Seq_T (fun (__0: Seq.seq t_T) -> true)
      end
  
  function lookup_Id'0 [@inline:trivial] (self: t_FMap_Id_Seq_T) (k: t_Id) : Seq.seq t_T =
    unwrap_Option_Seq_T (get_Id'0 self k)
  
  meta "rewrite_def" function lookup_Id'0
  
  function index_FMap_Id_Seq_T [@inline:trivial] (self: t_FMap_Id_Seq_T) (key: t_Id) : Seq.seq t_T =
    lookup_Id'0 self key
  
  meta "rewrite_def" function index_FMap_Id_Seq_T
  
  function index_Mapping_Id_Int [@inline:trivial] (self: Map.map t_Id int) (a: t_Id) : int = Map.get self a
  
  meta "rewrite_def" function index_Mapping_Id_Int
  
  predicate partial_invariant_T [@inline:trivial] (self: t_PA_T) (resource_id: t_Id) =
    id_Id self.auth = resource_id
    /\ (forall id: t_Id. contains_Id'0 (view_Authority_Id_Seq_T self.auth) id /\ contains_Id self.perms id
      -> id_Inner_T'0 (index_FMap_Id_PermCellOwn_Inner_T self.perms id) = id
      /\ match val_Inner_T (index_FMap_Id_PermCellOwn_Inner_T self.perms id) with
        | Direct v -> index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id = view_Vec_T_Global v
        | Link index value next -> contains_Id'0 (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))
        /\ index_Mapping_Id_Int self.depth id
          > index_Mapping_Id_Int self.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))
        /\ UInt64.t'int index
          < Seq.length (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next)))
        /\ index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) id
        = Seq.set (index_FMap_Id_Seq_T (view_Authority_Id_Seq_T self.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global next))) (UInt64.t'int index) value
        end)
  
  meta "rewrite_def" predicate partial_invariant_T
  
  function fin_Ghost_ref_PA_T [@inline:trivial] (self: MutBorrow.t t_PA_T) : t_PA_T = self.final
  
  meta "rewrite_def" function fin_Ghost_ref_PA_T
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec reroot_T (cur: t_Rc_PermCell_Inner_T_Global) (auth_id: t_Id) (pa: MutBorrow.t t_PA_T) (return (x: ())) =
    {[@expl:reroot 'cur' type invariant] inv_ref_Rc_PermCell_Inner_T_Global cur}
    {[@expl:reroot 'pa' type invariant] inv_Ghost_ref_PA_T pa}
    {[@expl:reroot requires #0] partial_invariant_T pa.current auth_id}
    {[@expl:reroot requires #1] contains_Id'0 (view_Authority_Id_Seq_T pa.current.auth) (id_Inner_T (view_Rc_PermCell_Inner_T_Global cur))}
    {[@expl:reroot requires #2] forall id: t_Id. contains_Id'0 (view_Authority_Id_Seq_T pa.current.auth) id
        /\ index_Mapping_Id_Int pa.current.depth id
        <= index_Mapping_Id_Int pa.current.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global cur))
      -> contains_Id pa.current.perms id}
    (! bb0
    [ bb0 = s0
      [ s0 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_31 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s1) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s1 = deref_mut_Ghost_ref_PA_T {_31} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_30 <- _x ] s2)
      | s2 = deref_Rc_PermCell_Inner_T_Global {cur} (fun (_x: t_PermCell_Inner_T) -> [ &_38 <- _x ] s3)
      | s3 = id_ghost_Inner_T {_38} (fun (_x: t_Id) -> [ &_36 <- _x ] s4)
      | s4 = [ &_35 <- _36 ] s5
      | s5 = deref_Ghost_Id {_35} (fun (_x: t_Id) -> [ &_33 <- _x ] s6)
      | s6 = MutBorrow.borrow_mut <t_FMap_Id_PermCellOwn_Inner_T> {_30.current.current.perms}
          (fun (_bor: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) ->
            [ &_29 <- _bor ] -{inv_FMap_Id_PermCellOwn_Inner_T _bor.final}-
            [ &_30 <- { _30 with current = { _30.current with current = { _30.current.current with perms = _bor.final } } } ]
            s7) [ _ck -> (! {inv_FMap_Id_PermCellOwn_Inner_T _30.current.current.perms} any) ]
      | s7 = remove_ghost_Id {_29} {_33} (fun (_x: t_Option_PermCellOwn_Inner_T) -> [ &_28 <- _x ] s8)
      | s8 = s9 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T _30} any) ]
      | s9 = -{resolve_ref_ref_PA_T _30}- s10
      | s10 = unwrap_PermCellOwn_Inner_T {_28} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_27 <- _x ] s11)
      | s11 = new_PermCellOwn_Inner_T {_27} (fun (_x: t_PermCellOwn_Inner_T) -> [ &perm_cur <- _x ] s12)
      | s12 = deref_Rc_PermCell_Inner_T_Global {cur} (fun (_x: t_PermCell_Inner_T) -> [ &_43 <- _x ] s13)
      | s13 = MutBorrow.borrow_mut <t_PermCellOwn_Inner_T> {perm_cur}
          (fun (_bor: MutBorrow.t t_PermCellOwn_Inner_T) ->
            [ &_50 <- _bor ] -{inv_Ghost_PermCellOwn_Inner_T _bor.final}-
            [ &perm_cur <- _bor.final ] s14) [ _ck -> (! {inv_Ghost_PermCellOwn_Inner_T perm_cur} any) ]
      | s14 = MutBorrow.borrow_final <t_PermCellOwn_Inner_T> {_50.current} {MutBorrow.get_id _50}
          (fun (_bor: MutBorrow.t t_PermCellOwn_Inner_T) ->
            [ &_49 <- _bor ] -{inv_Ghost_PermCellOwn_Inner_T _bor.final}-
            [ &_50 <- { _50 with current = _bor.final } ] s15)
        [ _ck -> (! {inv_Ghost_PermCellOwn_Inner_T _50.current} any) ]
      | s15 = deref_mut_Ghost_PermCellOwn_Inner_T {_49}
          (fun (_x: MutBorrow.t t_PermCellOwn_Inner_T) -> [ &_48 <- _x ] s16)
      | s16 = MutBorrow.borrow_final <t_PermCellOwn_Inner_T> {_48.current} {MutBorrow.get_id _48}
          (fun (_bor: MutBorrow.t t_PermCellOwn_Inner_T) ->
            [ &_47 <- _bor ] -{inv_PermCellOwn_Inner_T _bor.final}-
            [ &_48 <- { _48 with current = _bor.final } ] s17) [ _ck -> (! {inv_PermCellOwn_Inner_T _48.current} any) ]
      | s17 = s18 [ _ck -> (! {[@expl:type invariant] inv_ref_Ghost_PermCellOwn_Inner_T _50} any) ]
      | s18 = -{resolve_ref_Ghost_PermCellOwn_Inner_T _50}- s19
      | s19 = s20 [ _ck -> (! {[@expl:type invariant] inv_ref_PermCellOwn_Inner_T _48} any) ]
      | s20 = -{resolve_ref_PermCellOwn_Inner_T _48}- s21
      | s21 = MutBorrow.borrow_final <t_PermCellOwn_Inner_T> {_47.current} {MutBorrow.get_id _47}
          (fun (_bor: MutBorrow.t t_PermCellOwn_Inner_T) ->
            [ &_46 <- _bor ] -{inv_PermCellOwn_Inner_T _bor.final}-
            [ &_47 <- { _47 with current = _bor.final } ] s22) [ _ck -> (! {inv_PermCellOwn_Inner_T _47.current} any) ]
      | s22 = new_ref_PermCellOwn_Inner_T {_46} (fun (_x: MutBorrow.t t_PermCellOwn_Inner_T) -> [ &_45 <- _x ] s23)
      | s23 = s24 [ _ck -> (! {[@expl:type invariant] inv_ref_PermCellOwn_Inner_T _47} any) ]
      | s24 = -{resolve_ref_PermCellOwn_Inner_T _47}- s25
      | s25 = borrow_mut_Inner_T {_43} {_45} (fun (_x: MutBorrow.t t_Inner_T) -> [ &_41 <- _x ] s26)
      | s26 = MutBorrow.borrow_final <t_Inner_T> {_41.current} {MutBorrow.get_id _41}
          (fun (_bor: MutBorrow.t t_Inner_T) ->
            [ &bor_cur <- _bor ] -{inv_Inner_T _bor.final}-
            [ &_41 <- { _41 with current = _bor.final } ] s27) [ _ck -> (! {inv_Inner_T _41.current} any) ]
      | s27 = s28 [ _ck -> (! {[@expl:type invariant] inv_ref_Inner_T'0 _41} any) ]
      | s28 = -{resolve_ref_Inner_T _41}- s29
      | s29 = any
        [ br0 (x0: t_Vec_T_Global) -> {bor_cur.current = Direct x0} (! bb12)
        | br1 (x0: UInt64.t) (x1: t_T) (x2: t_Rc_PermCell_Inner_T_Global) -> {bor_cur.current = Link x0 x1 x2}
          (! bb21) ] ]
    | bb12 = s0
      [ s0 = s1 [ _ck -> (! {[@expl:type invariant] inv_ref_Inner_T'0 bor_cur} any) ]
      | s1 = -{resolve_ref_Inner_T bor_cur}- s2
      | s2 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_56 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s3) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s3 = deref_mut_Ghost_ref_PA_T {_56} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_55 <- _x ] s4)
      | s4 = deref_Rc_PermCell_Inner_T_Global {cur} (fun (_x: t_PermCell_Inner_T) -> [ &_62 <- _x ] s5)
      | s5 = id_ghost_Inner_T {_62} (fun (_x: t_Id) -> [ &_60 <- _x ] s6)
      | s6 = deref_Ghost_Id {_60} (fun (_x: t_Id) -> [ &_58 <- _x ] s7)
      | s7 = into_inner_PermCellOwn_Inner_T {perm_cur} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_64 <- _x ] s8)
      | s8 = MutBorrow.borrow_mut <t_FMap_Id_PermCellOwn_Inner_T> {_55.current.current.perms}
          (fun (_bor: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) ->
            [ &_54 <- _bor ] -{inv_FMap_Id_PermCellOwn_Inner_T _bor.final}-
            [ &_55 <- { _55 with current = { _55.current with current = { _55.current.current with perms = _bor.final } } } ]
            s9) [ _ck -> (! {inv_FMap_Id_PermCellOwn_Inner_T _55.current.current.perms} any) ]
      | s9 = insert_ghost_Id {_54} {_58} {_64} (fun (_x: t_Option_PermCellOwn_Inner_T) -> [ &_53 <- _x ] s10)
      | s10 = s11 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T _55} any) ]
      | s11 = -{resolve_ref_ref_PA_T _55}- s12
      | s12 = s13 [ _ck -> (! {[@expl:type invariant] inv_Ghost_ref_PA_T pa} any) ]
      | s13 = -{resolve_Ghost_ref_PA_T pa}- s14
      | s14 = new_Option_PermCellOwn_Inner_T {_53} (fun (_x: t_Option_PermCellOwn_Inner_T) -> [ &_52 <- _x ] s15)
      | s15 = s16 [ _ck -> (! {[@expl:type invariant] inv_Ghost_Option_PermCellOwn_Inner_T _52} any) ]
      | s16 = -{resolve_Ghost_Option_PermCellOwn_Inner_T _52}- s17
      | s17 = return {_ret} ]
    | bb21 = s0
      [ s0 = elim_Link {bor_cur.current}
          (fun (rindex: UInt64.t) (rvalue: t_T) (rnext: t_Rc_PermCell_Inner_T_Global) ->
            MutBorrow.borrow_mut <t_Rc_PermCell_Inner_T_Global> {rnext}
              (fun (_bor: MutBorrow.t t_Rc_PermCell_Inner_T_Global) ->
                [ &next <- _bor ] -{inv_Rc_PermCell_Inner_T_Global _bor.final}-
                [ &bor_cur <- { bor_cur with current = Link rindex rvalue _bor.final } ] s1)
            [ _ck -> (! {inv_Rc_PermCell_Inner_T_Global rnext} any) ])
      | s1 = elim_Link {bor_cur.current}
          (fun (rindex: UInt64.t) (rvalue: t_T) (rnext: t_Rc_PermCell_Inner_T_Global) ->
            MutBorrow.borrow_mut <t_T> {rvalue}
              (fun (_bor: MutBorrow.t t_T) ->
                [ &value <- _bor ] -{inv_T _bor.final}-
                [ &bor_cur <- { bor_cur with current = Link rindex _bor.final rnext } ] s2)
            [ _ck -> (! {inv_T rvalue} any) ])
      | s2 = elim_Link {bor_cur.current}
          (fun (rindex: UInt64.t) (rvalue: t_T) (rnext: t_Rc_PermCell_Inner_T_Global) ->
            MutBorrow.borrow_mut <UInt64.t> {rindex}
              (fun (_bor: MutBorrow.t UInt64.t) ->
                [ &index <- _bor ] [ &bor_cur <- { bor_cur with current = Link _bor.final rvalue rnext } ] s3))
      | s3 = [ &_72 <- next ] s4
      | s4 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_79 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s5) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s5 = deref_mut_Ghost_ref_PA_T {_79} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_78 <- _x ] s6)
      | s6 = MutBorrow.borrow_final <MutBorrow.t t_PA_T> {_78.current} {MutBorrow.get_id _78}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_77 <- _bor ] -{inv_ref_PA_T _bor.final}-
            [ &_78 <- { _78 with current = _bor.final } ] s7) [ _ck -> (! {inv_ref_PA_T _78.current} any) ]
      | s7 = MutBorrow.borrow_mut <t_PA_T> {_77.current.current}
          (fun (_bor: MutBorrow.t t_PA_T) ->
            [ &_76 <- _bor ] -{inv_PA_T _bor.final}-
            [ &_77 <- { _77 with current = { _77.current with current = _bor.final } } ] s8)
        [ _ck -> (! {inv_PA_T _77.current.current} any) ]
      | s8 = s9 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T _78} any) ]
      | s9 = -{resolve_ref_ref_PA_T _78}- s10
      | s10 = s11 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T _77} any) ]
      | s11 = -{resolve_ref_ref_PA_T _77}- s12
      | s12 = MutBorrow.borrow_final <t_PA_T> {_76.current} {MutBorrow.get_id _76}
          (fun (_bor: MutBorrow.t t_PA_T) ->
            [ &_75 <- _bor ] -{inv_PA_T _bor.final}-
            [ &_76 <- { _76 with current = _bor.final } ] s13) [ _ck -> (! {inv_PA_T _76.current} any) ]
      | s13 = new_ref_PA_T {_75} (fun (_x: MutBorrow.t t_PA_T) -> [ &_74 <- _x ] s14)
      | s14 = s15 [ _ck -> (! {[@expl:type invariant] inv_ref_PA_T _76} any) ]
      | s15 = -{resolve_ref_PA_T _76}- s16
      | s16 = reroot_T {_72.current} {auth_id} {_74} (fun (_x: ()) -> [ &_70 <- _x ] s17)
      | s17 = clone_Rc_PermCell_Inner_T_Global {cur} (fun (_x: t_Rc_PermCell_Inner_T_Global) -> [ &_82 <- _x ] s18)
      | s18 = MutBorrow.borrow_final <t_Rc_PermCell_Inner_T_Global> {next.current} {MutBorrow.get_id next}
          (fun (_bor: MutBorrow.t t_Rc_PermCell_Inner_T_Global) ->
            [ &_81 <- _bor ] -{inv_Rc_PermCell_Inner_T_Global _bor.final}-
            [ &next <- { next with current = _bor.final } ] s19)
        [ _ck -> (! {inv_Rc_PermCell_Inner_T_Global next.current} any) ]
      | s19 = replace_Rc_PermCell_Inner_T_Global {_81} {_82}
          (fun (_x: t_Rc_PermCell_Inner_T_Global) -> [ &next'0 <- _x ] s20)
      | s20 = s21 [ _ck -> (! {[@expl:type invariant] inv_ref_Rc_PermCell_Inner_T_Global'0 next} any) ]
      | s21 = -{resolve_ref_Rc_PermCell_Inner_T_Global next}- s22
      | s22 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_90 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s23) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s23 = deref_mut_Ghost_ref_PA_T {_90} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_89 <- _x ] s24)
      | s24 = deref_Rc_PermCell_Inner_T_Global {next'0} (fun (_x: t_PermCell_Inner_T) -> [ &_97 <- _x ] s25)
      | s25 = id_ghost_Inner_T {_97} (fun (_x: t_Id) -> [ &_95 <- _x ] s26)
      | s26 = deref_Ghost_Id {_95} (fun (_x: t_Id) -> [ &_93 <- _x ] s27)
      | s27 = [ &_92 <- _93 ] s28
      | s28 = MutBorrow.borrow_mut <t_FMap_Id_PermCellOwn_Inner_T> {_89.current.current.perms}
          (fun (_bor: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) ->
            [ &_88 <- _bor ] -{inv_FMap_Id_PermCellOwn_Inner_T _bor.final}-
            [ &_89 <- { _89 with current = { _89.current with current = { _89.current.current with perms = _bor.final } } } ]
            s29) [ _ck -> (! {inv_FMap_Id_PermCellOwn_Inner_T _89.current.current.perms} any) ]
      | s29 = get_mut_ghost_Id {_88} {_92} (fun (_x: t_Option_ref_PermCellOwn_Inner_T) -> [ &_87 <- _x ] s30)
      | s30 = unwrap_ref_PermCellOwn_Inner_T {_87} (fun (_x: MutBorrow.t t_PermCellOwn_Inner_T) -> [ &_86 <- _x ] s31)
      | s31 = s32 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T _89} any) ]
      | s32 = -{resolve_ref_ref_PA_T _89}- s33
      | s33 = MutBorrow.borrow_final <t_PermCellOwn_Inner_T> {_86.current} {MutBorrow.get_id _86}
          (fun (_bor: MutBorrow.t t_PermCellOwn_Inner_T) ->
            [ &_85 <- _bor ] -{inv_PermCellOwn_Inner_T _bor.final}-
            [ &_86 <- { _86 with current = _bor.final } ] s34) [ _ck -> (! {inv_PermCellOwn_Inner_T _86.current} any) ]
      | s34 = new_ref_PermCellOwn_Inner_T {_85}
          (fun (_x: MutBorrow.t t_PermCellOwn_Inner_T) -> [ &perm_next <- _x ] s35)
      | s35 = s36 [ _ck -> (! {[@expl:type invariant] inv_ref_PermCellOwn_Inner_T _86} any) ]
      | s36 = -{resolve_ref_PermCellOwn_Inner_T _86}- s37
      | s37 = s38 [ _ck -> (! {[@expl:type invariant] inv_Rc_PermCell_Inner_T_Global next'0} any) ]
      | s38 = -{resolve_Rc_PermCell_Inner_T_Global next'0}- s39
      | s39 = deref_Rc_PermCell_Inner_T_Global {next'0} (fun (_x: t_PermCell_Inner_T) -> [ &_102 <- _x ] s40)
      | s40 = borrow_mut_Inner_T {_102} {perm_next} (fun (_x: MutBorrow.t t_Inner_T) -> [ &_100 <- _x ] s41)
      | s41 = MutBorrow.borrow_final <t_Inner_T> {_100.current} {MutBorrow.get_id _100}
          (fun (_bor: MutBorrow.t t_Inner_T) ->
            [ &bor_next <- _bor ] -{inv_Inner_T _bor.final}-
            [ &_100 <- { _100 with current = _bor.final } ] s42) [ _ck -> (! {inv_Inner_T _100.current} any) ]
      | s42 = s43 [ _ck -> (! {[@expl:type invariant] inv_ref_Inner_T'0 _100} any) ]
      | s43 = -{resolve_ref_Inner_T _100}- s44
      | s44 = any
        [ br0 (x0: t_Vec_T_Global) -> {bor_next.current = Direct x0} (! bb38)
        | br1 (x0: UInt64.t) (x1: t_T) (x2: t_Rc_PermCell_Inner_T_Global) -> {bor_next.current = Link x0 x1 x2}
          (! bb36) ] ]
    | bb36 = s0
      [ s0 = s1 [ _ck -> (! {[@expl:type invariant] inv_ref_Inner_T'0 bor_next} any) ]
      | s1 = -{resolve_ref_Inner_T bor_next}- s2
      | s2 = -{resolve_ref_usize index}- s3
      | s3 = s4 [ _ck -> (! {[@expl:type invariant] inv_ref_T value} any) ]
      | s4 = -{resolve_ref_T value}- s5
      | s5 = {false} any ]
    | bb38 = s0
      [ s0 = elim_Direct {bor_next.current}
          (fun (r0: t_Vec_T_Global) ->
            MutBorrow.borrow_mut <t_Vec_T_Global> {r0}
              (fun (_bor: MutBorrow.t t_Vec_T_Global) ->
                [ &arr <- _bor ] -{inv_Vec_T_Global _bor.final}-
                [ &bor_next <- { bor_next with current = Direct _bor.final } ] s1)
            [ _ck -> (! {inv_Vec_T_Global r0} any) ])
      | s1 = MutBorrow.borrow_final <t_Vec_T_Global> {arr.current} {MutBorrow.get_id arr}
          (fun (_bor: MutBorrow.t t_Vec_T_Global) ->
            [ &_112 <- _bor ] -{inv_Vec_T_Global _bor.final}-
            [ &arr <- { arr with current = _bor.final } ] s2) [ _ck -> (! {inv_Vec_T_Global arr.current} any) ]
      | s2 = -{resolve_ref_usize index}- s3
      | s3 = index_mut_Vec_T_Global {_112} {index.current} (fun (_x: MutBorrow.t t_T) -> [ &_111 <- _x ] s4)
      | s4 = MutBorrow.borrow_final <t_T> {_111.current} {MutBorrow.get_id _111}
          (fun (_bor: MutBorrow.t t_T) ->
            [ &_110 <- _bor ] -{inv_T _bor.final}-
            [ &_111 <- { _111 with current = _bor.final } ] s5) [ _ck -> (! {inv_T _111.current} any) ]
      | s5 = MutBorrow.borrow_final <t_T> {_110.current} {MutBorrow.get_id _110}
          (fun (_bor: MutBorrow.t t_T) ->
            [ &_109 <- _bor ] -{inv_T _bor.final}-
            [ &_110 <- { _110 with current = _bor.final } ] s6) [ _ck -> (! {inv_T _110.current} any) ]
      | s6 = MutBorrow.borrow_final <t_T> {value.current} {MutBorrow.get_id value}
          (fun (_bor: MutBorrow.t t_T) ->
            [ &_114 <- _bor ] -{inv_T _bor.final}-
            [ &value <- { value with current = _bor.final } ] s7) [ _ck -> (! {inv_T value.current} any) ]
      | s7 = swap_T {_109} {_114} (fun (_x: ()) -> [ &_108 <- _x ] s8)
      | s8 = s9 [ _ck -> (! {[@expl:type invariant] inv_ref_T _111} any) ]
      | s9 = -{resolve_ref_T _111}- s10
      | s10 = s11 [ _ck -> (! {[@expl:type invariant] inv_ref_T _110} any) ]
      | s11 = -{resolve_ref_T _110}- s12
      | s12 = s13 [ _ck -> (! {[@expl:type invariant] inv_ref_Vec_T_Global arr} any) ]
      | s13 = -{resolve_ref_Vec_T_Global arr}- s14
      | s14 = s15 [ _ck -> (! {[@expl:type invariant] inv_ref_T value} any) ]
      | s15 = -{resolve_ref_T value}- s16
      | s16 = MutBorrow.borrow_final <t_Inner_T> {bor_next.current} {MutBorrow.get_id bor_next}
          (fun (_bor: MutBorrow.t t_Inner_T) ->
            [ &_116 <- _bor ] -{inv_Inner_T _bor.final}-
            [ &bor_next <- { bor_next with current = _bor.final } ] s17)
        [ _ck -> (! {inv_Inner_T bor_next.current} any) ]
      | s17 = MutBorrow.borrow_final <t_Inner_T> {bor_cur.current} {MutBorrow.get_id bor_cur}
          (fun (_bor: MutBorrow.t t_Inner_T) ->
            [ &_117 <- _bor ] -{inv_Inner_T _bor.final}-
            [ &bor_cur <- { bor_cur with current = _bor.final } ] s18) [ _ck -> (! {inv_Inner_T bor_cur.current} any) ]
      | s18 = swap_Inner_T {_116} {_117} (fun (_x: ()) -> [ &_115 <- _x ] s19)
      | s19 = s20 [ _ck -> (! {[@expl:type invariant] inv_ref_Inner_T'0 bor_next} any) ]
      | s20 = -{resolve_ref_Inner_T bor_next}- s21
      | s21 = s22 [ _ck -> (! {[@expl:type invariant] inv_ref_Inner_T'0 bor_cur} any) ]
      | s22 = -{resolve_ref_Inner_T bor_cur}- s23
      | s23 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_123 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s24) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s24 = deref_mut_Ghost_ref_PA_T {_123} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_122 <- _x ] s25)
      | s25 = deref_Rc_PermCell_Inner_T_Global {cur} (fun (_x: t_PermCell_Inner_T) -> [ &_129 <- _x ] s26)
      | s26 = id_ghost_Inner_T {_129} (fun (_x: t_Id) -> [ &_127 <- _x ] s27)
      | s27 = deref_Ghost_Id {_127} (fun (_x: t_Id) -> [ &_125 <- _x ] s28)
      | s28 = into_inner_PermCellOwn_Inner_T {perm_cur} (fun (_x: t_PermCellOwn_Inner_T) -> [ &_131 <- _x ] s29)
      | s29 = MutBorrow.borrow_mut <t_FMap_Id_PermCellOwn_Inner_T> {_122.current.current.perms}
          (fun (_bor: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T) ->
            [ &_121 <- _bor ] -{inv_FMap_Id_PermCellOwn_Inner_T _bor.final}-
            [ &_122 <- { _122 with current = { _122.current with current = { _122.current.current with perms = _bor.final } } } ]
            s30) [ _ck -> (! {inv_FMap_Id_PermCellOwn_Inner_T _122.current.current.perms} any) ]
      | s30 = insert_ghost_Id {_121} {_125} {_131} (fun (_x: t_Option_PermCellOwn_Inner_T) -> [ &_120 <- _x ] s31)
      | s31 = s32 [ _ck -> (! {[@expl:type invariant] inv_Option_PermCellOwn_Inner_T _120} any) ]
      | s32 = -{resolve_Option_PermCellOwn_Inner_T _120}- s33
      | s33 = s34 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T _122} any) ]
      | s34 = -{resolve_ref_ref_PA_T _122}- s35
      | s35 =
        [ &new_d <- MinMax.min (Map.get pa.current.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global cur))) (Map.get pa.current.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global next'0))
        - 1) ] s36
      | s36 = [ &_138 <- Map.set pa.current.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global cur)) new_d ] s37
      | s37 = MutBorrow.borrow_mut <MutBorrow.t t_PA_T> {pa}
          (fun (_bor: MutBorrow.t (MutBorrow.t t_PA_T)) ->
            [ &_144 <- _bor ] -{inv_Ghost_ref_PA_T _bor.final}-
            [ &pa <- _bor.final ] s38) [ _ck -> (! {inv_Ghost_ref_PA_T pa} any) ]
      | s38 = deref_mut_Ghost_ref_PA_T {_144} (fun (_x: MutBorrow.t (MutBorrow.t t_PA_T)) -> [ &_143 <- _x ] s39)
      | s39 =
        [ &_143 <- { _143 with current = { _143.current with current = { _143.current.current with depth = _138 } } } ]
        s40
      | s40 = s41 [ _ck -> (! {[@expl:type invariant] inv_ref_ref_PA_T _143} any) ]
      | s41 = -{resolve_ref_ref_PA_T _143}- s42
      | s42 = s43 [ _ck -> (! {[@expl:type invariant] inv_Ghost_ref_PA_T pa} any) ]
      | s43 = -{resolve_Ghost_ref_PA_T pa}- s44
      | s44 = new_unit {_119} (fun (_x: ()) -> [ &_118 <- _x ] s45)
      | s45 = return {_ret} ] ]
    [ & _ret: () = Any.any_l ()
    | & cur: t_Rc_PermCell_Inner_T_Global = cur
    | & auth_id: t_Id = auth_id
    | & pa: MutBorrow.t t_PA_T = pa
    | & perm_cur: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _27: t_PermCellOwn_Inner_T = Any.any_l ()
    | & _28: t_Option_PermCellOwn_Inner_T = Any.any_l ()
    | & _29: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _30: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _31: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _33: t_Id = Any.any_l ()
    | & _35: t_Id = Any.any_l ()
    | & _36: t_Id = Any.any_l ()
    | & _38: t_PermCell_Inner_T = Any.any_l ()
    | & bor_cur: MutBorrow.t t_Inner_T = Any.any_l ()
    | & _41: MutBorrow.t t_Inner_T = Any.any_l ()
    | & _43: t_PermCell_Inner_T = Any.any_l ()
    | & _45: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _46: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _47: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _48: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _49: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _50: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _52: t_Option_PermCellOwn_Inner_T = Any.any_l ()
    | & _53: t_Option_PermCellOwn_Inner_T = Any.any_l ()
    | & _54: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _55: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _56: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _58: t_Id = Any.any_l ()
    | & _60: t_Id = Any.any_l ()
    | & _62: t_PermCell_Inner_T = Any.any_l ()
    | & _64: t_PermCellOwn_Inner_T = Any.any_l ()
    | & next: MutBorrow.t t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & value: MutBorrow.t t_T = Any.any_l ()
    | & index: MutBorrow.t UInt64.t = Any.any_l ()
    | & _70: () = Any.any_l ()
    | & _72: MutBorrow.t t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & _74: MutBorrow.t t_PA_T = Any.any_l ()
    | & _75: MutBorrow.t t_PA_T = Any.any_l ()
    | & _76: MutBorrow.t t_PA_T = Any.any_l ()
    | & _77: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _78: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _79: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & next'0: t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & _81: MutBorrow.t t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & _82: t_Rc_PermCell_Inner_T_Global = Any.any_l ()
    | & perm_next: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _85: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _86: MutBorrow.t t_PermCellOwn_Inner_T = Any.any_l ()
    | & _87: t_Option_ref_PermCellOwn_Inner_T = Any.any_l ()
    | & _88: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _89: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _90: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _92: t_Id = Any.any_l ()
    | & _93: t_Id = Any.any_l ()
    | & _95: t_Id = Any.any_l ()
    | & _97: t_PermCell_Inner_T = Any.any_l ()
    | & bor_next: MutBorrow.t t_Inner_T = Any.any_l ()
    | & _100: MutBorrow.t t_Inner_T = Any.any_l ()
    | & _102: t_PermCell_Inner_T = Any.any_l ()
    | & arr: MutBorrow.t t_Vec_T_Global = Any.any_l ()
    | & _108: () = Any.any_l ()
    | & _109: MutBorrow.t t_T = Any.any_l ()
    | & _110: MutBorrow.t t_T = Any.any_l ()
    | & _111: MutBorrow.t t_T = Any.any_l ()
    | & _112: MutBorrow.t t_Vec_T_Global = Any.any_l ()
    | & _114: MutBorrow.t t_T = Any.any_l ()
    | & _115: () = Any.any_l ()
    | & _116: MutBorrow.t t_Inner_T = Any.any_l ()
    | & _117: MutBorrow.t t_Inner_T = Any.any_l ()
    | & _118: () = Any.any_l ()
    | & _119: () = Any.any_l ()
    | & _120: t_Option_PermCellOwn_Inner_T = Any.any_l ()
    | & _121: MutBorrow.t t_FMap_Id_PermCellOwn_Inner_T = Any.any_l ()
    | & _122: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _123: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _125: t_Id = Any.any_l ()
    | & _127: t_Id = Any.any_l ()
    | & _129: t_PermCell_Inner_T = Any.any_l ()
    | & _131: t_PermCellOwn_Inner_T = Any.any_l ()
    | & new_d: int = Any.any_l ()
    | & _138: Map.map t_Id int = Any.any_l ()
    | & _143: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l ()
    | & _144: MutBorrow.t (MutBorrow.t t_PA_T) = Any.any_l () ])
    [ return (result: ()) -> {[@expl:reroot ensures #0] partial_invariant_T (fin_Ghost_ref_PA_T pa) auth_id}
      {[@expl:reroot ensures #1] (fin_Ghost_ref_PA_T pa).auth = pa.current.auth}
      {[@expl:reroot ensures #2] forall id: t_Id. index_Mapping_Id_Int pa.current.depth id
          > index_Mapping_Id_Int pa.current.depth (id_Inner_T (view_Rc_PermCell_Inner_T_Global cur))
        -> get_Id pa.current.perms id = get_Id (fin_Ghost_ref_PA_T pa).perms id
        /\ index_Mapping_Id_Int pa.current.depth id = index_Mapping_Id_Int (fin_Ghost_ref_PA_T pa).depth id}
      {[@expl:reroot ensures #3] forall id: t_Id. contains_Id (fin_Ghost_ref_PA_T pa).perms id
        = contains_Id pa.current.perms id}
      {[@expl:reroot ensures #4] match val_Inner_T (index_FMap_Id_PermCellOwn_Inner_T (fin_Ghost_ref_PA_T pa).perms (id_Inner_T (view_Rc_PermCell_Inner_T_Global cur))) with
        | Direct _ -> true
        | Link _ _ _ -> false
        end}
      (! return {result}) ]
end
module M_testing
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use creusot.slice.Slice64
  use creusot.int.Int32
  use seq.Seq
  use creusot.int.UInt64
  use mach.int.Int
  use creusot.prelude.MutBorrow
  use set.Set
  use creusot.prelude.Any
  
  type t_Vec_i32_Global
  
  constant const_MAX: UInt64.t = (18446744073709551615: UInt64.t)
  
  function view_Vec_i32_Global (self: t_Vec_i32_Global) : Seq.seq Int32.t
  
  axiom view_Vec_i32_Global_spec: forall self: t_Vec_i32_Global. Seq.length (view_Vec_i32_Global self)
      <= UInt64.t'int const_MAX
  
  function view_Box_slice_i32_Global [@inline:trivial] (self: Slice64.slice Int32.t) : Seq.seq Int32.t =
    Slice64.view self
  
  meta "rewrite_def" function view_Box_slice_i32_Global
  
  let rec into_vec_i32 (self_: Slice64.slice Int32.t) (return (x: t_Vec_i32_Global)) = any
    [ return (result: t_Vec_i32_Global) -> {view_Vec_i32_Global result = view_Box_slice_i32_Global self_}
      (! return {result}) ]
  
  type t_PersistentArray_i32
  
  predicate invariant_PersistentArray_i32 (self: t_PersistentArray_i32)
  
  predicate inv_PersistentArray_i32 (_1: t_PersistentArray_i32)
  
  axiom inv_axiom: forall x: t_PersistentArray_i32 [inv_PersistentArray_i32 x]. inv_PersistentArray_i32 x
      -> invariant_PersistentArray_i32 x
  
  function view_PersistentArray_i32 (self: t_PersistentArray_i32) : Seq.seq Int32.t
  
  let rec new_i32 (v: t_Vec_i32_Global) (return (x: t_PersistentArray_i32)) = any
    [ return (result: t_PersistentArray_i32) -> {inv_PersistentArray_i32 result}
      {view_PersistentArray_i32 result = view_Vec_i32_Global v}
      (! return {result}) ]
  
  type t_Tokens
  
  let rec deref_mut_Ghost_Tokens (self: MutBorrow.t t_Tokens) (return (x: MutBorrow.t t_Tokens)) = any
    [ return (result: MutBorrow.t t_Tokens) -> {result = self} (! return {result}) ]
  
  let rec reborrow (self: MutBorrow.t t_Tokens) (return (x: t_Tokens)) = any
    [ return (result: t_Tokens) -> {result = self.current /\ self.final = self.current} (! return {result}) ]
  
  predicate resolve_ref_Tokens [@inline:trivial] (_1: MutBorrow.t t_Tokens) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_Tokens
  
  let rec new_Tokens (x: t_Tokens) (return (x'0: t_Tokens)) = any
    [ return (result: t_Tokens) -> {result = x} (! return {result}) ]
  
  predicate invariant_ref_PersistentArray_i32 [@inline:trivial] (self: t_PersistentArray_i32) =
    inv_PersistentArray_i32 self
  
  meta "rewrite_def" predicate invariant_ref_PersistentArray_i32
  
  predicate inv_ref_PersistentArray_i32 [@inline:trivial] (_1: t_PersistentArray_i32) =
    invariant_ref_PersistentArray_i32 _1
  
  meta "rewrite_def" predicate inv_ref_PersistentArray_i32
  
  predicate contains_Namespace [@inline:trivial] (self: Set.set t_Namespace) (e: t_Namespace) = Set.mem e self
  
  meta "rewrite_def" predicate contains_Namespace
  
  function namespaces (self: t_Tokens) : Set.set t_Namespace
  
  predicate contains (self: t_Tokens) (namespace: t_Namespace) = contains_Namespace (namespaces self) namespace
  
  let rec set_i32 (self: t_PersistentArray_i32) (index: UInt64.t) (value: Int32.t) (tokens: t_Tokens)
    (return (x: t_PersistentArray_i32)) = {[@expl:set 'self' type invariant] inv_ref_PersistentArray_i32 self}
    {[@expl:set requires #0] UInt64.t'int index < Seq.length (view_PersistentArray_i32 self)}
    {[@expl:set requires #1] contains tokens (Namespace_PARRAY 0)}
    any
    [ return (result: t_PersistentArray_i32) -> {inv_PersistentArray_i32 result}
      {view_PersistentArray_i32 result = Seq.set (view_PersistentArray_i32 self) (UInt64.t'int index) value}
      (! return {result}) ]
  
  predicate resolve_PersistentArray_i32 (_1: t_PersistentArray_i32)
  
  predicate resolve_Tokens (_1: t_Tokens)
  
  predicate resolve_Ghost_Tokens [@inline:trivial] (_1: t_Tokens) = resolve_Tokens _1
  
  meta "rewrite_def" predicate resolve_Ghost_Tokens
  
  let rec clone_PersistentArray_i32 (self: t_PersistentArray_i32) (return (x: t_PersistentArray_i32)) =
    {[@expl:clone 'self' type invariant] inv_ref_PersistentArray_i32 self}
    any
    [ return (result: t_PersistentArray_i32) -> {inv_PersistentArray_i32 result}
      {view_PersistentArray_i32 result = view_PersistentArray_i32 self}
      (! return {result}) ]
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec testing (tokens: t_Tokens) (return (x: ())) = {[@expl:testing requires] contains tokens (Namespace_PARRAY 0)}
    (! bb0
    [ bb0 = s0
      [ s0 = any
        [ any_ (__arr_temp: Slice64.array Int32.t) -> (! -{Seq.get __arr_temp.Slice64.elts 0 = (1: Int32.t)
          /\ Seq.get __arr_temp.Slice64.elts 1 = (2: Int32.t)
          /\ Seq.get __arr_temp.Slice64.elts 2 = (3: Int32.t)
          /\ Seq.get __arr_temp.Slice64.elts 3 = (4: Int32.t) /\ Seq.length __arr_temp.Slice64.elts = 4}-
          [ &_8 <- __arr_temp ] s1) ]
      | s1 = into_vec_i32 {_8} (fun (_x: t_Vec_i32_Global) -> [ &_5 <- _x ] s2)
      | s2 = new_i32 {_5} (fun (_x: t_PersistentArray_i32) -> [ &a <- _x ] s3)
      | s3 = MutBorrow.borrow_mut <t_Tokens> {tokens}
          (fun (_bor: MutBorrow.t t_Tokens) -> [ &_15 <- _bor ] [ &tokens <- _bor.final ] s4)
      | s4 = deref_mut_Ghost_Tokens {_15} (fun (_x: MutBorrow.t t_Tokens) -> [ &_14 <- _x ] s5)
      | s5 = MutBorrow.borrow_final <t_Tokens> {_14.current} {MutBorrow.get_id _14}
          (fun (_bor: MutBorrow.t t_Tokens) -> [ &_13 <- _bor ] [ &_14 <- { _14 with current = _bor.final } ] s6)
      | s6 = reborrow {_13} (fun (_x: t_Tokens) -> [ &_12 <- _x ] s7)
      | s7 = -{resolve_ref_Tokens _14}- s8
      | s8 = new_Tokens {_12} (fun (_x: t_Tokens) -> [ &_11 <- _x ] s9)
      | s9 = set_i32 {a} {(1: UInt64.t)} {(42: Int32.t)} {_11} (fun (_x: t_PersistentArray_i32) -> [ &a2 <- _x ] s10)
      | s10 = s11 [ _ck -> (! {[@expl:type invariant] inv_PersistentArray_i32 a2} any) ]
      | s11 = -{resolve_PersistentArray_i32 a2}- s12
      | s12 = MutBorrow.borrow_mut <t_Tokens> {tokens}
          (fun (_bor: MutBorrow.t t_Tokens) -> [ &_22 <- _bor ] [ &tokens <- _bor.final ] s13)
      | s13 = deref_mut_Ghost_Tokens {_22} (fun (_x: MutBorrow.t t_Tokens) -> [ &_21 <- _x ] s14)
      | s14 = MutBorrow.borrow_final <t_Tokens> {_21.current} {MutBorrow.get_id _21}
          (fun (_bor: MutBorrow.t t_Tokens) -> [ &_20 <- _bor ] [ &_21 <- { _21 with current = _bor.final } ] s15)
      | s15 = reborrow {_20} (fun (_x: t_Tokens) -> [ &_19 <- _x ] s16)
      | s16 = -{resolve_ref_Tokens _21}- s17
      | s17 = new_Tokens {_19} (fun (_x: t_Tokens) -> [ &_18 <- _x ] s18)
      | s18 = set_i32 {a} {(0: UInt64.t)} {(50: Int32.t)} {_18} (fun (_x: t_PersistentArray_i32) -> [ &a3 <- _x ] s19)
      | s19 = -{resolve_Ghost_Tokens tokens}- s20
      | s20 = s21 [ _ck -> (! {[@expl:type invariant] inv_PersistentArray_i32 a3} any) ]
      | s21 = -{resolve_PersistentArray_i32 a3}- s22
      | s22 = s23 [ _ck -> (! {[@expl:type invariant] inv_PersistentArray_i32 a} any) ]
      | s23 = -{resolve_PersistentArray_i32 a}- s24
      | s24 = clone_PersistentArray_i32 {a} (fun (_x: t_PersistentArray_i32) -> [ &a4 <- _x ] s25)
      | s25 = s26 [ _ck -> (! {[@expl:type invariant] inv_PersistentArray_i32 a4} any) ]
      | s26 = -{resolve_PersistentArray_i32 a4}- s27
      | s27 = [ &a_model <- Seq.create 4 [|(1: Int32.t);(2: Int32.t);(3: Int32.t);(4: Int32.t)|] ] s28
      | s28 = [ &a2_model <- Seq.create 4 [|(1: Int32.t);(42: Int32.t);(3: Int32.t);(4: Int32.t)|] ] s29
      | s29 = [ &a3_model <- Seq.create 4 [|(50: Int32.t);(2: Int32.t);(3: Int32.t);(4: Int32.t)|] ] s30
      | s30 = {[@expl:assertion] view_PersistentArray_i32 a = a_model} s31
      | s31 = {[@expl:assertion] view_PersistentArray_i32 a2 = a2_model} s32
      | s32 = {[@expl:assertion] view_PersistentArray_i32 a3 = a3_model} s33
      | s33 = {[@expl:assertion] view_PersistentArray_i32 a4 = a_model} s34
      | s34 = return {_ret} ] ]
    [ & _ret: () = Any.any_l ()
    | & tokens: t_Tokens = tokens
    | & a: t_PersistentArray_i32 = Any.any_l ()
    | & _5: t_Vec_i32_Global = Any.any_l ()
    | & _8: Slice64.array Int32.t = Any.any_l ()
    | & a2: t_PersistentArray_i32 = Any.any_l ()
    | & _11: t_Tokens = Any.any_l ()
    | & _12: t_Tokens = Any.any_l ()
    | & _13: MutBorrow.t t_Tokens = Any.any_l ()
    | & _14: MutBorrow.t t_Tokens = Any.any_l ()
    | & _15: MutBorrow.t t_Tokens = Any.any_l ()
    | & a3: t_PersistentArray_i32 = Any.any_l ()
    | & _18: t_Tokens = Any.any_l ()
    | & _19: t_Tokens = Any.any_l ()
    | & _20: MutBorrow.t t_Tokens = Any.any_l ()
    | & _21: MutBorrow.t t_Tokens = Any.any_l ()
    | & _22: MutBorrow.t t_Tokens = Any.any_l ()
    | & a4: t_PersistentArray_i32 = Any.any_l ()
    | & a_model: Seq.seq Int32.t = Any.any_l ()
    | & a2_model: Seq.seq Int32.t = Any.any_l ()
    | & a3_model: Seq.seq Int32.t = Any.any_l () ]) [ return (result: ()) -> (! return {result}) ]
end
module M_implementation__impl_Clone_for_PersistentArray_T__clone__refines (* <implementation::PersistentArray<T> as std::clone::Clone> *)
  type namespace_other
  
  type t_Namespace = Namespace_PARRAY int | Other namespace_other
  
  use seq.Seq
  
  type t_Rc_PermCell_Inner_T_Global
  
  type t_Fragment_Id_Seq_T
  
  type t_Rc_LocalInvariant_PA_T_Global
  
  type t_PersistentArray_T = {
    permcell: t_Rc_PermCell_Inner_T_Global;
    frag: t_Fragment_Id_Seq_T;
    inv: t_Rc_LocalInvariant_PA_T_Global }
  
  type t_Id
  
  type t_T
  
  type tup2_Id_Seq_T = { f0: t_Id; f1: Seq.seq t_T }
  
  function view_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T) : tup2_Id_Seq_T
  
  type t_PermCell_Inner_T
  
  function id_Inner_T (self: t_PermCell_Inner_T) : t_Id
  
  function view_Rc_PermCell_Inner_T_Global (self: t_Rc_PermCell_Inner_T_Global) : t_PermCell_Inner_T
  
  function id_Id (self: t_Fragment_Id_Seq_T) : t_Id
  
  type t_LocalInvariant_PA_T
  
  function public_PA_T (self: t_LocalInvariant_PA_T) : t_Id
  
  function view_Rc_LocalInvariant_PA_T_Global (self: t_Rc_LocalInvariant_PA_T_Global) : t_LocalInvariant_PA_T
  
  function namespace_PA_T (self: t_LocalInvariant_PA_T) : t_Namespace
  
  predicate invariant_PersistentArray_T (self: t_PersistentArray_T) =
    (view_Fragment_Id_Seq_T self.frag).f0 = id_Inner_T (view_Rc_PermCell_Inner_T_Global self.permcell)
    /\ id_Id self.frag = public_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv)
    /\ namespace_PA_T (view_Rc_LocalInvariant_PA_T_Global self.inv) = Namespace_PARRAY 0
  
  predicate inv_Rc_PermCell_Inner_T_Global (_1: t_Rc_PermCell_Inner_T_Global)
  
  predicate invariant_Fragment_Id_Seq_T (self: t_Fragment_Id_Seq_T)
  
  predicate inv_Fragment_Id_Seq_T (_1: t_Fragment_Id_Seq_T)
  
  axiom inv_axiom: forall x: t_Fragment_Id_Seq_T [inv_Fragment_Id_Seq_T x]. inv_Fragment_Id_Seq_T x
      -> invariant_Fragment_Id_Seq_T x
  
  predicate invariant_Ghost_Fragment_Id_Seq_T [@inline:trivial] (self: t_Fragment_Id_Seq_T) = inv_Fragment_Id_Seq_T self
  
  meta "rewrite_def" predicate invariant_Ghost_Fragment_Id_Seq_T
  
  predicate inv_Ghost_Fragment_Id_Seq_T [@inline:trivial] (_1: t_Fragment_Id_Seq_T) =
    invariant_Ghost_Fragment_Id_Seq_T _1
  
  meta "rewrite_def" predicate inv_Ghost_Fragment_Id_Seq_T
  
  predicate inv_Rc_LocalInvariant_PA_T_Global (_1: t_Rc_LocalInvariant_PA_T_Global)
  
  predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (self: t_Rc_LocalInvariant_PA_T_Global) =
    inv_Rc_LocalInvariant_PA_T_Global self
  
  meta "rewrite_def" predicate invariant_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global [@inline:trivial] (_1: t_Rc_LocalInvariant_PA_T_Global) =
    invariant_Ghost_Rc_LocalInvariant_PA_T_Global _1
  
  meta "rewrite_def" predicate inv_Ghost_Rc_LocalInvariant_PA_T_Global
  
  predicate inv_PersistentArray_T (_1: t_PersistentArray_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_PersistentArray_T [inv_PersistentArray_T x]. inv_PersistentArray_T x
      = (invariant_PersistentArray_T x
      /\ inv_Rc_PermCell_Inner_T_Global x.permcell
      /\ inv_Ghost_Fragment_Id_Seq_T x.frag /\ inv_Ghost_Rc_LocalInvariant_PA_T_Global x.inv)
  
  predicate invariant_ref_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) = inv_PersistentArray_T self
  
  meta "rewrite_def" predicate invariant_ref_PersistentArray_T
  
  predicate inv_ref_PersistentArray_T [@inline:trivial] (_1: t_PersistentArray_T) = invariant_ref_PersistentArray_T _1
  
  meta "rewrite_def" predicate inv_ref_PersistentArray_T
  
  function view_PersistentArray_T [@inline:trivial] (self: t_PersistentArray_T) : Seq.seq t_T =
    (view_Fragment_Id_Seq_T self.frag).f1
  
  meta "rewrite_def" function view_PersistentArray_T
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  goal refines: forall self_: t_PersistentArray_T. inv_ref_PersistentArray_T self_
      -> inv_ref_PersistentArray_T self_
      /\ (forall result: t_PersistentArray_T. inv_PersistentArray_T result
          /\ view_PersistentArray_T result = view_PersistentArray_T self_ -> inv_PersistentArray_T result)
end
