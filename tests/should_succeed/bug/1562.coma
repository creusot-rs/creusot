module M_impl_List_T__foo (* List<T> *)
  use creusot.prelude.MutBorrow
  use creusot.prelude.Any
  
  type t_Rc_PermCell_List_T_Global
  
  type t_Node_T = { next: t_Rc_PermCell_List_T_Global }
  
  type t_Option_Node_T = None | Some t_Node_T
  
  type t_List_T = { head: t_Option_Node_T }
  
  predicate inv_Rc_PermCell_List_T_Global (_1: t_Rc_PermCell_List_T_Global)
  
  predicate inv_Node_T (_1: t_Node_T)
  
  axiom inv_axiom [@rewrite]: forall x: t_Node_T [inv_Node_T x]. inv_Node_T x = inv_Rc_PermCell_List_T_Global x.next
  
  predicate inv_Option_Node_T (_1: t_Option_Node_T)
  
  axiom inv_axiom'0 [@rewrite]: forall x: t_Option_Node_T [inv_Option_Node_T x]. inv_Option_Node_T x
      = match x with
        | None -> true
        | Some f0 -> inv_Node_T f0
        end
  
  predicate invariant_ref_Option_Node_T [@inline:trivial] (self: t_Option_Node_T) = inv_Option_Node_T self
  
  meta "rewrite_def" predicate invariant_ref_Option_Node_T
  
  predicate inv_ref_Option_Node_T [@inline:trivial] (_1: t_Option_Node_T) = invariant_ref_Option_Node_T _1
  
  meta "rewrite_def" predicate inv_ref_Option_Node_T
  
  let rec is_none_Node_T (self_: t_Option_Node_T) (return (x: bool)) =
    {[@expl:is_none 'self_' type invariant] inv_ref_Option_Node_T self_}
    any [ return (result: bool) -> {result = (self_ = None)} (! return {result}) ]
  
  predicate inv_List_T (_1: t_List_T)
  
  axiom inv_axiom'1 [@rewrite]: forall x: t_List_T [inv_List_T x]. inv_List_T x = inv_Option_Node_T x.head
  
  predicate invariant_refmut_List_T [@inline:trivial] (self: MutBorrow.t t_List_T) =
    inv_List_T self.current /\ inv_List_T self.final
  
  meta "rewrite_def" predicate invariant_refmut_List_T
  
  predicate inv_refmut_List_T [@inline:trivial] (_1: MutBorrow.t t_List_T) = invariant_refmut_List_T _1
  
  meta "rewrite_def" predicate inv_refmut_List_T
  
  predicate invariant_refmut_Option_Node_T [@inline:trivial] (self: MutBorrow.t t_Option_Node_T) =
    inv_Option_Node_T self.current /\ inv_Option_Node_T self.final
  
  meta "rewrite_def" predicate invariant_refmut_Option_Node_T
  
  predicate inv_refmut_Option_Node_T [@inline:trivial] (_1: MutBorrow.t t_Option_Node_T) =
    invariant_refmut_Option_Node_T _1
  
  meta "rewrite_def" predicate inv_refmut_Option_Node_T
  
  let rec take_Node_T (self_: MutBorrow.t t_Option_Node_T) (return (x: t_Option_Node_T)) =
    {[@expl:take 'self_' type invariant] inv_refmut_Option_Node_T self_}
    any
    [ return (result: t_Option_Node_T) -> {inv_Option_Node_T result}
      {result = self_.current /\ self_.final = None}
      (! return {result}) ]
  
  predicate resolve_refmut_List_T [@inline:trivial] (_1: MutBorrow.t t_List_T) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_refmut_List_T
  
  let rec unwrap_Node_T (self_: t_Option_Node_T) (return (x: t_Node_T)) =
    {[@expl:unwrap 'self_' type invariant] inv_Option_Node_T self_}
    {[@expl:unwrap requires] self_ <> None}
    any [ return (result: t_Node_T) -> {inv_Node_T result} {Some result = self_} (! return {result}) ]
  
  predicate resolve_Rc_PermCell_List_T_Global (_1: t_Rc_PermCell_List_T_Global)
  
  predicate resolve_Node_T (_1: t_Node_T)
  
  axiom resolve_axiom [@rewrite]: forall x: t_Node_T [resolve_Node_T x]. resolve_Node_T x
      = resolve_Rc_PermCell_List_T_Global x.next
  
  predicate invariant_ref_Rc_PermCell_List_T_Global [@inline:trivial] (self: t_Rc_PermCell_List_T_Global) =
    inv_Rc_PermCell_List_T_Global self
  
  meta "rewrite_def" predicate invariant_ref_Rc_PermCell_List_T_Global
  
  predicate inv_ref_Rc_PermCell_List_T_Global [@inline:trivial] (_1: t_Rc_PermCell_List_T_Global) =
    invariant_ref_Rc_PermCell_List_T_Global _1
  
  meta "rewrite_def" predicate inv_ref_Rc_PermCell_List_T_Global
  
  let rec clone_Rc_PermCell_List_T_Global (self_: t_Rc_PermCell_List_T_Global)
    (return (x: t_Rc_PermCell_List_T_Global)) =
    {[@expl:clone 'self_' type invariant] inv_ref_Rc_PermCell_List_T_Global self_}
    any
    [ return (result: t_Rc_PermCell_List_T_Global) -> {inv_Rc_PermCell_List_T_Global result}
      {result = self_}
      (! return {result}) ]
  
  type t_PermCell_List_T
  
  function view_Rc_PermCell_List_T_Global (self: t_Rc_PermCell_List_T_Global) : t_PermCell_List_T
  
  let rec as_ref_Rc_PermCell_List_T_Global (self_: t_Rc_PermCell_List_T_Global) (return (x: t_PermCell_List_T)) =
    {[@expl:as_ref 'self_' type invariant] inv_ref_Rc_PermCell_List_T_Global self_}
    any [ return (result: t_PermCell_List_T) -> {result = view_Rc_PermCell_List_T_Global self_} (! return {result}) ]
  
  type t_Perm_PermCell_List_T
  
  let rec deref_mut_Ghost_Box_Perm_PermCell_List_T_Global (self: MutBorrow.t t_Perm_PermCell_List_T)
    (return (x: MutBorrow.t t_Perm_PermCell_List_T)) = any
    [ return (result: MutBorrow.t t_Perm_PermCell_List_T) -> {result = self} (! return {result}) ]
  
  predicate resolve_refmut_Box_Perm_PermCell_List_T_Global [@inline:trivial] (_1: MutBorrow.t t_Perm_PermCell_List_T) =
    _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_refmut_Box_Perm_PermCell_List_T_Global
  
  predicate resolve_refmut_Perm_PermCell_List_T [@inline:trivial] (_1: MutBorrow.t t_Perm_PermCell_List_T) =
    _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_refmut_Perm_PermCell_List_T
  
  let rec new_refmut_Perm_PermCell_List_T (x: MutBorrow.t t_Perm_PermCell_List_T)
    (return (x'0: MutBorrow.t t_Perm_PermCell_List_T)) = any
    [ return (result: MutBorrow.t t_Perm_PermCell_List_T) -> {result = x} (! return {result}) ]
  
  function ward_PermCell_List_T (self: t_Perm_PermCell_List_T) : t_PermCell_List_T
  
  function fin_Ghost_refmut_Perm_PermCell_List_T [@inline:trivial] (self: MutBorrow.t t_Perm_PermCell_List_T) : t_Perm_PermCell_List_T
   = self.final
  
  meta "rewrite_def" function fin_Ghost_refmut_Perm_PermCell_List_T
  
  function val_PermCell_List_T (self: t_Perm_PermCell_List_T) : t_List_T
  
  function view_Perm_PermCell_List_T [@inline:trivial] (self: t_Perm_PermCell_List_T) : t_List_T =
    val_PermCell_List_T self
  
  meta "rewrite_def" function view_Perm_PermCell_List_T
  
  let rec borrow_mut_List_T (self: t_PermCell_List_T) (perm: MutBorrow.t t_Perm_PermCell_List_T)
    (return (x: MutBorrow.t t_List_T)) = {[@expl:borrow_mut requires] self = ward_PermCell_List_T perm.current}
    any
    [ return (result: MutBorrow.t t_List_T) -> {inv_refmut_List_T result}
      {self = ward_PermCell_List_T (fin_Ghost_refmut_Perm_PermCell_List_T perm)}
      {result.current = view_Perm_PermCell_List_T perm.current}
      {result.final = view_Perm_PermCell_List_T (fin_Ghost_refmut_Perm_PermCell_List_T perm)}
      (! return {result}) ]
  
  predicate resolve_ref_List_T [@inline:trivial] (_1: t_List_T) = true
  
  meta "rewrite_def" predicate resolve_ref_List_T
  
  predicate resolve_Perm_PermCell_List_T [@inline:trivial] (self: t_Perm_PermCell_List_T) =
    resolve_ref_List_T (val_PermCell_List_T self)
  
  meta "rewrite_def" predicate resolve_Perm_PermCell_List_T
  
  predicate resolve_Perm_PermCell_List_T'0 (_1: t_Perm_PermCell_List_T)
  
  axiom resolve_axiom'0:
    forall x: t_Perm_PermCell_List_T [resolve_Perm_PermCell_List_T'0 x]. resolve_Perm_PermCell_List_T'0 x
      -> resolve_Perm_PermCell_List_T x
  
  predicate resolve_Box_Perm_PermCell_List_T_Global [@inline:trivial] (_1: t_Perm_PermCell_List_T) =
    resolve_Perm_PermCell_List_T'0 _1
  
  meta "rewrite_def" predicate resolve_Box_Perm_PermCell_List_T_Global
  
  predicate resolve_Ghost_Box_Perm_PermCell_List_T_Global [@inline:trivial] (_1: t_Perm_PermCell_List_T) =
    resolve_Box_Perm_PermCell_List_T_Global _1
  
  meta "rewrite_def" predicate resolve_Ghost_Box_Perm_PermCell_List_T_Global
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec foo_T (self: MutBorrow.t t_List_T) (perm: t_Perm_PermCell_List_T) (return (x: ())) =
    {[@expl:foo 'self' type invariant] inv_refmut_List_T self}
    {[@expl:foo requires] false}
    (! bb0
    [ bb0 = s0 [ s0 = [ &p <- self ] s1 | s1 = bb1 ]
    | bb1 = bb1
      [ bb1 = {[@expl:inferred invariant: type invariant] inv_refmut_List_T p}
        (! s0)
        [ s0 = is_none_Node_T {p.current.head} (fun (_x: bool) -> [ &_7 <- _x ] s1)
        | s1 = any [ br0 -> {_7 = false} (! bb5) | br1 -> {_7} (! bb4) ] ]
        [ bb5 = s0
          [ s0 = MutBorrow.borrow_final <t_Option_Node_T> {p.current.head} {MutBorrow.inherit_id (MutBorrow.get_id p) 1}
              (fun (_bor: MutBorrow.t t_Option_Node_T) ->
                [ &_11 <- _bor ] -{inv_Option_Node_T _bor.final}-
                [ &p <- { p with current = { head = _bor.final } } ] s1)
            [ _ck -> (! {inv_Option_Node_T p.current.head} any) ]
          | s1 = take_Node_T {_11} (fun (_x: t_Option_Node_T) -> [ &_10 <- _x ] s2)
          | s2 = s3 [ _ck -> (! {[@expl:type invariant] inv_refmut_List_T p} any) ]
          | s3 = -{resolve_refmut_List_T p}- s4
          | s4 = unwrap_Node_T {_10} (fun (_x: t_Node_T) -> [ &curr <- _x ] s5)
          | s5 = s6 [ _ck -> (! {[@expl:type invariant] inv_Node_T curr} any) ]
          | s6 = -{resolve_Node_T curr}- s7
          | s7 = clone_Rc_PermCell_List_T_Global {curr.next}
              (fun (_x: t_Rc_PermCell_List_T_Global) -> [ &_12 <- _x ] s8)
          | s8 = [ &next'0 <- _12 ] s9
          | s9 = s10 [ _ck -> (! {[@expl:type invariant] inv_Rc_PermCell_List_T_Global next'0} any) ]
          | s10 = -{resolve_Rc_PermCell_List_T_Global next'0}- s11
          | s11 = as_ref_Rc_PermCell_List_T_Global {next'0} (fun (_x: t_PermCell_List_T) -> [ &_17 <- _x ] s12)
          | s12 = MutBorrow.borrow_mut <t_Perm_PermCell_List_T> {perm}
              (fun (_bor: MutBorrow.t t_Perm_PermCell_List_T) -> [ &_25 <- _bor ] [ &perm <- _bor.final ] s13)
          | s13 = deref_mut_Ghost_Box_Perm_PermCell_List_T_Global {_25}
              (fun (_x: MutBorrow.t t_Perm_PermCell_List_T) -> [ &_24 <- _x ] s14)
          | s14 = MutBorrow.borrow_final <t_Perm_PermCell_List_T> {_24.current} {MutBorrow.get_id _24}
              (fun (_bor: MutBorrow.t t_Perm_PermCell_List_T) ->
                [ &_23 <- _bor ] [ &_24 <- { _24 with current = _bor.final } ] s15)
          | s15 = MutBorrow.borrow_final <t_Perm_PermCell_List_T> {_23.current} {MutBorrow.get_id _23}
              (fun (_bor: MutBorrow.t t_Perm_PermCell_List_T) ->
                [ &_22 <- _bor ] [ &_23 <- { _23 with current = _bor.final } ] s16)
          | s16 = -{resolve_refmut_Box_Perm_PermCell_List_T_Global _24}- s17
          | s17 = -{resolve_refmut_Perm_PermCell_List_T _23}- s18
          | s18 = MutBorrow.borrow_final <t_Perm_PermCell_List_T> {_22.current} {MutBorrow.get_id _22}
              (fun (_bor: MutBorrow.t t_Perm_PermCell_List_T) ->
                [ &_21 <- _bor ] [ &_22 <- { _22 with current = _bor.final } ] s19)
          | s19 = -{resolve_refmut_Perm_PermCell_List_T _22}- s20
          | s20 = MutBorrow.borrow_final <t_Perm_PermCell_List_T> {_21.current} {MutBorrow.get_id _21}
              (fun (_bor: MutBorrow.t t_Perm_PermCell_List_T) ->
                [ &_20 <- _bor ] [ &_21 <- { _21 with current = _bor.final } ] s21)
          | s21 = new_refmut_Perm_PermCell_List_T {_20}
              (fun (_x: MutBorrow.t t_Perm_PermCell_List_T) -> [ &_19 <- _x ] s22)
          | s22 = -{resolve_refmut_Perm_PermCell_List_T _21}- s23
          | s23 = borrow_mut_List_T {_17} {_19} (fun (_x: MutBorrow.t t_List_T) -> [ &_15 <- _x ] s24)
          | s24 = MutBorrow.borrow_final <t_List_T> {_15.current} {MutBorrow.get_id _15}
              (fun (_bor: MutBorrow.t t_List_T) ->
                [ &_14 <- _bor ] -{inv_List_T _bor.final}-
                [ &_15 <- { _15 with current = _bor.final } ] s25) [ _ck -> (! {inv_List_T _15.current} any) ]
          | s25 = [ &p <- _14 ] s26
          | s26 = s27 [ _ck -> (! {[@expl:type invariant] inv_refmut_List_T _15} any) ]
          | s27 = -{resolve_refmut_List_T _15}- s28
          | s28 = bb1 ] ] ]
    | bb4 = s0
      [ s0 = s1 [ _ck -> (! {[@expl:type invariant] inv_refmut_List_T p} any) ]
      | s1 = -{resolve_refmut_List_T p}- s2
      | s2 = -{resolve_Ghost_Box_Perm_PermCell_List_T_Global perm}- s3
      | s3 = return {_ret} ] ]
    [ & _ret: () = Any.any_l ()
    | & self: MutBorrow.t t_List_T = self
    | & perm: t_Perm_PermCell_List_T = perm
    | & p: MutBorrow.t t_List_T = Any.any_l ()
    | & next'0: t_Rc_PermCell_List_T_Global = Any.any_l ()
    | & _7: bool = Any.any_l ()
    | & curr: t_Node_T = Any.any_l ()
    | & _10: t_Option_Node_T = Any.any_l ()
    | & _11: MutBorrow.t t_Option_Node_T = Any.any_l ()
    | & _12: t_Rc_PermCell_List_T_Global = Any.any_l ()
    | & _14: MutBorrow.t t_List_T = Any.any_l ()
    | & _15: MutBorrow.t t_List_T = Any.any_l ()
    | & _17: t_PermCell_List_T = Any.any_l ()
    | & _19: MutBorrow.t t_Perm_PermCell_List_T = Any.any_l ()
    | & _20: MutBorrow.t t_Perm_PermCell_List_T = Any.any_l ()
    | & _21: MutBorrow.t t_Perm_PermCell_List_T = Any.any_l ()
    | & _22: MutBorrow.t t_Perm_PermCell_List_T = Any.any_l ()
    | & _23: MutBorrow.t t_Perm_PermCell_List_T = Any.any_l ()
    | & _24: MutBorrow.t t_Perm_PermCell_List_T = Any.any_l ()
    | & _25: MutBorrow.t t_Perm_PermCell_List_T = Any.any_l () ]) [ return (result: ()) -> (! return {result}) ]
end
